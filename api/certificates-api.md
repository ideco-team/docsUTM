# Управление сертификатами

## Управление действующими сертификатами

<details>
<summary>Получение списка действующих сертификатов</summary>

```
GET /certs/runtime
```

**Ответ на успешный запрос:**

```json5
[
  {
    "id": "string",
    "type": "automatic" | "lets-encrypt" | "custom",
    "cert_pem": "string",
    "status": [
      {
        "severity": "error" | "warning" | "info",
        "message": "string",
      }
    ],
    "root": "boolean",
    "request": "string"
  },
  ...
]
```

* `id` - домен или IP-адрес сервера, для которого выпущен сертификат;
* `type` - тип сертификата:
  * `automatic` - автоматически сгенерированный;
  * `lets-encrypt` - выпущенный через Let’s Encrypt;
  * `custom` - пользовательский (загруженный вручную).
* `cert_pem` - содержимое сертификат в формате PEM;
* `status` - состояние сертификата. Может быть пустым или содержать данные:
  * `severity` - уровень критичности (`error`, `warning`, `info`);
  * `message` - поясняющее сообщение.
* `root` - признак корневого сертификата: если `true` - корневой сертификат; если `false` - пользовательский;
* `request` - содержит значение поля **CN** (Common Name, общее имя).

</details>

<details>
<summary>Перевыпуск пользовательского сертификата</summary>

```
DELETE /certs/runtime/<id сертификата>
```

**Ответ на успешный запрос:** статус 200.

</details>

## Управление загруженными сертификатами

<details>
<summary>Получение списка загруженных сертификатов</summary>

```
GET /certs/stored
```

**Ответ на успешный запрос:**

```json5
[
  {
    "id": "string",
    "cert_pem": "string",
    "type": "automatic" | "custom",
    "root": "boolean"
  },
  ...
]
```

* `id` - идентификатор сертификата;
* `cert_pem` - содержимое сертификат в формате PEM;
* `type` - тип сертификата:
  * `automatic` - автоматически сгенерированный;
  * `custom` - пользовательский (загруженный вручную).
* `root` - признак корневого сертификата: если `true` - корневой сертификат; если `false` - пользовательский.

</details>

<details>
<summary>Загрузка пользовательского сертификата с ключом</summary>

```
POST /certs/stored
```

**Тело запроса:** сертификат и ключ в формате PEM.

**Ответ на успешный запрос:**

```json5
{
  "id": "string"
}
```

</details>

<details>
<summary>Замена сертификата и ключа</summary>

```
PUT /certs/stored/<id сертификата>
```

**Тело запроса:** сертификат и ключ в формате PEM.

**Ответ на успешный запрос:** статус 200.

Аналогично можно заменить корневой сертификат.

</details>

<details>
<summary>Удаление пользовательского сертификата и ключа \ Перевыпуск корневого сертификата</summary>

```
DELETE /certs/stored/<id сертификата>
```

**Ответ на успешный запрос:** статус 200.

</details>

<details>
<summary>Получение корневого сертификата</summary>

```
GET /certs/root_ca/download
```

**Ответ на успешный запрос:** статус 200 и сертификат без приватного ключа в формате PEM.

</details>

## Управление системными сертификатами

<details>
<summary>Получение списка системных сертификатов</summary>

```
GET /certs/stored_ext
```

**Ответ на успешный запрос:**

```json5
[
  {
    "id": "string",
    "cert_pem": "string",
    "status": "active" | "expired"
  },
  ...
]
```

* `id` - идентификатор сертификата;
* `cert_pem` - содержимое сертификат в формате PEM;
* `status` - состояние сертификата:
  * `active` - действителен;
  * `expired` - срок действия истек.

</details>

<details>
<summary>Загрузка системного сертификата</summary>

```
POST /certs/stored_ext
```

**Тело запроса:** сертификат в формате PEM.

**Ответ на успешный запрос:**

```json5
{
  "id": "string"
}
```

* `id` - идентификатор сертификата.

</details>

<details>
<summary>Удаление системного сертификата</summary>

```
DELETE /certs/stored_ext/<id сертификата>
```

**Ответ на успешный запрос:** статус 200.

</details>

<details>
<summary>Получение системного (корневого) сертификата</summary>

```
GET /certs/stored_ext/<id сертификата>/download
```

**Ответ на успешный запрос:** статус 200 и сертификат в формате PEM.

</details>
