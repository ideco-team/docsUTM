# Особенности настроек гипервизоров

{% hint style="danger" %}
Для установки Ideco UTM нужно включить режим UEFI в настройках виртуальной машины.
{% endhint %}

{% hint style="info" %}
**Обязательные условия для работы Ideco UTM:**

1. Поддержка UEFI;
2. Отключить режим Legacy загрузки (он также может называться CSM (Compatibility Support Module);
3. Отключить опцию Secure Boot в UEFI.
{% endhint %}

Ideco UTM поддерживает работу на следующих гипервизорах:

* VMware (Workstation и ESXi) версии не ниже 6.5.0;
* Microsoft Hyper-V (2-го поколения);
* VirtualBox;
* KVM;
* Citrix XenServer.

Для работы на виртуальных машинах нет необходимости в установке дополнительных драйверов или утилит на Ideco UTM. Гостевые дополнения входят в состав дистрибутива.

## Общие рекомендации

* Тип ОС для создания виртуальной машины: Linux Fedora, 64 bit;
* Минимальный размер жесткого диска - 64 ГБ;
* Динамическое расширение жесткого диска не автоматизировано, но возможно через обращение в техническую поддержку;
* Минимальное количество оперативной памяти: 8 ГБ;
* Внутренние часы ВМ должны быть настроены на хранение времени во временной зоне UTC.

{% hint style="warning" %}
Если при установке Ideco UTM появилась ошибка с текстом **"Требуется не менее 8 ГБ оперативной памяти"**, и при этом был указан рекомендуемый размер оперативной памяти, то уменьшите размер ресурсов, выделенных под видеопамять до минимального.
{% endhint %}

{% hint style="info" %}
Если при установке Ideco UTM появилось окно с надписью **Installation in BIOS mode is not supported**, проверьте включение режима UEFI в настройках виртуальной машины. 
{% endhint %}

## **Microsoft Hyper-V**

Поддерживается только второе поколение виртуальных машин под Windows Server 2012 R2 или выше. Необходимо отключить опцию Secure Boot (безопасная загрузка).

**Видеоинструкция по настройке виртуальной машины**:

{% embed url="https://www.youtube.com/watch?v=238bs_4ObPY" %}

Всегда используйте обычный виртуальный сетевой адаптер (Network Adapter).

## VMware ESXi

Перед установкой Ideco UTM необходимо увеличить размер видеопамяти для виртуальной машины до 16 МБ (по умолчанию 4 МБ).

Рекомендуется использовать виртуальные сетевые адаптеры **vmxnet3**.

{% hint style="info" %}
При установке Ideco UTM на хосты кластера с разными поколениями процессоров укажите в настройках EVC самое старое поколение процессора из хостов, соответствующее минимальным системным требованиям для установки.
{% endhint %}

## VirtualBox

1\. Укажите **Имя** виртуальной машины (ВМ), выберите директорию для ВМ и установите путь до ISO-образа UTM. Остальные параметры установите как на скриншоте:

![](../.gitbook/assets/specifics-of-hypervisor-settings1.png)

2\. Установите размер оперативной памяти ВМ (**8 ГБ**) и нажмите **Включить EFI**:

![](../.gitbook/assets/specifics-of-hypervisor-settings2.png)

3\. Cоздайте виртуальный жесткий диск под ВМ (Объем не меньше **64ГБ**):

![](../.gitbook/assets/specifics-of-hypervisor-settings3.png)

4\. Нажмите **Готово**

{% hint style="info" %}
При возможных проблемах проверьте соответствие параметров виртуальной машины [минимальным системным требованиям](#obshie-rekomendacii).
{% endhint %}

## Citrix XenServer

В случае, если xenserver не загружается с ISO-образа, сделайте следующее:

1. Выполните команду `xe vm-list`. Данная команда отобразит список виртуальных машин на xenserver;
2. Выберите виртуальную машину с UTM и запомните ее UUID;
3. Выполните команду `xe vm-param-set uuid=<UUID> HVM-boot-policy=BIOS\ order HVM-boot-params:order=dc`;

После выполнения данных шагов должна начаться загрузка с установочного носителя.

## KVM

1\. При установке Ideco UTM выберите тип операционной системы - **Fedora**

2\. На пятом шаге (virtm-manager) установки обязательно поставьте галочку **Проверить конфигурацию перед установкой** и нажмите кнопку **Готово**.

![](../.gitbook/assets/create-vm.png)

3\. Для дисков и сетевых карт укажите/измените интерфейс на **virtio.**

4\. Для дисков используйте режим кеширования **writeback**, если диски хранятся в qcow2 или raw-файлах. Если нет - проконсультируйтесь у администратора хранилища либо нашей технической поддержки относительно выбора режима кеширования.

5\. В появившемся окне на вкладке **Обзор** в поле Firmware выберите пункт **UEFI x86\_64:/usr/share/OVMF/OVMF\_CODE.fd**. Выбор этого пункта включит UEFI и выключит опцию **Secure Boot**.

![](../.gitbook/assets/create-vm1.png)

{% hint style="info" %}
Если пункта **UEFI x86\_64:/usr/share/OVMF/OVMF\_CODE.fd** нет в списке, то нужно доустановить пакет ovmf. В Ubuntu этот пакет устанавливается командой **sudo apt install ovmf**.
{% endhint %}
