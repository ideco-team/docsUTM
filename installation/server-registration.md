---
description: В статье представлена информация о процессе привязки лицензии к серверу NGFW.
---

# Регистрация сервера

{% hint style="info" %}
Для активации лицензии необходима обязательная регистрация сервера в [личном кабинете](https://my.ideco.ru/#/login/?next=/utm/license/).
{% endhint %}

## Онлайн-регистрация

{% hint style="warning" %}
Для привязки лицензии сервер должен иметь выход в интернет.
{% endhint %}

Шаги онлайн-регистрации сервера и привязки лицензии:

1\. Перейдите в веб-интерфейс Ideco NGFW в раздел **Управление сервером -> Лицензия** и нажмите **Зарегистрировать**:

![](/.gitbook/assets/initial-setup10.png)

2\. В открывшемся окне перейдите по ссылке **Зарегистрировать новый сервер**, выберите компанию и нажмите **Добавить**. После добавления нажмите **Обновить информацию о лицензии** для проверки состояния лицензии:

![](/.gitbook/assets/initial-setup11.gif)

<!-- На странице отобразится информация о лицензии и ее модулях. -->

## Офлайн-регистрация

{% hint style="info" %}
С выходом Ideco NGFW версии 18 процедура офлайн-регистрации и обновления стала более удобной. Рекомендуем обновить NGFW до последней версии, чтобы воспользоваться всеми преимуществами улучшенной процедуры.
{% endhint %}

#### Привяжите сервер к личному кабинету в [MY.IDECO](https://my.ideco.ru/). Для этого:

1\. Перейдите в веб-интерфейс Ideco NGFW в раздел **Управление сервером -> Терминал**.

2\. Выполните команду `cat /usr/share/ideco/license-backend/hwid` и скопируйте **HWID** сервера. Пример: `t7m7H137w-pQXYjXuHmYbLnJw3YyxJAg5wl9FfARlh`.

3\. Выполните команду `cat /usr/share/ideco/version.json` и скопируйте Json-объект с версией сервера, например:

{% code overflow="wrap" %}
```
{"major": 17, "minor": 5, "build": 102, "timestamp": 1724427324, "vendor": "Ideco", "product": "UTM", "kind": "STANDARD", "release_type": "release"}
```
{% endcode %}

4\. Сформируйте ссылку на регистрацию сервера и перейдите по ней на устройстве с доступом в интернет:

{% code overflow="wrap" %}
```
https://my.ideco.ru/ngfw?server_name=<название сервера (доступно в левом верхнем углу веб-интерфейса)>&version=<Json-объект с версией сервера>&hwid=<HWID, полученный в пункте 2>
```
{% endcode %}

Пример ссылки на регистрацию:

{% code overflow="wrap" %}
```
https://my.ideco.ru/ngfw?server_name=Без названия 23000007-c6c1-3d58-9da2-40ea5128aab5&version={"major": 17, "minor": 5, "build": 102, "timestamp": 1724427324, "vendor": "Ideco", "product": "UTM", "kind": "STANDARD", "release_type": "release"}&hwid=sGs6OYW2XRm_aK9PRwifKnej3V8YUVw69dtKVkIoPEnD
```
{% endcode %}

{% hint style="warning" %}
Не используйте спецсимволы в названии сервера Ideco NGFW, они могут быть некорректно закодированы при переходе по ссылке на регистрацию сервера.
{% endhint %}

#### Привяжите к серверу лицензию:

1\. Обратитесь к вашему менеджеру для предоставления лицензии.

2\. Перейдите в раздел **NGFW -> Лицензирование** и нажмите **Привязать лицензию** рядом с нужным сервером. Пример наименования сервера для офлайн-регистрации: `UTM (UTM Unknown)`.  

Если была выбрана лицензия, не подходящая для офлайн-регистрации сервера, то появится ошибка:

![](/.gitbook/assets/initial-setup13.png)

3\. Сформируйте ссылку на скачивание баз и лицензии, перейдите по ней на устройстве с доступом в интернет:

{% code overflow="wrap" %}
```
https://my.ideco.ru/ngfw?offline-updates&version=<Json-объект с версией сервера>&hwid=<HWID, полученный в пункте 2>
```
{% endcode %}

Пример ссылки:

{% code overflow="wrap" %}
```
https://my.ideco.ru/ngfw?offline-updates&version={"major": 17, "minor": 5, "build": 102, "timestamp": 1724427324, "vendor": "Ideco", "product": "UTM", "kind": "STANDARD", "release_type": "release"}&hwid=sGs6OYW2XRm_aK9PRwifKnej3V8YUVw69dtKVkIoPEnD
```
{% endcode %}

4\. Сохраните файлы лицензии и баз фильтрации, нажав на появившиеся ссылки:

![](/.gitbook/assets/my-ideco-ngfw.png)

5\. Сохраните скрипт для конвертации файлов в папку, в которую сохранили файлы на шаге 4:

{% file src="/scripts/convert.py";base64,Cg==" name="convert.py" %}

6\. Откройте терминал на устройстве и перейдите в каталог с помощью команды `cd ~/<название папки со скачанными файлами>`, а затем запустите скрипт командой `python convert.py`.

7\. Добавьте конфигурационный файл с информацией о лицензии в Ideco NGFW:

* Перейдите в раздел **Управление сервером -> Терминал**;
* Загрузите полученный файл `license.json` на сервер Ideco NGFW в директорию `/var/cache/ideco/license-backend/`.

  Для загрузки файла можно использовать команду `scp` или утилиту WinSCP. Чтобы получить доступ к серверу, активируйте возможность подключения к нему по SSH из локальной сети. Это можно сделать через веб-интерфейс в разделе **Управление сервером -> Администраторы**:

![](/.gitbook/assets/admins3.png)

* Перезапустите сервис лицензий командой `systemctl restart ideco-license-backend.service`;
* Перейдите в раздел **Управление сервером - Лицензия** и убедитесь, что лицензия установлена.

## Офлайн-обновление баз модулей безопасности

Для обновления баз модулей безопасности при офлайн-регистрации сервера выполните действия:

1\. Сохраните скрипты запуска обновления баз модулей безопасности в папку `converted` вместе с конвертированными файлами, полученными на шаге 5:

{% file src="/scripts/content_filter.py";base64,Cg==" name="content_filter.py" %}
{% file src="/scripts/geoip.py";base64,Cg==" name="geoip.py" %}
{% file src="/scripts/iplist.py";base64,Cg==" name="iplist.py" %}
{% file src="/scripts/suricata.py";base64,Cg==" name="suricata.py" %}

2\. Обновите базы модулей безопасности:

* Перенесите папку со скачанными файлами баз на NGFW - `scp -r <путь до папки со скачанными файлами> administrator@<IP-адрес NGFW>:~/`;
* Подключитесь к серверу по SSH - `ssh administrator@<IP-адрес NGFW>`;
* Перед обновлением модулей перейдите в директорию - `cd ~/<название папки со скачанными файлами>`;
* Обновите базы модулей безопасности, выполнив команды:
  * Базы модуля **Предотвращения вторжений** - `python3 geoip.py ideco-geoip.mmdb`;
  * Базы соответствия подсетей и стран - `python3 iplist.py iplist.tar.gz`;
  * Правила фильтрации модуля **Предотвращение вторжений** - `python3 suricata.py suricata-rules.tar`;
  * Базы модуля **Контент-фильтр** - `python3 content_filter.py sky-db-from-0.sst`.
