# Ошибка при открытии сайта ERR\_CONNECTION\_TIMED\_OUT или Не открывается сайт

Перед проверкой модулей фильтрации NGFW убедитесь, что на работу сайта не влияют:
* технические проблемы на самом ресурсе;
* блокировка со стороны провайдера;
* некорректная работа устройства пользователя и т.д.

Откройте сайт с устройства вне локальной сети NGFW. Например, со смартфона через мобильный интернет. Если сайт доступен, перейдите в веб-интерфейс NGFW.

{% hint style="info" %}
Для определения модуля фильтрации, блокирующего сайт, можно проверить логи в разделах [Системный журнал](/settings/reports/logs.md) и [Syslog](/settings/reports/syslog.md). Это может помочь определить причину возникшей проблемы и более точно ее диагностировать.
{% endhint %}

### Шаг 1. Проверьте, открывается ли сайт в режиме **Разрешить интернет всем**

1\. Нажмите на ![](/.gitbook/assets/icon-help.png) в верхней правой части веб-интерфейса NGFW.

2\. Переведите опцию **Разрешить интернет всем** в положение **Включен**:

![](/.gitbook/assets/not-open.gif)

3\. Откройте сайт.

Если сайт не открывается, проверьте, откроется ли сайт на другом устройстве с того же IP-адреса:

* Если не открывается, рекомендуем обратиться к провайдеру. Скорее всего, провайдер блокирует IP-адрес или адрес сайта;

* Если сайт открывается, проверьте настройки устройства пользователя.

### Шаг 2. Проверьте, не блокируется ли сайт правилом [Контент-фильтра](/settings/access-rules/content-filter/)

1\. Откройте сайт с устройства пользователя.

2\. В NGFW перейдите в раздел **Отчеты и журналы -> Журнал веб-трафика** и посмотрите, какое правило блокирует сайт:

![](/.gitbook/assets/web-logs.png)

3\. Для поиска блокирующего правила также можно ввести URL сайта в строку поиска категорий **Контент-фильтра** на вкладке **Правила** в разделе **Правила трафика -> Контент-фильтр**:

![](/.gitbook/assets/content-filter3.gif)

4\. Если сайт блокируется правилом **Контент-фильтра**, измените его настройки или добавьте сайт в исключения в разделе **Сервисы -> Прокси** на вкладке **Исключения**:

<img src="/.gitbook/assets/exclusions1.png" alt="" data-size="original">

{% hint style="info" %}
В раздел **Сервисы -> Прокси -> Исключения** рекомендуем добавлять заведомо надежные сервисы.

Добавлять в исключения адреса клиентов вашей сети не рекомендуется, так как в этом случае их веб-трафик не будет фильтроваться правилами **Контент-фильтра** и не будет попадать в отчеты.
{% endhint %}

### Шаг 3. Проверьте, не блокирует ли сайт правило **Файрвола**

Найдите блокирующее правило одним из способов:

<details>
<summary>Первый способ. Счетчик срабатываний</summary> 

1\. Перейдите в раздел **Правила трафика -> Файрвол -> FORWARD**.

2\. Нажмите на **Отображение** и включите **Счетчик срабатываний**:

![](/.gitbook/assets/firewall6.png)

3\. Откройте сайт с устройства пользователя. 

4\. Найдите в таблице FORWARD правило с заметным увеличением количества срабатываний.

</details>

<details>
<summary>Второй способ. Тестовое правило</summary> 

1\. Перейдите в раздел **Правила трафика -> Файрвол -> FORWARD**.

2\. Создайте тестовое правило, разрешающее любой трафик:

![](/.gitbook/assets/firewall11.png)

3\. Правило добавится в конец таблицы. Поместите созданное правило на одну позицию вверх, нажав на кнопку ![](/.gitbook/assets/icon-arrow-up.png).

4\. Откройте сайт с устройства пользователя.

5\. Если сайт не открывается, поднимите тестовое правило на позицию выше и повторно откройте сайт с устройства пользователя. Повторяйте эти действия до тех пор, пока сайт не откроется.

6\. Если сайт открывается, блокирующее правило расположено ниже тестового.

</details>

#### Если блокирующее правило направляет трафик через систему [Предотвращения вторжений](/settings/access-rules/ips/README.md):

1\. Перейдите в раздел **Отчеты и журналы -> События безопасности** на вкладку **Журнал IPS** и найдите в таблице ID сигнатуры, заблокировавшей сайт, и название профиля, к которому она относится:

![](/.gitbook/assets/ips1.png)

2\. Перейдите в раздел **Профили безопасности -> Предотвращение вторжений**, нажмите на ![](/.gitbook/assets/icon-edit.png) напротив профиля, заблокировавшего сайт, и выберите **Сигнатуры**.

3\. Нажмите **Добавить сигнатуру** и выберите способ **Вручную**.

4\. В таблице сигнатур по ID найдите сигнатуру (или сигнатуры), заблокировавшую сайт, и переопределите действие для нее:

![](/.gitbook/assets/ips2.png)

5\. Нажмите **Добавить** и переместите только что созданное правило на самый верх таблицы правил профиля:

![](/.gitbook/assets/ips3.png)

#### Если блокирующее правило направляет трафик через [Контроль приложений](/settings/security-profiles/application-control/README.md):

1\. Перейдите в раздел **Отчеты и журналы -> Трафик**.

2\. В виджете **Топ заблокированных протоколов** найдите протоколы, которые блокируются **Контролем приложений**.

3\. Перейдите в раздел **Профили безопасности -> Контроль приложений** и отредактируйте профиль, разрешив заблокированные протоколы.

### Шаг 4. Определите блокируемый домен или IP-адрес (рассмотрим на примере FireFox)

1\. Откройте в браузере нужный сайт.

2\. Откройте инструменты веб-разработчика одним из способов:

* Нажмите Ctrl+Shift+I;
* Нажмите на ![](/.gitbook/assets/icon-strips.png) в правом верхнем углу браузера, перейдите в раздел **Другие инструменты -> Инструменты веб-разработчика**.

3\. Выберите вкладку **Сеть**.

4\. Обновите страницу.

5\. Отсортируйте столбец **Статус** левой кнопкой мыши. Обратите внимание на коды состояния 4xx и 5хх. Часто именно эти запросы блокируются NGFW.

### Если решить проблему не удалось

Отправьте в техподдержку:

1\. Скриншот ошибки в браузере;

2\. Скриншот отсортированных ошибок из браузера, чтобы было видно проблемные домены или IP-адреса.
