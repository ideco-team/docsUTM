# Ошибка при открытии сайта ERR\_CONNECTION\_TIMED\_OUT или Не открывается сайт

Перед проверкой модулей фильтрации NGFW убедитесь, что на работу сайта не влияют:
* технические проблемы на самом ресурсе;
* блокировка со стороны провайдера;
* некорректная работа устройства пользователя и т.д.

Откройте сайт с устройства вне локальной сети NGFW. Например, со смартфона через мобильный интернет. Если сайт доступен, перейдите в веб-интерфейс NGFW.

### Шаг 1. Проверьте, открывается ли сайт в режиме **Разрешить интернет всем**

1\. Нажмите на ![](/.gitbook/assets/icon-help.png) в верхней правой части веб-интерфейса NGFW.

2\. Переведите опцию **Разрешить интернет всем** в положение **Включен**:

![](/.gitbook/assets/not-open.gif)

3\. Откройте сайт.

Если сайт не открывается, проверьте, откроется ли сайт на другом устройстве с того же IP-адреса:

* Если не открывается, рекомендуем обратиться к провайдеру. Скорее всего, провайдер блокирует IP-адрес или адрес сайта;

* Если сайт открывается, проверьте настройки устройства пользователя.

### Шаг 2. Проверьте, не блокирует ли сайт модуль [Контроль приложений](/settings/access-rules/application-control.md)

Если сайт входит в [перечень](/settings/access-rules/application-control.md#opisanie-protokolov-i-servisov-dostupnykh-dlya-sozdaniya-pravil) протоколов и сервисов, доступных для создания правил **Контроля приложений**, выполните действия:

1\. Перейдите в раздел **Правила трафика -> Контроль приложений**.

2\. Введите название протокола или сервиса в поле **Поиск** или установите настройки фильтрации с помощью кнопки **Фильтры**:

![](/.gitbook/assets/application-control13.png)

3\. В настройках фильтрации выберите столбцы **Протоколы**, в поле **Значение** выберите нужный протокол приложения:

![](/.gitbook/assets/application-control17.png)

4\. Проверьте, блокируют ли сайт найденные правила (действие **Запретить**).

5\. Если сайт блокируется правилом **Контроля приложений**, отредактируйте правило или добавьте сайт в исключения в разделе **Правила трафика -> [Исключения](/settings/access-rules/ips/user-ip-exceptions.md)**:

![](/.gitbook/assets/exceptions1.png)

### Шаг 3. Проверьте, не блокирует ли сайт система [Предотвращения вторжений](/settings/access-rules/ips/README.md)

1\. Повторите попытку входа на сайт с устройства пользователя.

2\. Перейдите в раздел **Правила трафика -> Предотвращение вторжений -> Журнал**, найдите в логах ID блокирующего правила:

![](/.gitbook/assets/ips10.png)

3\. Если сайт блокируется системой **Предотвращения вторжений**, добавьте блокирующее правило в исключения. Для этого нажмите ![](/.gitbook/assets/icon-lock.png) в столбце ID или добавьте правило на вкладке **Исключения из правил**:

<img src="/.gitbook/assets/ips11.png" alt="" data-size="original">

Также можно добавить IP-адрес сайта в исключения по [инструкции](/settings/access-rules/ips/README.md#kak-isklyuchit-uzel-iz-obrabotki-sistemoi-ids-ips).

### Шаг 4. Проверьте, не блокируется ли сайт правилом [Контент-фильтра](/settings/access-rules/content-filter/README.md)

1\. Откройте сайт с устройства пользователя.

2\. В NGFW перейдите в раздел **Отчеты и журналы -> Журнал веб-доступа** и посмотрите, какое правило блокирует сайт:

![](/.gitbook/assets/web-logs.png)

3\. Для поиска блокирующего правила также можно ввести URL сайта в строку поиска категорий **Контент-фильтра** на вкладке **Правила** в разделе **Правила трафика -> Контент-фильтр**:

![](/.gitbook/assets/content-filter3.gif)

4\. Если сайт блокируется правилом **Контент-фильтра**, измените его настройки или добавьте сайт в исключения в разделе **Сервисы -> Прокси** на вкладке **Исключения**:

<img src="/.gitbook/assets/exclusions1.png" alt="" data-size="original">

{% hint style="info" %}
В раздел **Сервисы -> Прокси -> Исключения** рекомендуем добавлять заведомо надежные сервисы.

Добавлять в исключения адреса клиентов вашей сети не рекомендуется, так как в этом случае их веб-трафик не будет фильтроваться правилами **Контент-фильтра** и не будет попадать в отчеты.
{% endhint %}

### Шаг 5. Проверьте, не блокируется ли сайт правилом [Файрвола](/settings/access-rules/firewall.md)

Найдите блокирующее правило одним из способов:

<details>

<summary>Первый способ. Счетчик срабатываний</summary>

1\. Перейдите в раздел **Правила трафика -> Файрвол -> FORWARD**.

2\. Нажмите на **Отображение данных** и включите **Счетчик срабатываний**:

![](/.gitbook/assets/firewall3.png)

3\. Откройте сайт с устройства пользователя.

4\. Найдите в таблице FORWARD правило с заметным увеличением количества срабатываний.

</details>

<details>

<summary>Второй способ. Тестовое правило</summary>

1\. Перейдите в раздел **Правила трафика -> Файрвол -> FORWARD**.

2\. Создайте тестовое правило, разрешающее любой трафик:

![](/.gitbook/assets/firewall17.png)

3\. Правило добавится в конец таблицы. Поместите созданное правило на одну позицию вверх, нажав на кнопку ![](/.gitbook/assets/icon-up.png).

4\. Откройте сайт с устройства пользователя.

5\. Если сайт не открывается, поднимите тестовое правило на позицию выше и повторно откройте сайт с устройства пользователя. Повторяйте эти действия до тех пор, пока сайт не откроется.

6\. Если сайт открывается, блокирующее правило расположено ниже тестового.

</details>

Если сайт блокируется правилом **Файрвола**, измените его настройки.

### Шаг 6. Определите блокируемый домен или IP-адрес (рассмотрим на примере FireFox)

1\. Откройте в браузере нужный сайт.

2\. Откройте инструменты веб-разработчика одним из способов:

* Нажмите Ctrl+Shift+I;
* Нажмите на ![](/.gitbook/assets/icon-strips.png) в правом верхнем углу браузера, перейдите в раздел **Другие инструменты -> Инструменты веб-разработчика**.

3\. Выберите вкладку **Сеть**.

4\. Обновите страницу.

5\. Отсортируйте столбец **Статус** левой кнопкой мышки. Обратите внимание на коды состояния 4xx и 5хх. Часто именно эти запросы блокируются NGFW.

### Если решить проблему не удалось

Отправьте в техподдержку:

1\. Скриншот ошибки в браузере;

2\. Скриншот отсортированных ошибок из браузера, чтобы было видно проблемные домены или IP-адреса.