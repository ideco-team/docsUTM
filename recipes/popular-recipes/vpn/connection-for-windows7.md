# Инструкция по созданию подключения в Windows 7

{% hint style="info" %}
Перед настройкой VPN-подключения, в дереве пользователей в карточке нужных пользователей и установите флаг **Разрешить удаленный доступ через VPN**. Для этого перейдите в раздел **Пользователи -> Учетные записи**:

<img src="../../../../.gitbook/assets/ubuntu15.png" alt="" data-size="original">
{% endhint %}

## Создание VPN-подключения в Windows 7

Перед созданием VPN-подключения для протоколов SSTP, L2TP и IKEv2, следует установить корневой сертификат локально на компьютер:

1\. Скачайте корневой сертификат Let's Encrypt по ссылке [https://letsencrypt.org/certs/isrgrootx1.pem](https://letsencrypt.org/certs/isrgrootx1.pem);

2\. Нажмите **Пуск** найдите и запустите mmc.exe;

3\. Нажмите **Файл -> Добавить или удалить оснастку**:

![](../../../../.gitbook/assets/windows7-12.png),

4\. Выберите **Сертификаты** и нажмите **Добавить**:

![](../../../../.gitbook/assets/windows7-13.png)

5\. Установите флаг в строке **учетной записи компьютера**, нажмите **Далее -> Готово -> ОК**:

![](../../../../.gitbook/assets/windows7-14.png)

6\. В окне Консоль появится пункт **Сертификаты (локальный компьютер)**:
* Выберите его и нажмите правой кнопкой мыши на пункте **Доверенные корневые центры сертификации**;
* Далее **Все задачи -> Импорт**
* В окне **Мастер импорта сертификатов** нажмите **Далее -> Обзор -> Выберите скачанный в пункте 1 -> Далее -> Далее -> Готово**.

**Создание VPN-подключения**

Вам потребуется доменное имя вашего сервера (можно получить у системного администратора) и учетные данные пользователя (логин/пароль).

1\. Откройте **Центр управления сетями и общим доступом**:

<img src="../../../../.gitbook/assets/windows7.png" alt="" data-size="original">

2\. Выберите **Настройка нового подключения или сети**:

![](../../../../.gitbook/assets/windows7-2.png)

3\. Выберите **Подключение к рабочему месту**:

<img src="../../../../.gitbook/assets/windows7-3.png" alt="" data-size="original">

4\. Выберите **Использовать мое подключение к Интернету (VPN)**:

<img src="../../../../.gitbook/assets/windows7-4.png" alt="" data-size="original">

5\. Введите доменное имя сервера в качестве адреса подключений. Имя местоназначения может быть произвольным:

<img src="../../../../.gitbook/assets/windows7-5.png" alt="" data-size="original">

6\. Введите ваш _логин_ и _пароль_:

<img src="../../../../.gitbook/assets/windows7-6.png" alt="" data-size="original">

7\. Нажмите **Закрыть**:

<img src="../../../../.gitbook/assets/windows7-7.png" alt="" data-size="original">

8\. Выберите **Подключение к IKEv2 VPN серверу** в Windows 7:

<img src="../../../../.gitbook/assets/windows7-8.png" alt="" data-size="original">

9\. Выберите **Свойства**:

<img src="../../../../.gitbook/assets/windows7-9.png" alt="" data-size="original">

10\. Выберите протокол **IKEv2** и **обязательное шифрование**:

<img src="../../../../.gitbook/assets/windows7-10.png" alt="" data-size="original">

11\. Подключитесь к IKEv2 VPN серверу в Windows 7:

<img src="../../../../.gitbook/assets/windows7-11.png" alt="" data-size="original">



## Ошибки работы VPN-подключений

<details>

<summary>Если VPN-подключение по протоколам IPSeс в Windows автоматически разрывается через 7 часов 45 минут и при подключении по IKEv2 возникает ошибка "Ошибка сопоставления групповой политики" или ошибка с кодом "13868"</summary>

Для восстановления связи подойдут следующие действия:

1\. Переподключите соединение. В данном случае соединение восстановится, но через 7 часов 45 минут вновь будет автоматически разорвано. Если вы хотите, чтобы подключение не разрывалось автоматически, то выполните действия из следующего пункта.

2\. Внесите изменения в реестр:

* Откройте **Редактор реестра**.
* Перейдите по пути `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RasMan\Parameters`.
* Нажмите правой кнопкой мыши по параметру именем **NegotiateDH2048\_AES256** и нажмите **Изменить**.
* В строке **Значение** укажите значение `1`:

<img src="../../../../.gitbook/assets/windows-vpn.png" alt="" data-size="original">

* Нажмите **OK**.
*   Перезагрузите Windows.

    Если параметра именем **NegotiateDH2048\_AES256** нет, то создайте его. Для этого:
* Нажмите правой кнопкой мыши по свободному месту реестра в **Parameters** и выберите **Создать -> DWORD**:

<img src="../../../../.gitbook/assets/windows-vpn2.png" alt="" data-size="original">

* Задайте имя **NegotiateDH2048\_AES256**.
* Нажмите правой кнопкой мыши по созданному файлу и выберите **Изменить**:

<img src="../../../../.gitbook/assets/windows-vpn3.png" alt="" data-size="original">

* В строке **Значение** укажите значение `1`:

<img src="../../../../.gitbook/assets/windows-vpn4.png" alt="" data-size="original">

* Нажмите **OK**.

3\. Перезагрузите Windows.

</details>

{% hint style="info" %}
Если вы не хотите, чтобы после подключения по VPN интернет-трафик до внешних ресурсов ходил через Ideco UTM, то в свойствах VPN-подключения **Сеть/Протокол интернета TCP/IP версии 4/Дополнительно** уберите галочку **Использовать основной шлюз в удаленной сети**. Далее, чтобы получить доступ к компьютерам за Ideco UTM, вручную пропишите маршруты.
{% endhint %}