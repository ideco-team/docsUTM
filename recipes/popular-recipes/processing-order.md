# Порядок обработки веб-трафика в Ideco NGFW

Порядок обработки веб-трафика:

1\. Ограничение скорости;

2\. DNS;

3\. Захват трафика для фильтрации (прокси-сервер):

* Контент-фильтр;
* Антивирус веб-трафика.

4\. Файрвол;

5\. Контроль приложений;

6\. Система Предотвращения вторжений.

{% hint style="info" %}
INPUT-правила Файрвола обрабатывают трафик раньше прокси-сервера.
{% endhint %}

{% hint style="warning" %}
В 18 версии в модули **Контроль приложений** и **Предотвращение вторжений** отправится только тот трафик, который попадает под разрешающее правило **Файрвола** с включенной проверкой через профиль контроля приложений и профиль предотвращения вторжений соответственно.
{% endhint %}

## Как проверить, что Контент-фильтр обрабатывает трафик приоритетнее, чем Антивирус веб-трафика?

Для примера использовался тестовый файл с Eicar, доступный для скачивания по [ссылке](https://secure.eicar.org/eicar.com.txt).

1\. Перейдите в раздел **Правила трафика -> Контент-фильтр -> Пользовательские категории**. Нажмите **Добавить**.

2\. Введите ссылку на ресурс и нажмите ![](/.gitbook/assets/icon-add.png):

![](/.gitbook/assets/content-filter14.png)

3\. Перейдите на вкладку **Правила** и создайте два правила для **User1**:

* Правило расшифровки всех HTTPS-запросов, чтобы антивирус мог работать с HTTPS-трафиком;
* Правило блокировки созданной пользовательской категории:

![](/.gitbook/assets/content-filter15.png)

4\. Убедитесь, что опция **Антивирус** переведена в положение **Включен**.

5\. Авторизуйте пользователя и перейдите по ссылке на скачивание Eicar.\
Откроется страница блокировки **Контент-фильтра**:

![](/.gitbook/assets/processing-order.png)

**Контент-фильтр** обрабатывает трафик приоритетнее, чем антивирусы. Просмотреть информацию о срабатывании правил **Контент-фильтра** можно в **Отчеты -> Трафик -> Топ сайтов**.

## Как проверить, что Контент-фильтр обрабатывает трафик приоритетнее, чем Файрвол?

Для примера заблокируем пользователю `user` сайт `rts.rs`.

1\. Перейдите в раздел **Правила трафика -> Файрвол**, на вкладку **FORWARD** и нажмите **Добавить**.

2\. Заполните поля:

![](/.gitbook/assets/firewall45.png)

* **Протокол** - выберите **Любой**;
* **Адрес** источника - выберите пользователя `user`;
* **Адрес** назначения - выберите страну **Сербия**;
* **Действие** - выберите **Запретить**.

3\. Нажимити **Добавить**.

4\. Перейдите в раздел **Контент-фильтр** на вкладку **Пользовательские категории** и нажмите на ![](/.gitbook/assets/icon-edit.png) напротив категории **Запрещенные сайты**.

5\. Добавьте ссылку на сайт `rts.rs` и нажмите **Сохранить**:

![](/.gitbook/assets/content-filter29.png)

6\. Убедитесь, что в таблице правил **Контент-фильтра** включено правило запрета для категории **Запрещенные сайты**.

7\. Авторизуйте пользователя и перейдите на сайт `rts.rs`.\
Откроется страница блокировки **Контент-фильтра**:

![](/.gitbook/assets/processing-order1.png)

**Контент-фильтр** обрабатывает трафик приоритетнее, чем **Файрвол**.