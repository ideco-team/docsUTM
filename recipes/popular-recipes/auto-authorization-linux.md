---
description: >-
    Процесс автоматической аутентификации пользователя на Ideco NGFW с помощью скрипта при входе в систему.
---

## Инструкция по настройке автоматической веб-аутентификации на Ideco NGFW

Для настройки автоматической аутентификации выполните действия:

1\. Перейдите в домашнюю директорию пользователя (Home) и включите отображение скрытых файлов.

2\. Перейдите в папку `.config` и создайте там каталог `ideco-utm`.

3\. Скачайте корневой сертификат NGFW (подробнее в [статье](/installation/initial-setup.md)) и поместите его в каталог, созданный на предыдущем шаге.

4\. Создайте в папке `ideco-utm` файл `auth.conf`. Откройте его, введите логин и пароль пользователя по образцу:

```
login=логин_пользователя
password=пароль_пользователя
```

5\. Скачайте скрипт на компьютер пользователя и настройте автозагрузку в соответствии с описанным ниже алгоритмом:

{% file src="/scripts/auto-web-auth-linux.py";base64,Cg==" name="auto-web-auth-linux.py" %}

{% hint style="warning" %}
Для корректной работы скрипта имя корневого сертификата должно быть `root_ca.crt`.
{% endhint %}

## Настройка автозагрузки скрипта

Для настройки выясните возможность добавления приложений в автозагрузку через графический интерфейс. При отсутствии такой возможности настройте автозагрузку через терминал.

{% hint style="info" %}
Для настройки через терминал потребуются права администратора.
{% endhint %}

### Настройка через терминал:

{% hint style="info" %}
Если сделать скрипт исполняемым файлом с помощью команды `chmod +x <путь до скрипта>`, можно не указывать путь до python.
{% endhint %}

1\. Откройте терминал и введите команду:

```
sudo nano /etc/systemd/system/auto-authorization.service
```

2\. Заполните файл следующим образом:

```
[Unit]
Description=Auto-Authorization

[Service]
Type=simple
User=имя_пользователя_в_системе
ExecStart=полный_путь_до_python полный_путь_до_скрипта

[Install]
WantedBy=multi-user.target
```
Введите имя пользователя Linux и полный путь до скрипта.

3\. Сохраните файл и выйдите из редактора.

4\. Добавьте службу в автозагрузку командой `systemctl enable auto-authorization`.

{% hint style="info" %}
Скрипт поддерживает множество ключей, с помощью которых можно менять путь к файлам и другие параметры. Для вывода справки утилиты используйте ключ `-h`.
{% endhint %}

{% hint style="info" %}
Для проверки статуса ранее настроенной службы введите `systemctl status auto-authorization.service`
{% endhint %}

Проверить работу настройки можно с помощью интерфейса Ideco NGFW. Зайдите в раздел **Мониторинг -> Авторизованные пользователи** и завершите сессию пользователя, для которого настраивалась автоматическая аутентификация. Чтобы удалить авторизованную сессию, нажмите на соответствующую пиктограмму и подтвердите свой выбор. 

![](/.gitbook/assets/monitor-connections7.png)

Если выйти из сессии на устройстве пользователя и повторно открыть браузер, то запрос на авторизацию появиться не должен.