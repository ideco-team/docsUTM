# Перенос данных и настроек на другой сервер

Чтобы перенести установленный Ideco NGFW с одного сервера на другой с сохранением всех настроек, установите Ideco NGFW на новый сервер и выполните шаги по переносу данных. 

{% hint style="info" %}
Подробную инструкцию по установке можно найти в разделе [Процесс установки](/installation/installation-process.md)
{% endhint %}

### Создание бэкапа

1\. На вкладке **Управление сервером -> Бэкапы -> Бэкапы** создайте бэкап настроек сервера.

2\. Загрузите созданную копию, нажав на кнопку ![](/.gitbook/assets/icon-download.png) в столбце **Управление**.

### Перенос бэкапа на новый сервер

{% hint style="info" %}
В разделе **Сервисы -> Сетевые интерфейсы** на новом сервере посмотрите и запишите MAC-адрес локальной сетевой карты, он потребуется для перенастройки локального интерфейса в дальнейшем.
{% endhint %}

1\. На вкладке **Управление сервером -> Бэкапы -> Бэкапы** нажмите кнопки **Добавить -> Загрузить из файла** и выберите выгруженный на первом этапе бэкап.

2\. Нажмите кнопку ![](/.gitbook/assets/icon-recovery.png) в столбце **Управление**. Система будет перезагружена для применения настроек сервера.

### Настройка восстановленного сервера

{% hint style="info" %}
После перезагрузки Ideco NGFW, восстановленного из бэкапа, веб-интерфейс будет недоступен, поскольку ни один локальный интерфейс не будет настроен.
{% endhint %}

1\. Перейдите в **Локальное меню**, введите логин и пароль.

2\. Выберите сетевую карту с MAC-адресом, который записали ранее, и настройте интерфейс.

![](/.gitbook/assets/transferring-data-to-another-server.png)

3\. Перейдите в веб-интерфейс в раздел **Сервисы -> Сетевые интерфейсы**. Настройте интерфейсы, восстановленные из бэкапа, привязав к ним сетевые карты:

![](/.gitbook/assets/interfaces9.png)

4\. Проверьте:

* В разделе **Сервисы -> Защита и управление DNS** - выданные подключению внешние DNS-серверы;
* В разделе **Сервисы -> DHCP** - опции DHCP-сервера;
* В разделе **Сервисы -> OSPF** - настройки интерфейсов;
* В разделе **Правила трафика -> Файрвол** - зоны источника и зоны назначения в правилах;
* На вкладке **Сервисы -> Маршрутизация -> Внешних сетей** - правила маршрутизации.

### Привязка лицензии к новому серверу

Если сервер переносится из-за неисправности старого, необходимо перепривязать лицензию.

1\. Перейдите в личный кабинет [MY.IDECO](https://my.ideco.ru/).

2\. Отвяжите лицензию от неисправного сервера, нажав на ![](/.gitbook/assets/icon-unbind.png).

3\. Отвяжите demo-лицензию от нового сервера, нажав на ![](/.gitbook/assets/icon-unbind.png).

4\. Привяжите enterprise-лицензию к новому серверу, нажав **Привязать лицензию**.

{% hint style="warning" %}
При подключении к Ideco Center клон сервера, восстановленный из бэкапа, не появится в таблице серверов Ideco Center. Изменится только **Последнее подключение** в строке неисправного сервера. Это происходит из-за конфликта с донором бэкапа, если у них одинаковый cluster_id. Сервер-клон подменяет собой уже подключенный Ideco NGFW.
В случае возникновения такой проблемы обратитесь в [Техническую поддержку](/general/technical-support.md).
{% endhint %}

## Перенос данных почтового сервера

1\. Скопируйте всю почту из папки `/var/mail/` на внешнее хранилище. Это можно сделать с помощью различных программ для копирования файлов между локальным компьютером и удаленным сервером (например: rsync, WinSCP, scp от ssh и др.).

2\. Установите с загрузочного образа последнюю версию Ideco NGFW на физический диск.

3\. Подключите второй физический диск, который будет использоваться для хранения почты.

4\. В веб-интерфейсе Ideco NGFW перейдите в раздел **Почтовый релей -> Основные настройки**, выберите диск для хранения почты и отформатируйте его.

5\. Разрешите доступ по SSH из локальных сетей в разделе **Управление сервером -> Администраторы**.

6\. Подключитесь к NGFW, например, с помощью программы WinSCP и выгрузите всю скопированную почту по пути `/var/spool/mail/`.

7\. По окончании выгрузки файлов почты выполните команду:

```
chown -R ideco-mail-backend:ideco-mail-backend /var/spool/mail/
```

{% hint style="info" %}
Команда выше меняет владельца и группу для файлов почты, чтобы почтовый демон `dovecot` мог иметь доступ к этим файлам.
{% endhint %}