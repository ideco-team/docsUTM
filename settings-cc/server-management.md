# Управление сервером

## Администраторы

В Ideco Center вы можете создать локальных администраторов или интегрировать администраторов из RADIUS-сервера. Добавление администраторов в Ideco Center аналогично механизму в [Ideco NGFW](../settings/server-management/admins.md).

Локальным администраторам могут быть назначены роли:

* **Администратор** - имеет доступ ко всем функциям Ideco Center;
* **Только просмотр** - не имеет возможности управлять правилами в Ideco Center (создавать, менять приоритет и др.);
* **Администратор информационной безопасности** - имеет доступ к собятиям безопасности;
* **Администратор файрвола** - может создавать учетные записи, настраивать правила фильтрации и управлять режимами работы **Файрвола**;
* **Администратор настройки доступов** - имеет доступ к настройкам сетевого взаимодействия пользователей **Файрвола**, субъектов доступа, информационных систем.

{% hint style="info" %}
Удалять подключенный Ideco NGFW из Ideco Center могут только администраторы с ролью **Администратор**.
{% endhint %}

Войти в подключенный Ideco NGFW с логином и паролем администратора Ideco Center **невозможно**.

### Доступ к веб-интерфейсу из внешней сети и удаленный доступ по SSH

Для получения доступа к Ideco Center по SSH из локальной сети включите опцию. Доступ осуществляется по 22 TCP-порту. Попытки подбора паролей будут автоматически блокироваться.

![](../.gitbook/assets/cc-admins1.png)

## Обновления

Обновить систему Ideco Center можно как в офлайн-режиме, так и по сети. Настроить режим обновления можно в **Управление сервером -> Обновления**.

{% hint style="warning" %}
Для отключения автоматического обновления Ideco Сenter в строке **Отложить обновление** выберите **Навсегда**.
{% endhint %}

### Автоматическое обновление

В режиме **Автоматического обновления** доступны следующие настройки:

![](../.gitbook/assets/cc-updates.png)

<details>

<summary>Расшифровка полей</summary>

* **Канал автоматических обновлений** - выберите **Релиз** или **Тестовый**. Канал **Релиз** позволяет обновляться на стабильно работающие версии. Канал **Тестовый** позволяет быстрее обновляться как на релизные версии, так и на последние бета-версии продукта во время коротких периодов бета-тестирования новых мажорных версий. По умолчанию выбран пункт **Релиз**;
* **Отложить обновления** - время, на которое будет отложено обновление (максимальный срок - шесть месяцев с даты релиза последней версии, до которой доступно обновление);
* **День недели** - день недели запуска автоматического обновления;
* **Час автоматической перезагрузки** - позволяет выбрать час запуска автоматического обновления;
* **Запустить обновление** - запускает механизм принудительного обновления. Если кнопка неактивна, обновления отсутствуют.

</details>

### Ручное обновление

В режиме **Ручной загрузки** обновлений необходимо скачать ISO-образ новой версии Ideco Center в личном кабинете MY.IDECO и загрузить его с внешнего носителя:

![](../.gitbook/assets/cc-updates1.png)

{% hint style="info" %}
Кнопка принудительного обновления активна только после скачивания обновления и позволяет его применить. Скачивание нельзя инициировать. После применения обновления потребуется полная перезагрузка сервера.
{% endhint %}

После обновления новая версия будет отображаться в верхнем левом углу локального меню и веб-интерфейса Ideco Center.

### Восстановление на предыдущую версию

![](../.gitbook/assets/updates2.png)

Кнопка **Восстановить** позволяет вернуться к предыдущей версии Ideco Center. Система будет перезагружена, при этом текущие настройки будут потеряны. После восстановления отложите автоматическое обновление.

{% hint style="warning" %}
При восстановлении на предыдущую версию данные перенесены не будут. Сохраните информацию на внешнем носителе.
{% endhint %}

### Процесс выхода релизов в каналы обновлений

**Тестовый** канал обновлений позволяет быстрее обновляться до новых версий (релизных или бета-версий во время их активного тестирования). После выхода бета-версии Ideco Center в **Тестовый** канал ожидается обратная связь от пользователей по использованию новой версии продукта через [Telegram](https://t.me/idecoutm). Обратная связь позволяет выявить недочеты и уязвимости в продукте. После их исправления происходит выкладка в канал **Релиз**.

{% hint style="info" %}
Если в версии Ideco Center, вышедшей в канал **Релиз**, в ходе использования выявляются недочеты, то они исправляются ближайшими обновлениями версии. Обновление в канале **Релиз** появляется постепенно.
{% endhint %}

### Особенности обновления Ideco Center

* Обновление будет автоматически установлено в указанное в настройках время после релиза новой версии.
* Обновления можно отложить на срок до шести месяцев или навсегда. Если отложить обновление на определенный срок, то период будет отсчитываться от **даты релиза** последнего доступного обновления и корректироваться в соответствии с указанным для обновления днем недели.
* Даты релизов можно посмотреть на [сайте](https://ideco.ru/changelog) или в документации в разделе [Changelog](../changelog/ideco-utm/).
* Номер мажорной версии Ideco Center - часть номера до точки (например, 14.x), номер минорной версии - часть после точки (например, x.7).

{% hint style="warning" %}
Если обновление было отложено на шесть месяцев, но за это время вышел новый минорный релиз, дата обновления сдвигается. Шесть месяцев теперь отсчитываются с даты выхода последнего доступного минорного релиза.
{% endhint %}

## Бэкапы

Бэкап - это предварительно созданная резервная копия данных, позволяющая восстановить большинство настроек и сохраненной информации.

В Ideco Center создается только полный бэкап, который включает в себя все настройки, созданные администратором в веб-интерфейсе.

Бэкапы не включают:

* Системный журнал;
* Любые данные, автоматически генерируемые в процессе работы системы.

В Ideco Center бэкап создается как автоматически, так и вручную.

### Автоматическое создание бэкапа

Для настройки автоматического бэкапа перейдите в **Управление сервером -> Бэкапы -> Настройки**:

![](../.gitbook/assets/backup.png)

Установите время ежедневного создания и продолжительность хранения бэкапа на локальном жестком диске. При настройке выгрузки на сетевое файловое хранилище автоматический бэкап будет также дублироваться туда.

* **Время ежедневного создания копии** - укажите в настройках час (рекомендуется выбирать ночное время для создания бэкапа);
* **Хранить в течение** - хранить бэкапы на локальном жестком диске можно в течение недели или месяца.

{% hint style="info" %}
Каждый автоматически созданный бэкап сохраняется в таблице бэкапов с комментарием "Автоматическая резервная копия".
{% endhint %}

Рекомендуется хранить бэкапы не только на локальном жестком диске, но и на внешних носителях. Ideco Center предоставляет возможность выгружать бэкапы:

* на сетевое файловое хранилище по протоколу FTP;
* на сетевое файловое хранилище по протоколу NetBIOS (CIFS);
* на ПК через кнопку **Скачать** в таблице бэкапов (![](../.gitbook/assets/download.png)) для переноса с сервера на иной внешний носитель вручную.

{% tabs %}
{% tab title="Бэкапы на cетевое файловое хранилище" %}
Ключевые параметры, необходимые для настройки бэкапа на **NetBIOS-сервер**:

* **Адрес сервера** - IP-адрес удаленного NetBIOS-сервера, на котором будут размещаться бэкапы;
* **Логин** - имя пользователя для авторизации на сетевом ресурсе Windows;
* **Пароль** - пароль для авторизации на сетевом ресурсе Windows;
* **Путь к каталогу** - каталог, в который будут записываться бэкапы.
{% endtab %}

{% tab title="Бэкапы на удаленное файловое хранилище" %}
Ключевые параметры, необходимые для настройки бэкапа на **FTP-сервер**:

* **Адрес сервера** - IP-адрес удаленного FTP-сервера, на котором будут размещаться бэкапы;
* **Логин** - имя пользователя для авторизации на FTP-сервере;
* **Пароль** - пароль для авторизации на FTP-сервере;
* **Путь к каталогу** - каталог, в который будут записываться бэкапы.
{% endtab %}
{% endtabs %}

{% hint style="info" %}
Укажите путь к каталогу в UNIX-формате. К примеру, в ОС Windows каталог открывается по пути `\\192.168.1.1\dir_1\dir_2\backup`, значит, в поле **Путь к каталогу** пропишите `dir_1/dir_2/backup`.
{% endhint %}

### Ручное создание бэкапа

<details>

<summary>Через веб-интерфейс</summary>

Для создания бэкапа через интерфейс Ideco Center перейдите в **Управление сервером -> Бэкапы -> Бэкапы** и выполните действия:

1\. Нажмите **Добавить -> Создать** или нажмите ![](../.gitbook/assets/icon-backup.png) **Создать бэкап** в правом верхнем углу веб-интерфейса.

2\. Введите комментарий и нажмите **Добавить**.

Новый бэкап появится в таблице:

<img src="../.gitbook/assets/backup4.png" alt="" data-size="original">

</details>

<details>

<summary>Через локальное меню</summary>

Чтобы создать новый бэкап через локальное меню Ideco Center, выполните действия:

1\. Выберите пункт **10. Создать новый бэкап** и нажмите **Enter**.

2\. Введите комментарий для бэкапа и нажмите **Enter**.

Пример создания бэкапа через локальное меню приведен на скриншоте ниже:

<img src="../.gitbook/assets/cc-local-menu1.png" alt="" data-size="original">

Настройка сохранения бэкапа в сетевом файловом хранилище возможна только через веб-интерфейс Ideco Center. Выгрузка на внешние сетевые хранилища производится только при автоматическом создании бэкапа.

</details>

### Восстановление конфигурации из бэкапа

В Ideco Center возможно полное и мгновенное восстановление из бэкапа.

При выполнении полного восстановления система будет перезагружена для применения настроек сервера.

При выполнении мгновенного восстановления бэкап применится без перезагрузки. При этом не сохраняется статистика в отчётах.

{% hint style="info" %}
Полное восстановление возможно либо на текущую версию, либо на предыдущую мажорную версию. Например, на версии 17 возможно полное восстановление бэкапа версии 16 или версии 17.

Мгновенное восстановление возможно только для бэкапа версии, полностью совпадающей с установленной на сервере.
{% endhint %}

<details>

<summary>Через веб-интерфейс</summary>

Перейдите в **Управление сервером -> Бэкапы -> Бэкапы** и нажмите кнопку **Полное восстановление** (![](../.gitbook/assets/icon-recovery.png)) или **Мгновенное восстановление** (![](../.gitbook/assets/mg-recovery.png)) в столбце **Управление**.

Также можно загрузить бэкап из файла. Например, в случае переноса с другого сервера. Для восстановления конфигураций бэкапа, который находится на внешнем носителе, перейдите в **Управление сервером -> Бэкапы -> Бэкапы**, нажмите на кнопку **Добавить** и выберите **Загрузить из файла**:

<img src="../.gitbook/assets/backup2.png" alt="" data-size="original">

</details>

<details>

<summary>Через локальное меню</summary>

Перейдите в локальное меню и выполните действия:

1\. Выберите пункт:

* **11. Восстановить из бэкапа** - восстановятся все настройки и перезагрузится сервер;
*   **12. Мгновенно восстановить из бэкапа** - восстановятся все настройки без перезагрузки сервера, кроме изменений в списке пользователей и отчетах.

    Нажмите **Enter**.

2\. Выберите из списка бэкап, введя пункт нужной копии, и нажмите **Enter**.

3\. Перезагрузите сервер при запуске полного восстановления, введя **y**, а затем **Enter**. При мгновенном восстановлении перезагрузка не нужна.

Пример восстановления из бэкапа через локальное меню:

<img src="../.gitbook/assets/cc-local-menu2.png" alt="" data-size="original">

Чтобы перенести установленный Ideco Center с одного сервера на другой с сохранением всех настроек, воспользуйтесь статьей [Перенос данных и настроек на другой сервер](../recipes/popular-recipes/transferring-data-to-another-server.md).

</details>

## Терминал

{% hint style="warning" %}
Используйте терминал только для диагностики. Воздержитесь от команд, изменяющих файлы. Система рассчитана на настройку только через веб-интерфейс. Компания "Айдеко" не несет ответственности за негативные последствия работы с Ideco Center из терминала. Техническая поддержка вправе отказать в обслуживании, если окажется, что работа системы была нарушена из-за действий пользователя в терминале.
{% endhint %}

### Основные команды

* **Утилиты сетевой диагностики:** `ping`, `host`, `nslookup`, `tracepath`, `tcpdump`, `arping`, `ss` (аналог `netstat`);
* **Файловый редактор:** `nano`;
* **Просмотр логов:** `journalctl -u <название службы>` (например, `journalctl -u ideco-routing-backend`);
* **Проверка скорости интернета:** `speedtest-cli`;
* **Просмотр ARP-таблицы:** `ip neigh show`;
* **Разблокировка в случае срабатывания защиты от брутфорс-атак:**
  * `fail2ban-client unban --all` - команда используется для снятия всех блокировок;
  * `fail2ban-client unban <IP-адрес>` - команда используется для разблокировки конкретного IP-адреса. Укажите нужный IP-адрес в качестве аргумента.
* **Просмотр конфигурации FRR:** `vtysh`.

<details>

<summary>Таблица служб</summary>

<table><thead><tr><th width="329">Раздел</th><th>Имя службы</th></tr></thead><tbody><tr><td>Серверы</td><td>ideco-servers-backend, ideco-servers-websocket</td></tr><tr><td>Файрвол</td><td>ideco-firewall-backend, ideco-firewall-rest</td></tr><tr><td>Контент-фильтр</td><td>ideco-content-filter-backend</td></tr><tr><td>Предотвращение вторжений</td><td>ideco-suricata-backend</td></tr><tr><td>Объекты</td><td>ideco-alias-backend</td></tr><tr><td>Сетевые интерфейсы</td><td>ideco-network-backend, ideco-network-nic</td></tr><tr><td>Маршрутизация</td><td>ideco-routing-backend, ideco-routing-rest</td></tr><tr><td>Обратный прокси</td><td>ideco-reverse-backend</td></tr><tr><td>Защита и управление DNS</td><td>ideco-dns-backend, unbound, nsd, unbound-anchor, unbound-keygen</td></tr><tr><td>DHCP-сервер</td><td>ideco-dhclient</td></tr><tr><td>NTP-сервер</td><td>chronyd</td></tr><tr><td>Кластеризация</td><td>ideco-cluster-backend</td></tr><tr><td>Обновления</td><td>ideco-sysupdate-backend</td></tr><tr><td>Бэкапы</td><td>ideco-backup-backend, ideco-backup-create</td></tr><tr><td>Лицензия</td><td>ideco-license-backend</td></tr><tr><td>Syslog</td><td>ideco-logs-backend, ideco-monitor-backend</td></tr><tr><td>Отчеты и журналы</td><td>ideco-logs-backend, ideco-logs-syncer</td></tr><tr><td>Действия администраторов</td><td>ideco-audit-backend</td></tr><tr><td>Авторизация администраторов</td><td>ideco-web-backend</td></tr><tr><td>Сертификаты</td><td>ideco-cert-backend</td></tr><tr><td>Локальное меню</td><td>ideco-local-menu</td></tr><tr><td>Дополнительно</td><td>ideco-system-backend</td></tr><tr><td>Сбор анонимной статистики о работе сервера</td><td>ideco-gatherstat-backend</td></tr><tr><td>Защита от несанкционированного доступа, в т.ч. от брутфорс-атак (brute force - атака полным перебором)</td><td>fail2ban</td></tr><tr><td>REST API NGFW</td><td>ideco-rest-api-backend</td></tr><tr><td>Доступ по SSH</td><td>sshd</td></tr></tbody></table>

</details>

## Дополнительно

Настройка осуществляется через веб-интерфейс в **Управление сервером -> Дополнительно**.

![](../.gitbook/assets/cc-additionally1.png)

<details>

<summary>Расшифровка полей</summary>

* **Сбор анонимной статистики о работе сервера** - включение этого параметра разрешает серверу отправлять информацию об используемых модулях. При этом не отправляется информация о пользователях, проходящем через сервер трафике, сетевых интерфейсах и идентификаторах сервера и лицензии;
* **Энергосберегающий режим** - включение этого режима снижает производительность процессора и обработки трафика;
* **Адрес Ideco Center** - поле заполняется, если сервер Ideco Center находится за NAT;
* **Настройка часового пояса** - изменения вступают в силу только после перезагрузки Ideco Center;
* **Настройки языка** - изменения вступают в силу только после перезагрузки Ideco Center;
* **Сбросить блокировки по IP** - используйте для сброса всех заблокированных IP-адресов. Если требуется разблокировать какой-то конкретный IP-адрес, воспользуйтесь командой `fail2ban-client unban <IP-адрес>` в терминале.

</details>
