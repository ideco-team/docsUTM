# Контроль приложений

## Что изменится с появлением профилей контроля приложений

В версиях 17.X весь FORWARD-трафик сначала проходит модуль **Контроль приложений**, а затем **Файрвол**.

В 18 версии в модуль **Контроль приложений** отправится только тот трафик, который попадает под разрешающее правило **Файрвола** с включенной проверкой через **Профиль контроля приложений** согласно настройкам. Очередность обработки трафика в версиях 17.X и в 18 версии:

{% tabs %}
{% tab title="Порядок обработки трафика в 17.Х" %}
1\. DNS;

2\. Захват трафика для DPI:

* Контроль приложений;
* Ограничение скорости;
* Система предотвращения вторжений.

3\. Захват трафика для фильтрации (прокси-сервер):

* Контент-фильтр;
* Антивирус веб-трафика.

4\. Файрвол.
{% endtab %}

{% tab title="Порядок обработки трафика в 18.Х" %}
1\. Ограничение скорости;

2\. DNS;

3\. Захват трафика для фильтрации (прокси-сервер):

* Контент-фильтр;
* Антивирус веб-трафика.

4\. Файрвол;

5\. Контроль приложений;

6\. Система предотвращения вторжений.
{% endtab %}
{% endtabs %}

{% hint style="info" %}
Принцип создания **Профилей контроля приложений** в 18 версии Ideco Center аналогичен принципу создания правил **Контроля приложений** в более ранних версиях: все протоколы и приложения, которые не были запрещены, остаются разрешены.
{% endhint %}

По сравнению с более ранними версиями в 18 версии поменялась последовательность обработки FORWARD-трафика. В предыдущих версиях FORWARD-трафик сначала проходит модуль **Контроль приложений**, а затем **Файрвол**. В 18 версии в модуль **Контроль приложений** отправляется только трафик, соответствующий разрешающему правилу **Файрвола** с включенной проверкой через **Контроль приложений**.

**Файрвол** Ideco Center анализирует трафик, чтобы найти подходящее правило, и применяет его. Если в списке есть несколько правил с одними и теми же условиями, применяется правило, стоящее выше по списку. Запрещающие правила **Файрвола** сразу блокируют соответствующий трафик и не проходит дополнительную проверку в модуле **Контроль приложений**.

Чтобы через модуль **Контроль приложений** проходил трафик, для которого нет разрешающего правила в таблице FORWARD, рекомендуем создать и включить в **Файрволе** правило с источником **Локальные интерфейсы** и назначением **Любой**, разместив его в конец таблицы. В этом случае трафик, который не был найден в правилах **Файрвола**, пройдет проверку **Контролем приложений**. Трафик, не учтенный правилами **Файрвола**, но запрещенный **Профилями контроля приложений**, будет заблокирован.

### Почему мы отказались от автоматической миграции

{% hint style="warning" %}
При обновлении с 17 версии Ideco Center на 18 версию раздел **Контроль приложений** будет доступен только для просмотра. Это поможет создать **Профили контроля приложений** в соответствии с ранее созданными правилами. В версии 18.1 раздел **Контроль приложений** полностью исчезнет. Подробнее о **Профилях контроля приложений** в [статье](/settings-cc/security-profiles).
{% endhint %}

От автоматической миграции решили отказаться из-за вероятности появления дубликатов правил **FORWARD** и усложнения администрирования таблицы: 
* **Контроль приложений** мог бы некорректно определить условия фильтрации, заданные администратором в 17 версии, и для одного правила в таблице **FORWARD** создать несколько профилей; 
* Все автоматически созданные профили безопасности были бы применены к существующим правилам **FORWARD**. А так как одному правилу **Файрвола** может соответствовать только один профиль безопасности, появились бы дубликаты.