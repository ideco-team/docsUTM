---
description: >-
  Статья описывает возможности дерева пользователей Ideco UTM VPP.
---

# Дерево пользователей и управление учетными записями

## Дерево пользователей

Дерево пользователей - это организованные в группы учетные записи пользователей. Уровень вложенности групп не ограничен. Дерево доступно в разделе **Пользователи -> Учетные записи**.

Пример дерева пользователей:

![](../../.gitbook/assets/user-tree.png)

Цвет пиктограммы пользователя зависит от состояния учетной записи пользователя:

<table><thead><tr><th width="75" align="center">Состояние учетной записи пользователя</th><th>Описание</th></tr></thead><tbody><tr><td align="center"><img src="../../../.gitbook/assets/icon-green.svg" alt="icon-green.svg"></td><td>В данный момент времени пользователь прошел процедуру авторизации, и ему был предоставлен доступ в Интернет</td></tr><tr><td align="center"><img src="../../../.gitbook/assets/icon-yellow.svg" alt="icon-yellow.svg"></td><td>В <a href="customization-of-users.md">настройках пользователей</a> выбран запрет на авторизацию</td></tr><tr><td align="center"><img src="../../../.gitbook/assets/icon-account.svg" alt="icon-account.svg"></td><td>В данный момент времени пользователь не прошел процедуру авторизации, и ему не был предоставлен доступ в Интернет</td></tr></tbody></table>

В дереве пользователей есть соответствующие кнопки, чтобы управлять группами и учетными записями:

|                                    Обозначение          | Описание                                       |
| :-----------------------------------------------------: | ---------------------------------------------- |
| ![](../../.gitbook/assets/icon-add-user.svg)            | Создать учетную запись пользователя            |
| ![](../../../.gitbook/assets/icon-folder.svg)           | Создать группу                                 |
| ![](../../../.gitbook/assets/icon-delete.svg)           | Удалить учетную запись пользователя или группу |

## Как создать учетную запись пользователя

Создать учетную запись пользователя можно в определенной группе или вне групп:
* **В определенной группе** - Выберите группу, нажмите кнопку **Создать пользователя** во вкладке **Основное** или ![](../../../.gitbook/assets/icon-add-user.svg) рядом с названием группы в дереве:
    ![](../../.gitbook/assets/user-tree.gif)
* **Вне групп** - Выберите группу **Все** в дереве пользователей и нажмите ![](../../../.gitbook/assets/icon-add-user.svg):
    ![](../../.gitbook/assets/user-tree1.gif)

Логин необходимо вводить латинскими символами в нижнем регистре, например: i.ivanov. 

{% hint style="success" %}
При заполнении **Дополнительных настроек** будет создано соответствующее правило в учетной записи во вкладке **IP и MAC авторизация** и в разделе **Авторизация -> IP и MAC-авторизация**. 
{% endhint %}

<details>

<summary>Рекомендации сложности паролей (можно автоматически сгенерировать пароль)</summary>

* минимальная длина - 10 символов; 
* использование строчных и заглавных латинских символов; 
* использование цифр и специальных символов. 

</details>

Для учетных записей, импортированных из MS Active Directory (AD), проверка пароля осуществляется средствами AD. Настройка авторизации пользователей Active Directory производится в разделе **Пользователи -> Active Directory**.

Создать пользователя Ideco UTM в группу Active Directory нельзя. Если требуется добавить дополнительного пользователя в группу Active Directory, это необходимо делать в дереве пользователей на контроллере домена.

{% hint style="warning" %}
Посмотреть или восстановить пароль учетной записи пользователя нельзя, допускается только его изменение.
{% endhint %}

<details>

<summary>Удаление учетной записи пользователя или группы</summary>

Для удаления учетной записи пользователя необходимо навести курсор на пользователя и нажать на соответствующий элемент управления. Также можно выбрать нужного вам пользователя и нажать на кнопку **Удалить** на вкладке **Основное**.

![](../../.gitbook/assets/user-tree3.gif)

Удаление группы осуществляется аналогичным образом. 

</details>

<details>

<summary>Перемещение карточки пользователя</summary>

Чтобы переместить учетную запись пользователя в другую группу, выделите этого пользователя и на вкладке **Основное** найдите поле **Находится в группе**. Из выпадающего списка выберите группу, в которую надо переместить пользователя, и нажмите на кнопку **Сохранить**.

![](../../.gitbook/assets/user-tree4.gif)

</details>

## Как настроить дерево пользователей

Для редактирования параметров учетных записей или групп пользователей, выберите нужный объект:
* Группу пользователей;
* Учетную запись пользователей.

### Группа пользователей

При выборе группы пользователей появится возможность настроить две вкладки:
* **Основное** - во вкладке представлена возможность:
  * **Изменить название и вложенность группы**. Для этого в соответствующем поле введите новое название и укажите группу, в которую требуется переместить данную группу;
  * **Создать пользователя**. При нажатии на одноименную кнопку появится форма создания пользователя;
  * **Удаление группы**. Вместе с группой удаляются УЗ пользователей группы и привязки по IP и MAC-адресам;
  * **Запретить доступ**. При активации опции всем пользователям группы будет запрещен доступ в сеть Интернет.
* **Active Directory** - вкладка содержит информацию об имени домена и типе группы. Процесс настройки синхронизации с Active Directory и импорт пользователей описан в статье Интеграция с Active Directory.

### Учетная запись пользователей

При выборе учетной записи появится возможность настроить следующие вкладки:
* **Основное** - вкладка включает в себя множество параметров, определяющих статус учетной записи пользователя. Базовые параметры:
  * **Имя пользователя** - Имя пользователя, например, Иванов Иван. Максимальное количество символов - 128;
  * **Логин** - Будет применяться пользователем для авторизации в различных службах Ideco UTM. Логин необходимо вводить латинскими символами в нижнем регистре. Максимальное количество символов - 32;
  * **Находится в группе** - Используйте это поле для перемещения пользователя в другую группу;
  * **Запретить доступ** - При установке этого флага, пользователь не сможет авторизоваться, соответственно пользоваться ресурсами сети Интернет, почтой и личным кабинетом.

  Для пользователей, экспортированных из **Active Directory** во вкладке **Основное** нельзя редактировать имя, логин, перемещать в другую группу и менять пароль. 
* **IP и MAC авторизация** - вкладка содержит правила авторизации по IP и MAC, созданные для определенного пользователя в двух разделах:
  * Пользователи -> Учетные записи -> IP и MAC авторизация;
  * Пользователи -> Авторизации -> IP и MAC авторизация.
* **Сессии** - вкладка содержит таблицу с информацией о всех активных сессиях пользователях:
  
  ![](../../.gitbook/assets/user-tree1.png)

  При нажатии на  в столбце **Управление**, UTM разорвет сессию пользователя. \
  Аналогичная таблица расположена в разделе **Мониторинг -> Авторизованные пользователи**.

# Импорт пользователей из Active Directory
## Импорт учетных записей из LDAP

В Ideco UTM VPP реализована возможность импорта учетных записей из LDAP-каталога Active Directory (далее AD). Импорт осуществляется по протоколам LDAP/LDAPS (протокол LDAPS не требует дополнительных настроек со стороны UTM и будет использоваться автоматически в случае использования его на контроллере домена).
Импортировать группы пользователей AD можно в специально созданные группы пользователей в Ideco UTM VPP. Их название может быть произвольным.\
Для импорта пользователей из AD, выполните следующие действия:
1. Создайте группу в дереве пользователей Ideco UTM VPP. Подробнее о создании групп в [статье](user-tree.md).
2. Выберите эту группу в дереве и перейдите на вкладку **Active Directory** в правой части экрана.
3. Выберите домен, из которого требуется импортировать пользователей (если Ideco UTM VPP является членом нескольких доменов).
4. В поле **Тип группы** выберите LDAP/AD группа.
5. При нажатии на поле **LDAP группа** откроется дерево пользователей Active Directory. Выберите из него необходимую группу для импорта (также можно выбрать корневую группу для импорта всего дерева).
6. Нажмите **Сохранить** (будет произведен импорт пользователей).

![](../../.gitbook/assets/user-tree2.png)

{% hint style="info" %}
Пользователи автоматически синхронизируются с Active Directory каждые 15 минут.
{% endhint %}

При необходимости можно воспользоваться фильтром запросов. Например, если в одних и тех же контейнерах находятся пользователи и компьютеры, а хотите импортировать только пользователей, то в поле LDAP-фильтр напишите следующий текст:\
`(&(objectCategory=person)(objectClass=user))`

{% hint style="info" %}
Не стоит импортировать подгруппы уже импортированной группы, поскольку подгруппы уже будут добавлены вместе с основной группой.
{% endhint %}

## Импорт учетных записей из групп безопасности

{% hint style="info" %}
Пользователь Active Directory может быть импортирован только в одну группу Ideco UTM VPP. Если пользователь находится в нескольких группах безопасности Active Directory, он попадет в одну группу, импортированную последней.
{% endhint %}

Можно импортировать любое количество групп безопасности AD в разные папки в дереве пользователей. Для импорта выполните действия:

1. Создайте группу в дереве пользователей Ideco UTM VPP.
2. Выберите эту группу в дереве и перейдите на вкладку Active Directory.
3. В поле **Имя домена** выберите нужный домен.
4. В поле **Тип группы** выберите **Группа безопасности AD**.
5. В поле ниже из раскрывающего списка выберите нужную группу безопасности.
6. Нажмите **Сохранить**.
  
Пример настройки импорта пользователей из групп безопасности:

![](../../.gitbook/assets/user-tree3.png)

<details>

<summary>Если из AD импортировались не все пользователи</summary>

Если из AD импортировались не все пользователи, то включите режим совместимости. **Важно**: включенный режим совместимости импортирует пользователей медленнее.

Примеры включения через терминал и браузер:

**Терминал**

1\. Авторизуйтесь командой:

```
curl -c /tmp/cookie -b /tmp/cookie -X POST https://адрес_сервера/web/auth/login -d '{"login": "логин", "password": "пароль", "rest_path": "/"}' -k
```

2\. Отправьте запрос на включение режима:

```
curl -c /tmp/cookie -b /tmp/cookie -X PUT https://адрес_сервера/ad_backend/security_group_import_settings -d '{"compatibility_mode": true}' -i -k -H 'Content-type: application/json'
```

**Браузер**

1\. Откройте веб-интерфейс Ideco UTM VPP и нажмите F12;

2\. Перейдите во вкладку **Сеть** и нажмите на любой запрос; 

3\. В появившемся окне перейдите на вкладку **Новый запрос**;

4\. Отправьте запрос авторизации:

```
POST https://адрес_сервера/web/auth/login
```

Тело запроса:

```
{
    "login": "логин", "password": "пароль", "rest_path": "/"
}
```

![](../../.gitbook/assets/user-tree4.png)

5\. Отправьте запрос на включение режима:

```
PUT /ad_backend/security_group_import_settings
```

Тело запроса:

```
{
  "compatibility_mode": true
}
```

![](../../.gitbook/assets/user-tree5.png)

Для выключения режима совместимости в теле запроса вместо `true` укажите `false`.

</details>
