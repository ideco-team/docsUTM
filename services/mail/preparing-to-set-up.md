# Подготовка к настройке почтового сервера

## Настройка домена у регистратора/держателя зоны

Для создания почтового сервера вам потребуется доменное имя. Вы можете зарегистрировать его у интернет-провайдера, предоставляющего вам услуги доступа в интернет, или напрямую у регистратора, например, в [RUcenter](http://nic.ru/). После того как вы зарегистрируете доменное имя, вам потребуется внести изменения в описание зоны на DNS-сервере (у держателя доменной зоны, которой зачастую является регистратор).

1. Нужно создать ресурсную запись типа А с именем для почтового сервера в вашем домене, указывающую на внешний IP-адрес Ideco UTM.\
   Убедитесь, что на внешнем интерфейсе UTM назначен публичный адрес, доступный из сети Интернет.
2. Нужно добавить ресурсную запись [типа MX](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%BF%D0%B8%D1%81%D1%8C\_MX), указывающую на A-запись, которая была создана на предыдущем шаге. Запись типа MX указывает на сетевой узел, который занимается обработкой почтовых сообщений для домена. Она должна ссылаться на доменное имя почтового сервера, а не на IP-адрес.
3. Также обязательно добавьте обратную ресурсную запись [типа PTR](https://ru.wikipedia.org/wiki/%D0%9E%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D1%8B%D0%B9\_%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81\_DNS). Эта запись должна быть прописана в файле обратной зоны. Эти изменения должны быть сделаны на стороне вашего Интернет-провайдера. Обратитесь к нему с просьбой прописать обратную ресурсную запись для вашего IP-адреса, которая должна ссылаться на вашу запись типа MX.
4. Рекомендуется настроить [SPF-запись](https://www.reg.ru/support/pochta\_general/pochta-reg-ru/nastroyka-spf-ptr-i-dkim-zapisey/kak-nastroit-spf-zapis) для вашего почтового сервера.
5. После настройки почтового сервера рекомендуется настроить также [DKIM-подпись](https://ru.wikipedia.org/wiki/DomainKeys\_Identified\_Mail) почтовых сообщений (Сервер - Почтовый сервер - Безопасность - DKIM-подпись).

Если рассмотреть набор необходимых записей на примере вымышленного домена example.net, то необходимо создать следующие ресурсные записи у держателя зоны:

* А-запись вида _**mail.example.net. IN A**_**  `23.45.67.89`**, где **`23.45.67.89`** это внешний IP-адрес Ideco UTM.
* MX-запись вида: _**example.net. MX 10 mx.example.net**_.
* SPF-запись объявляющая другим почтовым серверам в Интернет, что отправка писем с вашего домена разрешена только с хоста почтового сервера указанного в MX-записи: **example.net. IN TXT "v=spf1 a mx -all"**.&#x20;

В случае использования почтового сервера на UTM в качестве почтового релея ресурсные записи будут выглядеть так же, так как в Интернете ваш почтовый сервер в локальной сети будет представлен [smtp-релеем](../../publishing-resources/config-mail-relay-to-publish-on-a-local-network.md) на UTM.
