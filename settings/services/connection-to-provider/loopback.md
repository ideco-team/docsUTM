# Настройка Loopback-интерфейса

Loopback - это виртуальный интерфейс, который может использоваться для динамической маршрутизации (BGP и OSPF), удаленного администрирования и подключения пользователей по VPN. Преимущество Loopback-интерфейса в том, что он никогда не будет в состоянии Down - не перестанет работать, пока его не отключат административно.

{% hint style="warning" %}
Нельзя создавать Loopback-интерфейс в настроенном кластере. Если все же требуется использовать Loopback-интерфейс, настройте его до объединения в кластер.
{% endhint %}

Чтобы создать Loopback-интерфейс на Ideco NGFW, выполните действия:

1\. Перейдите в раздел **Сервисы -> Сетевые интерфейсы -> Внешние и локальные** и нажмите **Добавить**. Выберите **Loopback**:

![](/.gitbook/assets/interfaces29.png)

2\. Заполните поля:

![](/.gitbook/assets/interfaces30.png)

* **Название** - введите название интерфейса;
* **IP-адрес/маска** - введите IP-адрес, который требуется назначить на Loopback-интерфейс, с маской в формате `x.x.x.x/x`;
* **Комментарий** - поле не обязательное.

{% hint style="warning" %}
Чтобы избежать проблем с подключением пользователей к Loopback-интерфейсу по VPN, IP-адрес Loopback-интерфейса **не должен** входить в диапазоны адресов, используемые для [SNAT](/settings/access-rules/firewall.md#автоматический-snat-локальных-сетей-и-счетчик-срабатываний). Если включен автоматический SNAT локальных сетей, IP-адрес Loopback-интерфейса не должен входить в диапазоны:

* `10.0.0.0/8`
* `192.168.0.0/16`
* `172.16.0.0/12`
{% endhint %}

4\. Нажмите **Добавить**. Loopback-интерфейс появится в таблице внешних и локальных интерфейсов:

![](/.gitbook/assets/interfaces31.png)

## Использование Loopback-интерфейса

Loopback-интерфейс можно использовать:

1\. Для доступа к веб-интерфейсу Ideco NGFW укажите в адресной строке браузера `<IP-адрес Loopback-интерфейса>:8443`.

2\. Для доступа к серверу по SSH: 

* [Разрешите доступ по SSH](/settings/server-management/admins.md);
* Введите в терминале `ssh login@<IP-адрес Loopback-интерфейса>`.

3\. Для подключения пользователей по VPN на устройстве пользователя при [создании VPN-подключения](/recipes/popular-recipes/vpn/README.md) в качестве шлюза укажите домен или IP-адрес Loopback-интерфейса.

4\. В разделе **[BGP](/settings/services/bgp.md)** при добавлении **BGP-соседей** укажите в поле **Исходящий интерфейс** Loopback-интерфейс.

5\. При настройке **[OSPF](/settings/services/ospf.md)** укажите в поле **Интерфейс** Loopback-интерфейс.

6\. При создании [маршрута Null route](/settings/services/routing.md#маршрутизация-локальных-сетей) укажите Loopback-интерфейс в качестве шлюза для подсети/IP-адресов. В этом случае весь входящий на NGFW трафик, предназначенный для этих адресов, будет отбрасываться.

7\. При создании [DNAT-правила](/settings/access-rules/firewall-tables.md#создание-правил) **Файрвола** в поле **Адрес назначения** укажите IP-адрес, назначенный на Loopback-интерфейс. Опубликованные ресурсы будут доступны по IP-адресу Loopback-интерфейса.

8\. При создании [SNAT-правила](/settings/access-rules/firewall-tables.md#создание-правил) **Файрвола** в поле **Сменить IP-адрес источника** укажите IP-адрес, назначенный на Loopback-интерфейс. Исходный адрес, указанный в поле **Адрес источника**, будет заменен на адрес Loopback-интерфейса.

{% hint style="warning" %}
Для подключения к Loopback-интерфейсу настройте маршрутизацию до IP-адреса, назначенного на этот Loopback-интерфейс.
{% endhint %}

