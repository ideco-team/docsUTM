---
description: >-
  Используется для перенаправления сетевого трафика, проходящего через Ideco
  UTM.
---

# Маршрутизация

{% hint style="success" %}
Название службы раздела **Маршрутизация**: `ideco-routing-backend.service`. \
Список служб для других разделов доступен по [ссылке](../server-management/terminal.md).
{% endhint %}

Имеет ряд преимуществ по сравнению с некоторыми другими традиционными системами маршрутизации. Среди них:

* Возможность указывать сеть источника прямо в маршруте;
* Функция адаптивности (в случае недоступности шлюза или интерфейса, поиск маршрута продолжится по следующим правилам маршрутизации).

В веб-интерфейсе Ideco UTM есть возможность маршрутизировать локальные и внешние сети. Создавать и редактировать маршруты можно через веб-интерфейс Ideco UTM в разделе **Сервисы -> Маршрутизация**.

Для организации доступа в удаленные сети через роутер в локальной сети читайте статью по [ссылке](../users/authorization/vpn-connection/features.md).

## Маршрутизация локальных сетей

Маршрутизация локальных сетей действует внутри локальной сети. Поэтому при добавлении маршрута отсутствует поле **Адрес источника**. Для добавления нового маршрута перейдите на вкладку маршрутизации **Локальных сетей** и нажмите **Добавить**:

* **Адрес назначения** - выберите объекты, при обращении к которым будет применяться это правило. Возможные типы объектов: IP-адрес, подсеть;
* **Шлюз** – выберите объект, через который направляется трафик. Возможные типы объектов: сетевые интерфейсы, IP-адреса;
* **Комментарий** - необязательное поля для описания маршрута. Значение - не длиннее 128 символов.

## Маршрутизация внешних сетей

Для добавления нового маршрута перейдите на вкладку маршрутизации **Внешних сетей** нажмите кнопку **Добавить**. На странице откроется форма создания маршрута:

![](../../.gitbook/assets/route\_out\_net.png)

Опишем назначение каждой опции:

* **Адрес источника** - выберите объекты, для которых будет применяться данное правило. Возможные типы объектов: группы, пользователи, IP-адрес, домен, диапазон IP-адресов, подсеть, список адресов;
* **Адрес назначения** - выберите объекты, при обращении к которым будет применяться данное правило. Возможные типы объектов: группы, пользователи, IP-адрес, домен, диапазон IP-адресов, подсеть, список адресов;
* **Шлюз** - выберите объект, через который будет направлен трафик. Возможные типы объектов: сетевые интерфейсы, IP-адреса;
* **Использовать только если шлюз доступен (адаптивность)** - если это свойство включено, то в случае недоступности шлюза или интерфейса, поиск маршрута продолжится по следующим правилам маршрутизации, а если свойство отключено (по умолчанию), то трафик отправляется в выбранный шлюз или интерфейс. Если шлюз недоступен или интерфейс не работает, то такой трафик будет отброшен (destination unreachable);
* **Комментарий** - необязательное поле для описания маршрута. Значение не должно быть длиннее 128 символов.

После сохранения маршрута страница выглядит так:

![](../../.gitbook/assets/routing-outside.png)

Кнопки ![](../../.gitbook/assets/mdiarrowdown.svg) и ![](../../.gitbook/assets/mdiarrowup.svg) повышают или понижают приоритет выполнения правила.

Статусы в столбце **Используется**:

* ![mdicheckboxmarkedcircle.svg](../../.gitbook/assets/mdicheckboxmarkedcircle.svg) - Маршрут активен и трафик попадающий под условия маршрута будет перенаправлен в указанный Шлюз;
* ![frame.svg](../../.gitbook/assets/frame.svg) - Маршрут не активен и трафик попадающий под условия маршрута не будет обработан данным правилом.

{% hint style="info" %}
Трафик, не попавший под условия правил маршрутизации, или с объектом **Любой** в качестве шлюза, будет отправлен в [Балансировку и резервирование](multiple-simultaneous-connections.md).
{% endhint %}

#### Примеры популярных маршрутов

При маршрутизации трафика через подключения к провайдеру важно понимать, что чаще всего одного маршрута недостаточно, понадобится также переопределить адрес с помощью SNAT, иначе такой маршрут просто не будет работать. SNAT можно настроить с помощью [файрвола](../access-rules/firewall.md).

<details>

<summary>Задача: любой трафик в подсеть `150.1.0.0/16` направлять на шлюз `67.12.8.9`</summary>

<img src="../../.gitbook/assets/route_123.png" alt="" data-size="original">

</details>

<details>

<summary>Задача: весь трафик пользователей из группы Бухгалтерия направить через шлюз выбранного сетевого интерфейса</summary>

<img src="../../.gitbook/assets/route_12345.png" alt="" data-size="original">

Если вы настраиваете маршрут в удаленную сеть, доступную через дополнительный роутер, расположенный в той же локальной сети, что и клиенты, то убедитесь, что вы избежали "ассиметричной маршрутизации" и вынесли роутер в DMZ.

</details>

