---
description: >-
  Используется для прозрачного проксирования веб-трафика потребителям в
  локальной сети.
---

# Прокси

{% hint style="success" %}
Название службы раздела **Прокси**: `ideco-proxy-backend.service`; `squid.service`. \
Список служб для других разделов доступен по [ссылке](../../server-management/terminal.md).
{% endhint %}

Прокси-сервер, помимо проксирования веб-трафика, используется передачи трафика следующим сервисам:

* Антивирус для веб-трафика (Антивирус Касперского или ClamAV);
* Сервис отчетности по веб-трафику пользователей;
* Контент-фильтр. 

Порядок обработки веб-трафика подробнее описан в [статье](../../../recipes/popular-recipes/processing-order.md).

{% hint style="info" %}
На хостах локальной сети не нужно явно указывать настройки прокси. Достаточно указания UTM в качестве шлюза по умолчанию для устройств в сети.

Для настройки фильтрации HTTPS-трафика нужно добавить корневой сертификат UTM на компьютеры пользователей. Подробнее в статье [Настройка фильтрации HTTPS](../../access-rules/content-filter/filtering-https-traffic.md).
{% endhint %}

## Основное

На вкладке **Основное** предоставлена возможность:
* **Включить кэширование трафика на диск**. По умолчанию кэширование трафика на диск отключено, но оно осуществляется в оперативной памяти сервера. **Не рекомендуем включать эту опцию по причине излишней нагрузки на дисковую подсистему**. 
* **Разрешить прямые подключения к прокси**. Данный режим применяется в случае, когда Ideco UTM не является шлюзом по умолчанию для клиентов сети. Порт, указанный на стороне UTM следует указать на сетевых устройствах локальной сети, веб-трафик которых нужно пропускать через прокси.
* **Включить журналирование**. Включает запись логов Контент-фильтра и Антивирусов веб-трафика.

![](../../../.gitbook/assets/proxy-server.png)

О настройке прямого подключения к прокси и прокси с одним интерфейсом, читайте в [статье](proxy-server.md).

{% content-ref url="proxy-server.md" %}
[proxy-server.md](proxy-server.md)
{% endcontent-ref %}

## ICAP

Протокол ICAP используется для отправки HTTP(S)-трафика в расшифрованном виде сторонним серверам. ICAP-сервисы будут обрабатывать трафик после антивирусов и контент-фильтра.

При добавлении ICAP-сервиса доступны следующие настройки:
* **Игнорировать ошибки** - если включена эта опция, то сервис будет считаться необязательным. При недоступности или неправильной работе сервиса он не будет задействован.
* **Задать количество подключений к сервису вручную** - если значение не задано, максимальное количество подключений берется из ответа сервиса на запрос OPTIONS. Если максимальное количество подключений не указано и в ответе на запрос OPTIONS - тогда без ограничений.

![](../../../.gitbook/assets/icap.png)

## Исключения

Исключения ресурсов из обработки прокси-сервером работают только для прозрачного режима прокси. При прямых подключениях к прокси-серверу исключить что-либо из обработки прокси нельзя.

Подробнее о типах исключений в статье:

{% content-ref url="exclusions.md" %}
[exclusions.md](exclusions.md)
{% endcontent-ref %}

