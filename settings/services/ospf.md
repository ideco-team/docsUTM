# OSPF

В Ideco UTM 12 реализована поддержка OSPF (Open Shortest Path First) - протокола маршрутизации по состоянию каналов. Канал — это интерфейс маршрутизатора. Канал также представляет собой сегмент сети, который соединяет два маршрутизатора или заглушающую сеть, такую как Ethernet LAN, которая подключена к одному маршрутизатору. Данные о состоянии этих каналов также называются состоянием канала. Вся информация о состоянии канала включает префикс сети, длину префикса и стоимость.

В данном разделе описывается принцип работы OSPF, а так же его настройка в веб-интерфейсе UTM.

## Принцип работы маршрутизации по состоянию канала

### **1. Установление отношений смежности с соседними устройствами**

Маршрутизатор, использующий OSPF, отправляет пакеты приветствия для определения всех соседних устройств в пределах этих каналов. При наличии соседнего устройства маршрутизатор пытается установить с ним отношения смежности.

Протокол OSPF проходит несколько состояний в процессе достижения сходимости:

| Состояние | Описание                                                                                                                                                                                                                                                                 |   |   |
| :-------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | - | - |
|    Down   | <ul><li>Не получено ни одного пакета приветствия = Down</li><li>Маршрутизатор отправляет пакеты приветствия</li><li>Переход в состояние Init</li></ul>                                                                                                                   |   |   |
|    Init   | <ul><li>Пакеты приветствия принимаются от соседних устройств</li><li>Они содержат идентификатор отправляющего маршрутизатора</li><li>Переход в состояние Two-Way</li></ul>                                                                                               |   |   |
|  Two-Way  | <ul><li>В этом состоянии связь между двумя маршрутизаторами двунаправленная</li><li>На многоканальных каналах маршрутизаторы выбирают DR (маршрутизатор с наивысшим приоритетом) и BDR (резервный DR)</li><li>Переход в состояние ExStart</li></ul>                      |   |   |
|  ExStart  | В сетях «точка-точка» два маршрутизатора определяют, какой маршрутизатор будет инициировать обмен пакетами DBD, и определяют исходный номер последовательности пакетов DBD                                                                                               |   |   |
|  Exchange | <ul><li>Маршрутизаторы обмениваются пакетами DBD (описание базы данных)</li><li>Если требуется дополнительная информация, выполняется переход в состояние Loading. В ином случае выполняется переход в состояние Full</li></ul>                                          |   |   |
|  Loading  | <ul><li>LSR (запрос состояния канала) и LSU (пакет обновления состояния канала) используются для получения дополнительной информации о маршруте</li><li>Маршруты обрабатываются посредством алгоритма поиска кратчайшего пути</li><li>Переход в состояние Full</li></ul> |   |   |
|    Full   | База данных состояния канала маршрутизатора полностью синхронизирована                                                                                                                                                                                                   |   |   |

### **2. Обмен объявлениями о состоянии каналов**

После установления смежности устройства выполняют обмен объявлениями о состоянии канала (LSA). LSA содержат информацию о состоянии и стоимости каждого канала с прямым подключением.

### **3. Создание базы данных состояния связи**

На основе объявления LSA маршрутизаторы собирают базу данных, в которой содержатся данные о топологии сети в области.

### **4. Исполнение алгоритма SPF**

Затем на устройствах выполняется алгоритм SPF, результатом которого является создание дерева кратчайших путей.

### **5. Выбор лучшего маршрута**

На основании данных дерева SPF предлагаются наилучшие пути для таблицы IP-маршрутизации. Маршрут добавляется в таблицу маршрутизации, если отсутствует источник маршрута к той же сети с меньшим административным расстоянием, например статический маршрут. Решения по маршрутизации принимаются на основе записей в таблице маршрутизации.

## Настройка OSPF на Ideco UTM



