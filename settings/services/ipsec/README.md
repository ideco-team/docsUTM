# IPsec

{% hint style="success" %}
Название службы раздела **IPsec**: `ideco-ipsec-backend`; `strongswan`. \
Список служб для других разделов доступен по [ссылке](../../server-management/terminal.md).

Нужна помощь при настройке Ideco UTM? Получите быстрый ответ от [чат-бота](https://gpt-docs.ideco.ru/) нашей документации!
{% endhint %}

{% hint style="info" %}
Особенность работы некоторых Cisco: Если в подключении site2site активную сторону представляет Cisco и Child_SA закрывается, то пассивная сторона не сможет отправить пакет в сторону Cisco, пока Cisco не создаст новый Child_SA.
{% endhint %}

{% hint style="info" %}
Выбор внешних интерфейсов для IPsec-подключений зависит от приоритета интерфейса в таблице раздела **Балансировка и резервирование**. Приоритет интерфейса определяется местом в таблице: чем выше интерфейс, тем больше у него приоритет. 

Интерфейсы без выхода в интернет имеют меньший приоритет по сравнению с интерфейсами с доступом в интернет. 

Туннели создаются на всех интерфейсах со шлюзом по умолчанию.
{% endhint %}

{% hint style="danger" %}
При обновлении на версию 15.Х может пропасть соединение IPsec с типом аутентификации PSK. Для настройки соединения перейдите в режим редактирование и подберите тип идентификатора.
{% endhint %}

{% content-ref url="branch-office-and-main-office.md" %}
[branch-office-and-main-office.md](branch-office-and-main-office.md)
{% endcontent-ref %}

## Исходящие подключения

Настройте исходящее подключение, если Ideco UTM является инициатором подключения, а удаленное устройство - принимающей стороной.

Для настройки исходящего подключения подготовьте:

<table><thead><tr><th width="213">Тип аутентификации</th><th>Требуемые параметры</th></tr></thead><tbody><tr><td><strong>Сертификат</strong></td><td><p>- Подписанный удаленным устройством <strong>Запрос на подпись сертификата</strong>. Файл запроса скачивается из веб-интерфейса UTM при создании подключения (<img src="../../../.gitbook/assets/icon-down.png" alt="">), отправляется удаленному устройству и подписанный возвращается для настройки UTM;</p><p>- Корневой сертификат удаленного устройства;</p><p>- Список домашних локальных сетей UTM, которые будут видны противоположной стороне;</p><p>- Список всех локальных сетей удаленного устройства, которые будут видны противоположной стороне.</p></td></tr><tr><td><strong>PSK</strong></td><td><p>- PSK-ключ. Генерируется на UTM при создании подключения;</p><p>- Идентификатор ключа, который потребуется удаленному устройству для идентификации подключения;</p><p>- Список локальных сетей UTM, которые будут видны противоположной стороне;</p><p>- Список локальных сетей удаленного устройства, которые будут видны противоположной стороне.</p></td></tr></tbody></table>

## Входящие подключения

Настройте входящее подключение, если удаленное устройство является инициатором подключения, а Ideco UTM - принимающей стороной.

Для настройки входящего подключения подготовьте:

<table><thead><tr><th width="214">Тип аутентификации</th><th>Требуемые параметры</th></tr></thead><tbody><tr><td><strong>Сертификат</strong></td><td><p>- Запрос на подпись сертификата (<code>.csr</code>), полученный от удаленного устройства;</p><p>- Список домашних локальных сетей UTM, которые будут видны противоположной стороне;</p><p>- Список всех локальных сетей удаленного устройства, которые будут видны противоположной стороне.</p></td></tr><tr><td><strong>PSK</strong></td><td><p>- PSK-ключ, сгенерированный на удаленном устройстве;</p><p>- Идентификатор удаленной стороны для идентификации входящего подключения;</p><p>- Список локальных сетей UTM, которые будут видны противоположной стороне;</p><p>- Список локальных сетей удаленного устройства, которые будут видны противоположной стороне.</p></td></tr></tbody></table>
