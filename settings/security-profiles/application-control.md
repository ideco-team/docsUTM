---
description: >-
  Настройка профилей Контроля приложений для подготовки к обновлению на NGFW
  версии 18.Х.
---

# Контроль приложений
{% hint style="danger" %}
В 18 версии все правила из раздела **Правила трафика -> Контроль приложений** будут удалены!

Чтобы подготовиться к изменениям, создайте профили в разделе **Профили безопасности -> Контроль приложений** и выберите их в правилах **Файрвола**.
{% endhint %}

{% hint style="success" %}
**Созданные профили не будут влиять на работу правил [Файрвола](settings/access-rules/firewall.md) в 17 версии**, но начнут работать после обновления на 18 версию, если применены в правилах **Файрвола**.
{% endhint %}

## Что изменится с появлением профилей Контроля приложений

В версиях ⩽ 17 весь FORWARD трафик сначала проходит модуль **Контроль приложений**, а затем **Файрвол**.

В 18 версии в модуль **Контроль приложений** отправится только тот трафик, который попадает под разрешающее правило **Файрвола** с включенной проверкой через **профиль** **Контроля приложений** согласно настройкам профиля. Очередность обработки трафика в версиях ⩽ 17 и в ⩾ 18 версии:

{% tabs %}
{% tab title="Порядок обработки трафика в 17.Х" %}
1\. DNS;

2\. Захват трафика для DPI:

* Контроль приложений;
* Ограничение скорости;
* Система предотвращения вторжений.

3\. Захват трафика для фильтрации (прокси-сервер):

* Контент-фильтр;
* Антивирус веб-трафика.

4\. Файрвол.
{% endtab %}

{% tab title="Порядок обработки трафика в 18.Х" %}
1\. Ограничение скорости;

2\. DNS;

3\. Захват трафика для фильтрации (прокси-сервер):

* Контент-фильтр;
* Антивирус веб-трафика.

4\. Файрвол;

5\. Контроль приложений;

6\. Система предотвращения вторжений.
{% endtab %}
{% endtabs %}

### Почему мы отказались от автоматической миграции

От автоматической миграции решили отказаться из-за вероятности появления дубликатов правил **FORWARD** и усложнения администрирования таблицы: 
* **Контроль приложений** мог бы некорректно определить условия фильтрации, заданные администратором в 17 версии, и для одного правила в таблице **FORWARD** создать несколько профилей; 
* Все автоматически созданные профили безопасности были бы применены к существующим правилам **FORWARD**. А так как одному правилу **Файрвола** может соответствовать только один профиль безопасности, появились бы дубликаты.

## Создание профиля и добавление в правила Файрвола

{% hint style="danger" %}
Модуль **Контроль приложений** НЕ БУДЕТ обрабатывать трафик в версии 18.Х, если в модуле **Файрвол** для этого трафика нет разрешающего правила (действие **Разрешить**) с указанным профилем безопасности **Контроля приложений**. \
Проверьте, что для соответствующего трафика добавлен профиль безопасности.
{% endhint %}

1\. Перейдите в раздел **Профили безопасности -> Контроль приложений** и нажмите **Добавить**.

2\. Во вкладке **Описание** заполните **Название** и **Комментарий** (необязательно):

![](/.gitbook/assets/application-control6.png)

3\. Во вкладке **Доступ к приложениям** выберите протоколы или группы протоколов, к которым будет применяться выбранное действие (**Запретить** или **Разрешить**):

![](/.gitbook/assets/application-control7.png)

4\. Перейдите в раздел **Правила трафика -> Файрвол**.

5\. Перейдите в режим редактирования (<img src="/.gitbook/assets/icon-edit.png" alt="" data-size="line">) того правила, трафик по которому следует отправить на проверку модулю **Контроль приложений**.

6\. В разделе **Профили для фильтрации** трафика укажите созданный профиль:

![](/.gitbook/assets/application-control8.png)

{% hint style="warning" %}
**ВАЖНО**:\
Если требуется проверять модулем **Контроля приложений** трафик, для которого в таблице FORWARD нет правил, создайте отдельное правило для такого трафика, указав нужный профиль безопасности **Контроля приложений**.
{% endhint %}

<details>
<summary>Фильтрация Контролем приложений трафика, для которого в таблице FORWARD нет правил</summary>

Сначала создайте профиль **Контроля приложений**, соответствующий нужным правилам **Контроля приложений**. Для этого:

1\. Перейдите в раздел **Профили безопасности -> Контроль приложений** и нажмите **Добавить**.

2\. Во вкладке **Описание** введите **Название** профиля и **Комментарий**.

3\. Во вкладке **Доступ к приложениям** выберите протоколы или группы протоколов и действия (**Запретить** или **Разрешить**), которые будут к ним применяться.

4\. Нажмите добавить профиль.

Теперь необходимо создать правило **Файрвола** с созданным профилем **Контроля приложений**. Для этого:

1\. Перейдите в раздел **Правила трафика -> Файрвол -> FORWARD** и нажмите **Добавить**.

2\. Заполните поля:

![](/.gitbook/assets/firewall14.png)

* **Протокол** - выберите протокол, соответствующий трафику, который требуется фильтровать **Контролем приложений**;
* **Источник** - выберите **Адрес**, **Зону** и **HIP-профиль** источника трафика;
* **Назначение** - выберите **Адрес** и **Зону** назначения трафика;
* **Действие** - выберите **Разрешить**;

3\. Включите опцию **Контроль приложений** и из раскрывающегося списка выберите созданный ранее профиль.

4\. Включите правило или оставьте его выключенным.

5\. Нажмите **Добавить**.

</details>

{% hint style="info" %}
С 18 версии NGFW правила Файрвола, которые блокировали трафик за счет перехвата DNS в предыдущих версиях, не смогут его блокировать. Чтобы это исправить, создайте правила с профилями IPS и DPI в разделе **Правила трафика -> Файрвол -> INPUT**.
{% endhint %}