---
description: Создание WAF-профилей для защиты опубликованных веб-ресурсов от атак.
---

# Web Application Firewall

{% hint style="success" %}
Название служб раздела **Web Application Firewall**: `ideco-waf-backend`; `ideco-waf-event-syncer`.\
Список служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

Использование WAF-профилей позволит настроить параметры защиты для опубликованного веб-ресурса. Профиль создается в разделе **Профили безопасности -> Web Application Firewall**.

{% hint style="warning" %}
Создание WAF-профилей не влияет на фильтрацию трафика. Чтобы включить фильтрацию, нужно использовать WAF-профили в разделе **[Обратный прокси](/settings/services/reverse-proxy.md)** при создании правила.
{% endhint %}

## Создание профиля WAF

Для создания профиля WAF выполните действия:

1\. Нажмите **Добавить** и заполните поля:

![](/.gitbook/assets/waf-profiles2.png)

<details>

<summary>Расшифровка полей</summary>

* **Hазвание** - введите название профиля;
* **Комментарий** - введите пояснение для профиля;
* **Режим работы**:
    * **Обнаружение и блокировка** - подозрительные запросы будут блокироваться и логироваться WAF;
    * **Только обнаружение** - подозрительные запросы будут логироваться WAF, но не будут блокироваться;
* **Дополнительные настройки**:
    * **Скрывать HTTP-заголовок Server** - позволяет скрыть данные, идентифицирующие сервер.

</details>

2\. Нажмите **Добавить профиль**.

3\. Нажмите на ![](/.gitbook/assets/icon-edit.png), выберите **Категории** и включите/отключите правила:

![](/.gitbook/assets/waf-profiles3.png)

## Использование профиля WAF в правиле Обратного прокси

1\. Перейдите в раздел **Сервисы -> Обратный прокси** и нажмите **Добавить**.

2\. Заполните поля:

![](/.gitbook/assets/reverse-proxy10.png)

<details>

<summary>Расшифровка полей</summary>

* **Запрашиваемый адрес в интернете** - введите IP-адрес, доменное имя или URL, который будет запрашиваться пользователями. Для добавления дополнительных адресов нажмите кнопку **Добавить адрес**;
* **Адрес web-cервера в локальной сети** - введите IP-адрес из локальной сети, на который будут перенаправляться пользователи;
* **Протокол** - выбранный протокол используется для всех адресов в правиле;
* **Адрес web-сервера в локальной сети** - адрес, на который будут перенаправлены запросы;
* **Путь** - поле необязательное и используется для всех адресов;
* **Перенаправлять HTTP-запросы на HTTPS** - включите настройку, если ваш сайт работает только по протоколу HTTPS, но при этом вы не хотите терять посетителей, обратившихся к вашему сайту по HTTP;
* **Профиль WAF** - выберите созданный ранее профиль WAF;
* **Передавать web-серверу реальный IP-адрес клиента** - включите настройку, если нужно, чтобы публичный IP-адрес клиента при обратном проксировании не заменялся на адрес NGFW.

</details>

3\. Нажмите **Добавить**.

## Диагностика и добавление исключений

Срабатывание правил **Web Application Firewall** отображается на вкладке **Отчеты и журналы -> События безопасности -> [Web Application Firewall](/settings/reports/security-events.md#web-application-firewall)**.

![](/.gitbook/assets/security-events2.png)

Добавить правило в исключение можно двумя способами:

{% tabs %}

{% tab title="По IP-адресу" %}

1\. Перейдите в раздел **Web Application Firewall** и у правила нажмите на ![](/.gitbook/assets/icon-edit.png).

2\. Выберите **Белый и черный списки** и нажмите **Добавить источник**:

{% hint style="info" %}
В каждый профиль WAF можно добавить не более двух тысяч источников в белых и черных списках.
Если лимит будет превышен, появится сообщение в уведомлениях.
{% endhint %}

* Для добавления в белый список укажите необходимые IP-адреса и подсети, выберите действие **Не проверять**:

![](/.gitbook/assets/waf-profiles5.png)

* Для добавления в черный список укажите необходимые IP-адреса и подсети, выберите действие **Блокировать**:

![](/.gitbook/assets/waf-profiles6.png)

{% hint style="info" %}
Исключения, добавленные в **Белый и черный списки**, логируются на вкладке **Отчеты и журналы -> События безопасности -> [Web Application Firewall](/settings/reports/security-events.md#web-application-firewall)**.
{% endhint %}

{% endtab %}

{% tab title="По ID правила" %}

Исключение добавляется двумя способами:

* На вкладке **Исключения**;
* На вкладке **Web Application Firewall**.

{% hint style="danger" %}
Не рекомендуем добавлять исключение по ID правила, так как из обработки исключатся все запросы, попадающие под исключенное правило.
{% endhint %}

<details>

<summary>На вкладке Исключения</summary>

1\. Перейдите в раздел **Web Application Firewall**, у правила нажмите на ![](/.gitbook/assets/icon-edit.png) и выберите **Исключения**.

2\. Нажмите **Добавить исключение** и укажите ID правила.

ID правила находится в журнале срабатывания правил на вкладке **Отчеты и журналы -> События безопасности -> [Web Application Firewall](/settings/reports/security-events.md#web-application-firewall)**.

</details>

<details>

<summary>На вкладке Web Application Firewall</summary>

1\. Перейдите на вкладку **Отчеты и журналы -> События безопасности -> Web Application Firewall**.

2\. Нажмите на ![](/.gitbook/assets/icon-lock.png) в столбце ID правила.

</details>

{% endtab %}

{% endtabs %}

{% hint style="info" %}
По вопросам добавления исключений другими способами обращайтесь в [Техническую поддержку](/general/technical-support.md).
{% endhint %}