# Предотвращение вторжений

{% hint style="success" %}
Название службы раздела *Предотвращение вторжений*: `ideco-suricata-backend`; `ideco-suricata`; `ideco-suricata-event-syncer`; `ideco-suricata-profiles-syncer`. \
Список имен служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

В разделе **Профили безопасности -> Предотвращение вторжений** создаются профили с правилами выбора сигнатур и действиями, которые NGFW будет применять к трафику, соответствующему этим сигнатурам.

В 18 версии Ideco NGFW созданные в разделе **Профили безопасности -> Предотвращение вторжений** профили применяются при создании правил в разделе **Правила трафика -> Файрвол**.

{% hint style="info" %}

Профили **Предотвращения вторжений** и [Контроля приложений](/settings/security-profiles/application-control/README.md), а также правила [Ограничения скорости](/settings/access-rules/shaper.md) не обрабатывают трафик между локальными сетями и сетями филиалов.

{% endhint %}

Чтобы трафик фильтровался системой **Предотвращения вторжений**, необходимо для всех локальных интерфейсов создать правило FORWARD, содержащее необходимый профиль безопасности. Если в разделе **Сервисы -> DNS -> Внешние DNS-серверы** включена опция **Перехват пользовательских DNS-запросов** (по умолчанию включена), нужно также создать аналогичное правило INPUT:

![](/.gitbook/assets/application-control5.png)

{% hint style="danger" %}
Если профиль не добавлен в правила таблицы FORWARD или INPUT раздела **Правила трафика -> Файрвол**, трафик не будет фильтроваться системой **Предотвращения вторжений**.

Сигнатуры, не используемые в профилях, и профили, не используемые в правилах **Файрвола**, не участвуют в обработке трафика!
{% endhint %}

## Особенности обработки трафика системой Предотвращения вторжений

В предыдущих версиях FORWARD- и INPUT-трафик сначала проходит модуль **Предотвращение вторжений**, а затем **Файрвол**. В 18 версии IPS обрабатывает только трафик, соответствующий разрешающему правилу **Файрвола** с включенной проверкой через **Предотвращение вторжений**.

**Файрвол** Ideco NGFW анализирует трафик для поиска подходящего правила и применяет его. Если в списке есть несколько правил с одними и теми же условиями, применяется правило, стоящее выше по списку. Запрещающие правила **Файрвола** сразу блокируют соответствующий трафик, он не проходит дополнительную проверку в модуле **Предотвращение вторжений**.

Чтобы через модуль **Предотвращение вторжений** проходил трафик, для которого нет разрешающего правила в таблице FORWARD или INPUT, рекомендуем создать и включить в **Файрволе** правило с источником **Локальные интерфейсы** и назначением **Любой**, разместив его в конец таблицы. В этом случае трафик, который не был найден в правилах **Файрвола**, но соответствует профилям IPS, пройдет проверку системой **Предотвращения вторжений**.

{% hint style="info" %}
Если в одном правиле **Файрвола** включены проверки и **Контролем приложений**, и системой **Предотвращения вторжений**, трафик сначала попадет в обработку DPI, затем - IPS.
{% endhint %}