# VCE

{% hint style="success" %}
Название службы раздела **VCE**: `ideco-vce-backend`. \
Список служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

VCE (virtual context engine) - это функция Ideco NGFW, которая позволяет создавать виртуальные серверы на одном корневом NGFW. Это дает возможность разбить одну локальную сеть на несколько независимых подсетей, индивидуально создавать для каждой из этих сетей политики безопасности и объекты, а также разграничивать доступ и независимо управлять дочерними VCE. При этом нет необходимости устанавливать и настраивать для этого отдельные физические серверы.

{% hint style="warning" %}
Не предоставляйте доступ к VCE сторонним организациям, поскольку полная изоляция VCE не реализована и не предусмотрена. Предоставление доступа сторонним организациям может привести к угрозе безопасности сервера.
{% endhint %}

{% hint style="info" %}
Сейчас для каждого созданного VCE загружается файл лицензии корневой системы. Это значит, что на Ideco NGFW с лицензией на 100 пользователей можно создать неограниченное количество VCE, каждый из которых также будет поддерживать по 100 пользователей.
{% endhint %}

Функциональность созданных внутри NGFW виртуальных VCE почти не отличается от функциональности NGFW.

**Возможности VCE:**
* Создание виртуальных серверов Ideco NGFW и настройка независимых сетевых интерфейсов. 
* Независимая настройка политик безопасности и прав доступа различным виртуальным NGFW.
* Связь с Ideco Center.
* Запуск и остановка виртуальных серверов с одного корневого NGFW.

**В интерфейсе VCE недоступно**:

* Создание [кластера](/settings/server-management/cluster/cluster.md).
* [Обновление](/settings/server-management/server-update.md) VCE (выполняется в корневой системе).
* Полное восстановление из бэкапов (как в локальном меню, так и в веб-интерфейсе Ideco NGFW). Доступно только быстрое восстановление.
* Изменение статуса **Разрешить интернет всем** (настраивается в корневой системе).
* Переход в **Профиль** через иконку ![](/.gitbook/assets/icon-administrator.png) в шапке веб-интерфейса (настраивается в корневой системе).
* Возможность выключения и перезагрузки (настраивается в корневой системе).
* Энергосберегающий режим (настраивается в корневой системе).
* Изменение настроек часового пояса и языка (настраивается в корневой системе).

{% hint style="info" %}
В [бэкап](/settings/server-management/backup.md) корневого VCE не входят данные и настройки, которые содержатся в дочерних VCE. Чтобы обеспечить полное сохранение данных, создайте бэкапы корневого NGFW и каждого из дочерних VCE.

Нельзя добавлять LACP-интерфейсы в VCE.
{% endhint %}

## Создание VCE

<details> 

<summary>Миграция VCE с NGFW 19 на NGFW 20</summary>

1\. Выключите все работающие VCE, нажав ![](/.gitbook/assets/icon-bot-off.png).

2\. После выключения всех VCE нужно настроить **Системный контекст**, нажав ![](/.gitbook/assets/icon-edit.png). Выделите ресурсы, убедитесь, что системе выделено не менее 8 ГБ оперативной памяти и двух логических ядер:

![](/.gitbook/assets/vce2.png)

В разделе **Ресурсы сервера** все ресурсы перейдут в категории **Назначено** и **Свободно**:
* Ресурсы в категории **Назначено** показывают, сколько выделено для редактируемого VCE. 
* Ресурсы в категории **Свободно** показывают, сколько можно выделить для других VCE.

3\. Отредактируйте оставшиеся VCE, выделив для них свободные ресурсы.

4\. Включите VCE, для которых были выделены ресурсы.

</details>

{% hint style="warning" %}
С 20-й версии Ideco NGFW все системные ресурсы будут переведены в категорию **Разделяемых ресурсов** до момента последующего распределения.

При запуске VCE без выделенных ресурсов:

*  Если **Свободных ресурсов** достаточно, ресурсы перейдут в **Разделяемые ресурсы**.
*  Если **Свободных ресурсов** недостаточно, у VCE появится статус **Недостаточно ресурсов**.

С 21-й версии поддержка VCE без выделенных ресурсов будет прекращена.
{% endhint %}

Чтобы создать виртуальный сервер в рамках VCE, перейдите в раздел **Управление сервером -> VCE** и выполните действия:

1\. Нажмите **Добавить**.

2\. Укажите название сервера и выделите ему ресурсы. Для работы VCE требуется не менее 8 ГБ оперативной памяти и два логических ядра:

![](/.gitbook/assets/vce.png)

3\. Нажмите **Добавить** - виртуальный сервер появится в таблице:

![](/.gitbook/assets/vce1.png)

4\. Перейдите в раздел **Сервисы -> Сетевые интерфейсы** и на вкладке **VCE** создайте интерфейс для виртуального сервера. Для работы VCE нужен минимум один сетевой интерфейс. Подробнее о создании VCE-интерфейсов в [статье](/settings/services/connection-to-provider/README.md#vce-interfeisy).

{% hint style="info" %}
Сетевой интерфейс без тега VLAN, подключенный к VCE, будет недоступен для использования корневым NGFW.

После отключения VCE, интерфейсы, которые были использованы, становятся доступными для корневого NGFW и могут использоваться для создания нового виртуального сервера.

При этом VCE, которому сетевые интерфейсы принадлежали ранее, станет недоступен после включения.
{% endhint %}

Чтобы отредактировать VCE, нажмите на ![](/.gitbook/assets/icon-edit.png). При редактировании можно менять:
* Название виртуального сервера.
* Выделенные ресурсы.

Изменение ресурсов работающего VCE приведет к перезапуску виртуального сервера.

Если в таблице большое количество VCE, воспользуйтесь кнопкой **Фильтры**.

## Переход в веб-интерфейс VCE

После создания VCE текущий сервер NGFW, в котором VCE был создан, будет обозначен как корневой:

![](/.gitbook/assets/vce5.png)

Перейти в веб-интерфейс созданного VCE из веб-интерфейса NGFW можно двумя способами:

1\. Перейдите в **Управление сервером -> VCE** и нажмите на ![](/.gitbook/assets/icon-eye.png). В новой вкладке откроется веб-интерфейс VCE.

2\. Нажмите на ![](/.gitbook/assets/icon-cc.png) в левом верхнем углу и выберите нужный VCE:

![](/.gitbook/assets/vce2.gif)

<!-- После этого веб-интерфейс VCE откроется в текущей вкладке браузера. Меню интерфейса корневого NGFW будет свернуто, вернуться к нему можно, кликнув на панель слева. -->

## Удаление VCE

Удалить VCE можно, нажав на ![](/.gitbook/assets/icon-delete1.png) в корневом VCE.

{% hint style="warning" %}
После удаления VCE все его настройки, журналы и внутренние данные будут безвозвратно утеряны. Восстановить их будет невозможно.
{% endhint %}

