---
description: >-
  В этом разделе находится описание процесса создания и восстановления бэкапа Ideco NGFW.
---

# Бэкапы

Бэкап - это предварительно созданная резервная копия данных, позволяющая восстановить большинство настроек и сохраненной информации.

{% hint style="success" %}
Название служб раздела **Бэкапы**: `ideco-backup-backend`; `ideco-backup-create`; `ideco-backup-restore`; `ideco-backup-rotate`.\
Список служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

В NGFW создается только полный бэкап, который включают в себя все настройки, созданные администратором в веб-интерфейсе.

Бэкапы не включают:

* Системный журнал;
* Почту;
* Статистику web-трафика и другие отчеты;
* Любые кешируемые данные, базы антивирусов, правила IPS и т. п.;
* Настройки созданных [VCE](/settings/server-management/vce.md);
* Любые данные, генерируемые в процессе работы системы автоматически.

{% hint style="info" %}
В бэкап корневого VCE не входят данные и настройки, которые содержатся в дочерних VCE. Чтобы обеспечить полное сохранение данных, создайте бэкап отдельно по корневому VCE и по каждому из дочерних VCE.
{% endhint %}

В NGFW бэкап создается как автоматически, так и вручную.

## Автоматическое создание бэкапа
Для настройки автоматического бэкапа перейдите в раздел **Управление сервером -> Бэкапы -> Настройки**:

![](/.gitbook/assets/backup.png)

Установите время ежедневного создания и продолжительность хранения бэкапа на локальном жестком диске. При настройке выгрузки на сетевое файловое хранилище автоматический бэкап будет также дублироваться туда.

* **Время ежедневного создания копии** - укажите в настройках час (рекомендуется выбирать ночное время для создания бэкапа);

* **Хранить в течение** - хранить бэкапы на локальном жестком диске можно в течение недели или месяца.

{% hint style="info" %} Каждый автоматически созданный бэкап сохраняется в таблице бэкапов с комментарием "Автоматическая резервная копия".{% endhint %}

Рекомендуется хранить бэкапы не только на локальном жестком диске, но и на внешних носителях. NGFW предоставляет возможность выгружать бэкапы:
* на сетевое файловое хранилище по протоколу FTP;
* на сетевое файловое хранилище по протоколу NetBIOS (CIFS);
* на ПК через кнопку **Скачать** в таблице бэкапов (![](/.gitbook/assets/download.png)) для переноса с сервера на иной внешний носитель вручную.

### Бэкапы на удаленное файловое хранилище по протоколу FTP 

Ключевые параметры, необходимые для настройки бэкапа на FTP-сервер, описаны в таблице:

<table><thead><tr><th width="188">Параметр</th><th>Описание</th></tr></thead><tbody><tr><td>Адрес сервера</td><td>IP-адрес удаленного FTP-сервера, на котором будут размещаться бэкапы</td></tr><tr><td>Логин</td><td>Имя пользователя для авторизации на FTP-сервере</td></tr><tr><td>Пароль</td><td>Пароль для авторизации на FTP-сервере</td></tr><tr><td>Путь к каталогу</td><td>Каталог, в который будут записываться бэкапы</td></tr></tbody></table>

### Бэкапы на сетевое файловое хранилище по протоколу NetBIOS (CIFS)

Ключевые параметры, необходимые для настройки бэкапа на NetBIOS-сервер, описаны в таблице:

<table><thead><tr><th width="189">Параметр</th><th>Описание</th></tr></thead><tbody><tr><td>Адрес сервера</td><td>IP-адрес удаленного NetBIOS-сервера, на котором будут размещаться бэкапы</td></tr><tr><td>Логин</td><td>Имя пользователя для авторизации на сетевом ресурсе Windows</td></tr><tr><td>Пароль</td><td>Пароль для авторизации на сетевом ресурсе Windows</td></tr><tr><td>Путь к каталогу</td><td>Каталог, в который будут записываться бэкапы</td></tr></tbody></table>

{% hint style="info" %}
Укажите путь к каталогу в UNIX-формате. К примеру, в ОС Windows каталог открывается по следующему пути `\\192.168.1.1\dir_1\dir_2\backup`, значит, в поле **Путь к каталогу** пропишите `dir_1/dir_2/backup`.
{% endhint %}

## Ручное создание бэкапа

### Через веб-интерфейс

Для создания бэкапа через интерфейс Ideco NGFW перейдите в **Управление сервером -> Бэкапы -> Бэкапы** и нажмите **Добавить -> Создать**. Введите комментарий и нажмите **Добавить** или нажмите ![](/.gitbook/assets/icon-backup.png) **Создать бэкап** в правом верхнем углу веб-интерфейса. Новый бэкап появится в таблице:

![](/.gitbook/assets/backup4.png)

### Через локальное меню
Чтобы создать новый бэкап через локальное меню Ideco NGFW, выполните действия: 

1\. Выберите пункт **10** и нажмите **Enter**. 

2\. Введите комментарий для бэкапа и нажмите **Enter**.

Пример создания бэкапа через локальное меню приведен на скриншоте ниже:

![](/.gitbook/assets/local-menu3.png)

{% hint style="info" %}
Настройка сохранения бэкапа в сетевом файловом хранилище возможна только через веб-интерфейс Ideco NGFW. Выгрузка на внешние сетевые хранилища производится только при автоматическом создании бэкапа.
{% endhint %}

## Восстановление конфигурации из бэкапа

В NGFW восстановление из бэкапа возможно полное и мгновенное.

При выполнении полного восстановления система будет перезагружена для применения настроек сервера.

При выполнении мгновенного восстановления бэкап применятся без перезагрузки. При этом не сохраняются:
* Счетчики квот;
* Системный журнал.

{% hint style="warning" %}
При восстановлении системы из резервной копии информация о лицензии не будет восстановлена, поскольку это может привести к использованию устаревшей лицензии.

После завершения процесса восстановления Ideco NGFW автоматически отправит запрос в личный кабинет для обновления лицензии. Если используется офлайн-лицензия, ее необходимо загрузить самостоятельно.

Если вы используете резервное копирование для переноса настроек с одного сервера на другой, выполните "перепривязку" лицензии. Подробную информацию вы можете найти в [статье](/recipes/popular-recipes/transferring-data-to-another-server#etap-6-privyazka-licenzii-k-vosstanovlennomu-iz-bekapa-serveru).
{% endhint %}

{% hint style="info" %} 
Полное восстановление возможно либо на текущую версию, либо на предыдущую мажорную версию. Например, на версии 17 возможно полное восстановление бэкапа версии 16 или версии 17. 

Мгновенное восстановление возможно только для бэкапа версии, полностью совпадающей с установленной на сервере.
{% endhint %}

### Через веб-интерфейс

Перейдите в раздел **Управление сервером -> Бэкапы -> Бэкапы** и нажмите кнопку **Полное восстановление** (![](/.gitbook/assets/icon-recovery.png)) или **Мгновенное восстановление** (![](/.gitbook/assets/mg-recovery.png)) в столбце **Управление**. 

Также можно загрузить бэкап из файла. Например, в случае переноса с другого сервера. Для восстановления конфигураций бэкапа, который находится на внешнем носителе, перейдите на **Управление сервером -> Бэкапы -> вкладка Бэкапы**, нажмите на кнопку **Добавить** и выберите **Загрузить из файла**:

![](/.gitbook/assets/backup2.png)

### Через локальное меню

Перейдите в локальное меню и выполните действия:

1\. Выберите пункт:
* **11** - восстановятся все настройки и перезагрузится сервер;
* **12** - восстановятся все настройки без перезагрузки сервера, кроме изменений в списке пользователей и отчетах.

  Нажмите **Enter**. 

2\. Выберите из списка бэкап, введя пункт нужной копии, и нажмите **Enter**. 

3\. Перезагрузите сервер при запуске полного восстановления, введя **y**, а затем **Enter**. При мгновенном восстановлении перезагрузка не нужна.

Пример восстановления из бэкапа через локальное меню:

![](/.gitbook/assets/local-menu4.png)

{% hint style="info" %}
Чтобы перенести установленный Ideco NGFW с одного сервера на другой с сохранением всех настроек, воспользуйтесь статьей [Перенос данных и настроек на другой сервер](/recipes/popular-recipes/transferring-data-to-another-server.md).
{% endhint %}

{% hint style="warning" %}
Если на Ideco NGFW настроен кластер, то перед работой с бэкапами нужно ознакомиться с особенностями работы бэкапов:

* Невозможно полное восстановление из бэкапов. При этом можно создать резервную копию и после разрушения кластера восстановить копию на ноде, которая была активной;

* На активной ноде доступно **Мгновенное восстановление из бэкапа**. Восстанавливаются все настройки, кроме изменений в списке пользователей и отчетах. Данные на второй ноде также придут в соответствие с восстановленными настройками после синхронизации нод.
{% endhint %}