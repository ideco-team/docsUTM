---
description: >-
  В этом разделе находится описание процесса создания и восстановления бекапа интернет-шлюза Ideco NGFW.
---

# Бекапы

Бекап - это предварительно созданная резервная копия данных, позволяющая восстановить большинство настроек и сохраненной информации.

{% hint style="success" %}
Название служб раздела **Бекапы**: `ideco-backup-backend`; `ideco-backup-create`; `ideco-backup-restore`; `ideco-backup-rotate`.\
Список служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

В NGFW создается только полный бекап, который включают в себя все настройки, созданные администратором в веб-интерфейсе.

Бекапы не включают в себя:

* Журнал событий;
* Почту;
* Статистику web-трафика и другие отчеты;
* Любые кешируемые данные; базы антивирусов, правила IPS и т. п.;
* Настройки созданных [VCE](/settings/server-management/vce.md);
* Любые данные, генерируемые в процессе работы системы автоматически.

{% hint style="info" %} В бекап корневого VCE не входят данные и настройки, которые содержатся в дочерних VCE. Чтобы обеспечить полное сохранение данных, создайте бекап отдельно по корневому VCE и по каждому из дочерних VCE.
{% endhint %}

В NGFW бекап создается как автоматически, так и вручную.

## Автоматическое создание бекапа
Для настройки автоматического бекапа перейдите в раздел **Управление сервером -> Бекапы -> Настройки**:

![](/.gitbook/assets/backup17.png)

Установите время ежедневного создания и продолжительность хранения бекапа на локальном жестком диске. При настройке выгрузки на сетевое файловое хранилище автоматический бекап будет также дублироваться туда.

* **Время ежедневного создания копии** - укажите в настройках час (рекомендуется выбирать ночное время для создания бекапа);

* **Хранить в течение** - хранить бекапы на локальном жестком диске можно в течение недели или месяца.

{% hint style="info" %} Каждый автоматически созданный бекап сохраняется в таблице бекапов с комментарием "Автоматическая резервная копия".{% endhint %}

Рекомендуется хранить бекапы не только на локальном жестком диске, но и на внешних носителях. NGFW предоставляет возможность выгружать бекапы:
* на сетевое файловое хранилище по протоколу FTP;
* на сетевое файловое хранилище по протоколу NetBIOS (CIFS);
* на ПК через кнопку **Скачать** в таблице бекапов (![](/.gitbook/assets/download.png)) для переноса с сервера на иной внешний носитель вручную.

### Бекапы на удаленное файловое хранилище по протоколу FTP 

Ключевые параметры, необходимые для настройки бекапа на FTP-сервер, описаны в таблице:

<table><thead><tr><th width="188">Параметр</th><th>Описание</th></tr></thead><tbody><tr><td>Адрес сервера</td><td>IP-адрес удаленного FTP-сервера, на котором будут размещаться бекапы</td></tr><tr><td>Логин</td><td>Имя пользователя для авторизации на FTP-сервере</td></tr><tr><td>Пароль</td><td>Пароль для авторизации на FTP-сервере</td></tr><tr><td>Путь к каталогу</td><td>Каталог, в который будут записываться бекапы</td></tr></tbody></table>

### Бекапы на сетевое файловое хранилище по протоколу NetBIOS (CIFS)

Ключевые параметры, необходимые для настройки бекапа на NetBIOS-сервер, описаны в таблице.

<table><thead><tr><th width="189">Параметр</th><th>Описание</th></tr></thead><tbody><tr><td>Адрес сервера</td><td>IP-адрес удаленного NetBIOS-сервера, на котором будут размещаться бекапы</td></tr><tr><td>Логин</td><td>Имя пользователя для авторизации на сетевом ресурсе Windows</td></tr><tr><td>Пароль</td><td>Пароль для авторизации на сетевом ресурсе Windows</td></tr><tr><td>Путь к каталогу</td><td>Каталог, в который будут записываться бекапы</td></tr></tbody></table>

{% hint style="info" %}
Укажите путь к каталогу в UNIX-формате. К примеру, в ОС Windows каталог открывается по следующему пути `\\192.168.1.1\dir_1\dir_2\backup`, значит, в поле **Путь к каталогу** пропишите `dir_1/dir_2/backup`.
{% endhint %}

## Ручное создание бекапа

### Через веб-интерфейс

Для создания бекапа через интерфейс Ideco NGFW перейдите в **Управление сервером -> Бекапы -> Бекапы** и нажмите **Добавить -> Создать**. Введите комментарий и нажмите **Добавить** или нажмите ![](/.gitbook/assets/icon-backup.png) **Создать бекап** в правом верхнем углу веб-интерфейса. Новый бекап появится в таблице:

![](/.gitbook/assets/backup17-1.png)

### Через локальное меню
Чтобы создать новый бекап через локальное меню Ideco NGFW, выполните действия: 

1\. Выберите пункт **9** и нажмите **Enter**. 

2\. Введите комментарий для бекапа и нажмите **Enter**.

Пример создания бекапа через локальное меню приведен на скриншоте ниже:

![](/.gitbook/assets/backup5.png)

{% hint style="info" %}
Настройка сохранения бекапа в сетевом файловом хранилище возможна только через веб-интерфейс Ideco NGFW. Выгрузка на внешние сетевые хранилища производится только при автоматическом создании бекапа.
{% endhint %}

## Восстановление конфигурации из бекапа

В NGFW восстановление из бекапа возможно полное и мгновенное. 

При выполнении полного восстановления система будет перезагружена для применения настроек сервера.

При выполнении мгновенного восстановления бекап применяется без перезагрузки. При этом не сохраняются:
* Пользователи (с версии 17.5 восстановление пользователей доступно);
* Счетчики квот;
* Журнал событий.

{% hint style="info" %} Полное восстановление возможно либо на текущую версию, либо на предыдущую мажорную версию. Например, на версии 17 возможно полное восстановление бекапа версии 16 или версии 17. 

Мгновенное восстановление возможно только для бекапа версии, полностью совпадающей с установленной на сервере. {% endhint %}

### Через веб-интерфейс

Перейдите в раздел **Управление сервером -> Бекапы -> Бекапы** и нажмите кнопку **Полное восстановление** (![](/.gitbook/assets/icon-recovery.png)) или **Мгновенное восстановление** (![](/.gitbook/assets/mg-recovery.png)) в столбце **Управление**. 

Также можно загрузить бекап из файла. Например, в случае переноса с другого сервера. Для восстановления конфигураций бекапа, который находится на внешнем носителе, перейдите на **Управление сервером -> Бекапы -> вкладка Бекапы**, нажмите на кнопку **Добавить** и выберите **Загрузить из файла**:

![](/.gitbook/assets/backup17-2.png)

### Через локальное меню

Перейдите в локальное меню и выполните действия:

1\. Выберите пункт:
* **10** - восстановятся все настройки и перезагрузится сервер;
* **11** - восстановятся все настройки без перезагрузки сервера, кроме использованного трафика по квотам, изменений в списке пользователей и отчетах.

  Нажмите **Enter**. 

2\. Выберите из списка бекап, введя пункт нужной копии, и нажмите **Enter**. 

3\. Перезагрузите сервер при запуске полного восстановления, введя **y**, а затем **Enter**. При мгновенном восстановлении перезагрузка не нужна.

Пример восстановления из бекапа через локальное меню:

![](/.gitbook/assets/backup6.png)

{% hint style="info" %}
Чтобы перенести установленный Ideco NGFW с одного сервера на другой с сохранением всех настроек, воспользуйтесь статьей [Перенос данных и настроек на другой сервер](/recipes/popular-recipes/transferring-data-to-another-server.md).
{% endhint %}

{% hint style="warning" %}
Если на Ideco NGFW настроен кластер, то перед работой с бекапами нужно ознакомиться с особенностями работы бекапов:

* Невозможно полное восстановление из бекапов. При этом можно создать резервную копию и после разрушения кластера восстановить копию на ноде, которая была активной;

* На активной ноде доступно **Мгновенное восстановление из бэкапа**. Восстанавливаются все настройки, кроме использованного трафика по квотам, изменений в списке пользователей и отчетах. Данные на второй ноде также придут в соответствие с восстановленными настройками после синхронизации нод.
{% endhint %}