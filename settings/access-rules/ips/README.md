---
description: Система обнаружения и предотвращения вторжений.
---

# Предотвращение вторжений
{% hint style="success" %}
Название службы раздела **Предотвращение вторжений**: `ideco-suricata-backend`; `ideco-suricata`; `ideco-suricata-event-syncer`; `ideco-suricata-profiles-syncer`. \
Список имен служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

{% hint style="success" %}
Видеоинструкцию смотрите по ссылкам:
* [Rutube](https://rutube.ru/video/51ab34552faab4f364f6122ad1001a72/);
* [Youtube](https://youtu.be/LfsQ0VeH_Z8).
{% endhint %}

**Система Предотвращения вторжений** (IDS/IPS, Intrusion detection system / Intrusion prevention system) предназначена для:

* [x] Обнаружения;
* [x] Журналирования;
* [x] Предотвращения атак злоумышленников на сервер, интегрированные службы и локальную сеть. 

{% hint style="warning" %}
Система **Предотвращения вторжений** доступна только в **Enterprise-версии Ideco NGFW** для пользователей с активной подпиской на обновления.
{% endhint %}

Включите систему в разделе **Правила трафика -> Предотвращение вторжений**:

![](/.gitbook/assets/ips10.png)

Раздел состоит из трех вкладок:

* [Группы сигнатур](rules.md) - содержит список предустановленных групп сигнатур, либо распределенных по тактикам в соответствии с матрицей MITRE ATT&CK (матрица тактик и техник кибератак), либо в табличном виде;
* [Пользовательские сигнатуры](custom-signatures.md) - позволяет добавить сигнатуры для обработки системой **Предотвращения вторжений**;
* [Настройки](settings.md) - содержит информацию об обновлении баз IPS и сетях, защищенных от вторжений.

Предустановленные группы правил (сигнатур) включают блокирование вредоносного ПО, P2P-сетей, криптомайнеров, средств для обхода правил фильтрации и т.д.

С 18 версии Ideco NGFW механизм работы системы **Предотвращения вторжений** изменился, появились возможности:

* [x] Работать с правилами IPS на уровне сигнатур, фильтровать их и просматривать в удобном виде;
* [x] Составлять независимые друг от друга наборы правил IPS и применять их только к необходимому трафику с помощью профилей системы **Предотвращения вторжений**, которые назначаются в правилах **Файрвола**.

{% hint style="danger" %}
Чтобы модуль обрабатывал трафик, необходимо сначала создать профили IPS в разделе **Профили безопасности -> [Предотвращение вторжений](/settings/security-profiles/ips-profiles/README.md)**, а затем использовать их в правилах **Файрвола**.

**В отбработке трафика не участвуют**:
* сигнатуры, не используемые в профилях;
* профили, не используемые в правилах **Файрвола**.
{% endhint %}

<details>

<summary>Технические требования</summary>

Для работы системы **Предотвращения вторжений** требуются значительные вычислительные ресурсы. Предпочтительным являются многоядерные (4 и более) процессоры. Минимальное количество оперативной памяти для использования системы: 16 Гб.

После включения системы проконтролируйте, что мощности вашего процессора достаточно для проверки трафика, следующего через шлюз. \
В разделе **Мониторинг -> [Графики загруженности](/settings/monitor/workload-schedule.md)** выберите параметр средняя загрузка (за 1, 5 и 15 минут).

Подробнее о [Load Average](https://habr.com/ru/company/vk/blog/335326/).

</details>

## Особенности обработки трафика системой Предотвращения вторжений

**Файрвол** Ideco NGFW анализирует трафик для поиска подходящего правила и применяет его. Если в таблице есть несколько правил с одними и теми же условиями, применяется правило, стоящее выше по списку. Запрещающие правила **Файрвола** сразу блокируют соответствующий трафик, он не проходит дополнительную проверку в модуле **Предотвращение вторжений**.

Чтобы через модуль **Предотвращение вторжений** проходил трафик, для которого нет разрешающего правила в таблице **FORWARD** или **INPUT**, рекомендуем создать и включить в файрволе правило с источником **Любой** и назначением **Любой**, разместив его в конец таблицы. В этом случае трафик, который не был найден в правилах **Файрвола**, но соответствует профилям IPS, пройдет проверку системой **Предотвращения вторжений**.

{% hint style="info" %}
Если в одном правиле **Файрвола** включены проверки и **Контролем приложений**, и системой **Предотвращения вторжений**, трафик сначала попадет в обработку DPI, затем - IPS.
{% endhint %}

Чтобы трафик фильтровался системой **Предотвращение вторжений**, создайте для всех локальных интерфейсов правило **FORWARD**, содержащее нужный профиль безопасности.

**Важно:** при включенной опции **Перехват пользовательских DNS-запросов** в разделе **Сервисы -> Защита и управление DNS -> Внешние DNS-серверы** трафик обрабатывается не как FORWARD, а как INPUT:

![](/.gitbook/assets/application-control5.png)

Если опция **Перехват пользовательских DNS-запросов** включена (по умолчанию включена), создайте правила **INPUT** для протоколов TCP и UDP с тем же профилем безопасности, источником и портом 53 в разделе **Назначение**.