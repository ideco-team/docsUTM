---
description: Настройка контент-фильтра и диагностика неполадок.
---

# Контент-фильтр

Контентная фильтрация на сервере Ideco UTM реализована на основе данных о веб-трафике, получаемых от модуля проксирования веб-трафика. Таким образом, контент-фильтр позволяет эффективно блокировать доступ к различным интернет-ресурсам.

Механизм контентной фильтрации заключается в проверке принадлежности адреса, запрашиваемого пользователем сайта или отдельной страницы сайта, на наличие его в списках запрещенных ресурсов. Списки в свою очередь поделены на категории для удобства администрирования.

{% hint style="warning" %}
Модуль контент-фильтра работает только при активной подписке на обновления в редакции Enterprise.
{% endhint %}

{% hint style="info" %}
HTTPS-сайты без расшифровки трафика фильтруются только по домену (а не полному URL), правила категории **Файлы** на них также применить невозможно. Для полной фильтрации HTTPS создавайте правила расшифровки HTTPS-трафика нужных категорий.
{% endhint %}

***

## Настройка и категории контент-фильтра

<details>

<summary>Настройка контент-фильтра</summary>

Перейдите в раздел **Правила трафика -> Контент-фильтр** и активируйте базу расширенного контент-фильтра, переключив ползунок в положение **Включено** у пункта **Расширенная база категорий**.

<img src="../../../.gitbook/assets/kf-base.gif" alt="" data-size="original">

На вкладке **Настройки** можно настроить дополнительные параметры фильтрации:

* **Блокировать протоколы QUIC и HTTP/3.** Экспериментальный протокол, используемый браузером Chrome для доступа к некоторым ресурсам (например, youtube). Рекомендуется блокировать его, т.к. иначе фильтрация ресурсов, работающих по этому протоколу, будет невозможна.
* **Безопасный поиск.** Принудительно включает безопасный поиск в поисковых системах (google, yandex, youtube, yahoo, bing, rambler). **Для работы данной функции нужно включить HTTPS-фильтрацию методом подмены сертификата для данных ресурсов**.

<img src="../../../.gitbook/assets/kf-set.png" alt="" data-size="original">

</details>

***

<details>

<summary>Категории контент-фильтра</summary>

* **Расширенная база категорий**. Более 140 категорий, включающих миллионы URL, автоматически обновляемых сервером. Статус обновлений и использование базы можно посмотреть на вкладке **Настройки** в разделе Контент-фильтра. Данные категории работают только при активной подписке на обновления в коммерческих редакциях.
* **Пользовательские категории**. На одноименной вкладке вы можете создавать собственные категории правил.

<img src="../../../.gitbook/assets/kf-custom-cat.png" alt="" data-size="original">

* **Специальные**. Включает 4 категории - все запросы, все категоризированные запросы, все некатегоризированные запросы и запросы с прямыми обращениями по IP-адресам.
* **Файлы**. Восемь сформированных категорий файлов, блокируемых по расширениям и MIME-type. Предустановленные группы файлов (Исполняемые файлы, Архивы, Видеофайлы, Аудиофайлы, Flash-видео, Active-X, Torrent-файлы, Документы) нельзя редактировать. Работа по фильтрации HTTPS-трафика по данному типу категорий возможна только при его расшифровке.

Подробное описание **расширенных** и **специальных** категорий представлено в статье [Описание категорий контент фильтра](custom-categories.md).

</details>

## Применение правил

<details>

<summary>Применение правил фильтрации для пользователей</summary>

Правила применяются сверху вниз в порядке следования в таблице до первого совпадения. Таким образом если вышестоящим правилом будет разрешен какой-то ресурс для определенной группы пользователей, то правила ниже применяться не будут. Таким образом можно создавать гибкие настройки фильтрации, исключая нужных пользователей вышестоящими правилами из правил блокировки. Аналогичным образом действуют правила расшифровки HTTPS.

В столбце **Управление** можно активировать или деактивировать правило, менять его приоритет, редактировать и удалить. Правила контентной фильтрации применяются сразу после создания или их включения.

<img src="../../../.gitbook/assets/kf-manage.gif" alt="" data-size="original">

Чтобы создать новое правило, нажмите **Добавить** в левом верхнем углу над таблицей.

<img src="../../../.gitbook/assets/kf-add-rule.gif" alt="" data-size="original">

Заполните следующие поля:

* **Название** - наименование правила в списке. Значение не должно быть длиннее 42 символов.
* **Применяется для** - можно выбрать объекты типа: пользователь, группа пользователей, IP-адрес, диапазон IP-адресов, подсеть, список IP-адресов или специальный объект **Превышена квота** (в этот объект попадают пользователи, превысившие квоту по трафику).
* **Категории сайтов** - пользовательские, специальные и расширенные категории веб-ресурсов.
* **Действие** - действие данного правила на веб-запросы. Можно запретить, разрешить или расшифровать HTTPS-трафик.

<img src="../../../.gitbook/assets/kf_form.png" alt="" data-size="original">

</details>

***

<details>

<summary>Диагностика</summary>

Если правила контентной фильтрации не действуют, проверьте следующие параметры в настройках:

1\. IP-адрес компьютера пользователя должен соответствовать его адресу в авторизации (раздел **Мониторинг - Авторизованные пользователи**), и пользователь должен находиться в нужной группе, на которую назначено правило.

2\. IP-адрес пользователи и ресурса, к которому он обращается, не должен входить в исключения прокси-сервера.

3\. Проверьте правильность категоризации ресурса к которому вы обращаетесь в поле **URL для категоризации** на вкладке **Правила**.

<img src="../../../.gitbook/assets/url-categories.gif" alt="" data-size="original">

4\. В браузере и на компьютере пользователя не используются функции или плагины VPN, не прописаны сторонние прокси-сервера.

5\. Проверить настройки контентной фильтрации по блокировке опасных и потенциально опасных файлов можно с помощью сервиса [security.ideco.ru](https://security.ideco.ru).

</details>
