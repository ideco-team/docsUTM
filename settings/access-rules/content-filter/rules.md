---
description: 
  В статье рассказывается о настройке и применении правил Контент-фильтра.
---

# Правила

Правила создаются на вкладке **Правила трафика -> Контент-фильтр -> Правила**. Помимо возможности добавления правил **Контент-фильтра**, вкладка содержит:

* **Строку поиска категории URL для категоризации**. Позволяет найти, к какой категории относится URL для создания правила.
* **Таблицу созданных правил**. Правила применяются сверху вниз в порядке следования в таблице до первого совпадения. Таким образом, если вышестоящим правилом будет разрешен какой-то ресурс для определенной группы пользователей, то правила ниже применяться не будут. Можно создавать гибкие настройки фильтрации, исключая нужных пользователей вышестоящими правилами из правил блокировки. Аналогичным образом действуют правила расшифровки HTTPS.

## Создание правил

1\. Нажмите **Добавить** и заполните поля:

![](/.gitbook/assets/content-filter26.png)

<details>

<summary>Расшифровка полей</summary>

* **Название** - название добавляемого правила.
* **Применяется для** - пользователь или группа пользователей, IP-адреса или список IP-объектов, для которых применяется правило.
* **Категории сайтов** - поле для выбора [предустановленной или пользовательской категории](/settings/access-rules/content-filter/custom-categories.md), перечень ресурсов, на которые распространяется действие правила.

{% hint style="info" %}
Для расшифрованного трафика при создании и редактировании правила **Контент-фильтра** доступны более детальные настройки доступа к ресурсам с помощью HTTP-методов запроса и MIME-типов. Если поля остаются пустыми, проверка по ним не осуществляется.
{% endhint %}

* **HTTP-методы** - методы запроса, которые будут применяться для всего HTTP- или HTTPS-трафика. Используются для более точной фильтрации трафика, например, для ограничения скачивание чего-либо на сайтах, заполнение форм и т.п.. Доступные методы:
  * GET - извлечение данных ресурса, содержащих тело ответа.
  * HEAD - извлечение данных ресурса, не содержащих тело ответа.
  * POST - отправка данных на определенный ресурс.
  * PUT - замена текущих значений ресурса.
  * DELETE - удаление ресурса.
  * OPTIONS - описание параметров соединения с ресурсом.
  * PATCH - частичное изменение ресурса.
  * TRACE - вызов возвращаемого тестового сообщения с ресурса.
  * CONNECT - установка соединения с ресурсом.

* **MIME-типы** - форматы содержимого, к которым будет применяться правило. Форматы объединены в группы в зависимости от типа контента. Например, Audio (mp4, wav, wave и др.), Video (jpeg, mpeg, jmp и др.), Image (bmp, gif, png и др.). Настройки можно применить как к группе форматов, так и каждому формату отдельно.

* **Действия**:
  * **Запретить** - запрещает трафик.
  * **Разрешить** - разрешает трафик или направляет его в модули фильтрации трафика.
  * **Перенаправить на** - позволяет указать URL, на который будет перенаправлен расшифрованный трафик.
  * **Расшифровать** - расшифровывает трафик с HTTPS сайтов.

{% hint style="info" %}
Если выбрать действие **Перенаправить на**, то нужно создать аналогичное правило с действием **Расшифровать** и поместить его выше перенаправляющего правила.
{% endhint %}

* **Дополнительно**:
  * **Время действия** - время действия правила. Указываются временные промежутки (например, **Рабочее время**), которые определяются в [Объектах](/settings/access-rules/aliases.md). По умолчанию установлено значение **Любой**.
  * **Комментарий** - произвольный текст. Значение не должно быть длиннее 255 символов.

</details>

2\. Для подтверждения создания правила нажмите **Добавить**.

## Управление правилами

В столбце **Управление** можно включать или выключать правило, менять его приоритет, редактировать и удалять. Правила контентной фильтрации применяются сразу после создания или включения:

![](/.gitbook/assets/content-filter1.gif)

При наличии большого количества правил **Контент-фильтра** в таблице воспользуйтесь кнопкой **Фильтры**.

## Дополнительно

<details>

<summary>Пример настройки HTTP-метода</summary>

Необходимо запретить пользователям вводить данные на запрещенных сайтах. 

Перейдите в раздел **Правила трафика -> Контент-фильтр -> Правила** и нажмите **Добавить**. Заполните поля:

![](/.gitbook/assets/content-filter27.png)

* **Применяется для** - выберите пользователей, для которых будет работать правило.
* **Категории сайтов** - выберите категорию сайтов, для которых должно работать правило, например, **Запрещенные сайты**. 
* **HTTP-методы** - выберите метод `POST`, чтобы запретить отправку данных на определенный ресурс.
* Выберите **Запретить**, чтобы правило работало как запрещающее.

При сохранении правила сайты будут открываться, но пользователь не сможет отправить данные (например, заполнить форму обратной связи или ввести логин и пароль).

</details>

<details>

<summary>Пример настройки MIME-типов</summary>

Необходимо запретить конкретному пользователю (например, User1) воспроизводить видеоконтент на запрещенных сайтах. 

Перейдите в раздел **Правила трафика -> Контент-фильтр -> Правила** и нажмите **Добавить**. Заполните поля:

![](/.gitbook/assets/content-filter28.png)

В поле **Категории сайтов** укажите предварительно созданную пользовательскую категорию **Запрещенные сайты**. В поле **MIME-типы** выберите все форматы группы **Video**. Примените действие правила **Запретить**. При сохранении правила сайт откроется, если трафик не заблокирован другим правилом, но видеоконтент не воспроизведется.

</details>

<details>

<summary>Диагностика</summary>

Если правила контентной фильтрации не действуют, проверьте следующие параметры в настройках:

* IP-адрес компьютера пользователя должен соответствовать его адресу в авторизации (раздел **Мониторинг - Сессии пользователей**), пользователь должен находиться в нужной группе, на которую назначено правило.
* IP-адрес пользователя и ресурса, к которому обращается, не должен входить в исключения прокси-сервера.
* Проверьте правильность категоризации ресурса, к которому обращаетесь, в поле **URL для категоризации** на вкладке **Правила**:

![](/.gitbook/assets/content-filter2.gif)

<!-- Для этого вставьте в поле ссылку на ресурс, который требуется категоризировать, и нажмите **Найти категории**. Категории, в которые входит URL, отобразится ниже. -->

* В браузере и на компьютере пользователя не используются функции или плагины VPN, не прописаны сторонние прокси-серверы.

* Проверить настройки контентной фильтрации по блокировке опасных и потенциально опасных файлов можно с помощью сервиса [security.ideco.ru](https://security.ideco.ru).

{% hint style="info" %}
Если сайт неправильно категоризирован, воспользуйтесь формой обратной связи [SkyDNS](https://www.skydns.ru/contact-us).
{% endhint %}

</details>

<details>

<summary>Блокировка загрузки файлов в файлообменники</summary>

Блокирование этой категории требует особой настройки правил **Контент-фильтра**. В случае с файлообменниками расшифровки трафика может быть недостаточно у категорий: **Файлообменники, Файловые хранилища, Файловые архивы** и **Загрузка файлов в файлообменники**.

Чтобы заблокировать загрузку файлов в облака через браузер, выполните действия:

1\. Включите **Блокировку протоколов Quic/HTTP3** на вкладке **Контент-фильтр -> Настройки**:

  ![](/.gitbook/assets/content-filter.png)

2\. Создайте пользовательскую категорию для расшифровки трафика и укажите домены нужных файлообменников, используя маску `example.com`:

  ![](/.gitbook/assets/content-filter1.png)

3\. Создайте правило, расшифровывающее трафик созданной в п. 2 категории:

  ![](/.gitbook/assets/content-filter2.png)

4\. Ниже создайте запрещающее правило для категории **Загрузка файлов в файлообменник**:

  ![](/.gitbook/assets/content-filter3.png)

5\. Проверьте, работает ли блокировка: с устройства пользователя, для которого настроена, зайдите на сайты нужных файлообменников и попробуйте загрузить файлы.\
Если загрузка проходит, то:

* Добавьте в пользовательскую категорию домены файлообменников, используя любые варианты масок: `subdomain.example.com`, `*.subdomain.example.com`, `subdomain.example.com/home`, `*.example.com`.
* Создайте в **Контент-фильтре** правило, расшифровывающее весь трафик пользователя, а ниже - правило, запрещающее загрузку файлов в файлообменники:

![](/.gitbook/assets/content-filter4.png)

{% hint style="info" %}
Если не удалось выполнить настройку, то обратитесь в [Техническую поддержку](/general/technical-support.md).
{% endhint %}

</details>