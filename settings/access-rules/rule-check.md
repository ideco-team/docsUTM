---
description: >-
  В статье описана настройка проверок правил Файрвола Ideco NGFW.
---

# Проверка работы правил

На вкладке создаются проверки для тестирования правил таблицы FORWARD и INPUT.

**Проверка** - это конкретный пример, в котором происходит тестирование доступа до определенного IP-адреса с учетом правил таблицы **Файрвола**. NGFW генерирует тестовый пакет с заданным источником и назначением, после чего проверяет, как пакет проходит через **Файрвол**.

{% hint style="success" %}
Рекомендуем использовать для источника порты из диапазона 49152 - 65535 (динамически выделяемые или частные порты, которые не регистрируются IANA).
{% endhint %}

## Создание проверок

В качестве интерфейса источника можно выбрать:

* Туннельный (GRE).
* Локальный Ethernet.
* Внешний Ethernet.
* Внешний Ethernet + PPTP.
* Внешний Ethernet + L2TP.
* Внешний Ethernet + PPPoE.

Для создания проверки выполните действия:

1\. Перейдите на вкладку **Правила трафика -> Файрвол -> Проверка работы правил** и нажмите **Добавить**.

2\. Заполните поля:

![](/.gitbook/assets/firewall33.png)

<details>
<summary>Расшифровка полей</summary>

* **Протокол** (**TCP**/**UDP**).
* **IP-адрес** - адрес  источника и назначения.
* **Порт** - порт источника и назначения.
* **Интерфейс** - сетевой интерфейс источника.
* **Ожидаемое действие** - Разрешить или Запретить.
* **Комментарий** - необязательное поле.

</details>

3\. Нажмите **Добавить проверку**.

Созданные проверки добавляются в таблицу:

![](/.gitbook/assets/firewall34.png)

## Запуск и результат тестирования

Запуск проверок не происходит автоматически при добавлении. Для начала тестирования:

1\. Включите нужные проверки ![](/.gitbook/assets/icon-on.png).

2\. Нажмите **Запустить проверку** в левом нижнем углу вкладки.

{% hint style="warning" %}
Если проверка выключена, то ее тестирование запускаться не будет.
{% endhint %}

При совпадении ожидаемого и фактического действия тестирование проверки считается успешным:

![](/.gitbook/assets/firewall35.png)

Залогированные правила вида `fwd.sys.xxx`, `inp.sys.xxx`, `out.sys.xxx` в столбце **Правило** - результат срабатывания системного правила, которое разрешило или запретило прохождение трафика в рамках проверки, если не сработало ни одно пользовательское правило. Это правила **Файрвола**, которыми нельзя управлять из веб-интерфейса Ideco NGFW, они всегда включены. Правила Forward System и Input System имеют приоритет над пользовательскими правилами **Файрвола**. Посмотреть системное правило, которое сработало, можно через [Терминал](/settings/server-management/terminal/README.md).

Если у выбранной проверки **Интерфейс** источника был удален (отображается **Удалено** в столбце **Интерфейс**), тестирование проверки завершится с фактическим действием **Запретить**.

{% hint style="warning" %}
Не рекомендуем включать опцию **Блокировать весь трафик в случае неудачной проверки**, иначе при любом неуспешном результате проверки (обозначен ![](/.gitbook/assets/icon-red-cross.png)) весь трафик через NGFW будет заблокирован. Единственный способ снятия блокировки - тестирование без ошибок. Отключение опции не сработает:

![](/.gitbook/assets/firewall36.png)
{% endhint %}

В правом нижнем углу вкладки представлены сведения о последней проверке: текущий статус (**Успешно**/**Ошибка**), время проведения и количество неуспешных правил (из числа включенных в столбце **Управление**):

![](/.gitbook/assets/firewall37.png)

Повторный запуск сбрасывает результаты предыдущей проверки.