# Тестирование правил

На вкладке создаются кейсы для тестирования правил таблицы FORWARD и INPUT.

Тест (кейс) - это конкретный пример, в котором происходит тестирование доступа до определенного IP-адреса с учетом правил таблицы **Файрвола**. Кейс является единицой тестирования.

Для тестирования правил необходимо указывать порт источника. Это связано с тем, что во время тестирования NGFW генерирует тестовый пакет с заданным источником и назначением и проверяет, как он проходит через **Файрвол**.

{% hint style="success" %}
Рекомендуем у источника использовать порты из диапазона 49152 - 65535 (динамически выделяемые или частные порты, которые не регистрируются IANA).
{% endhint %}

## Создание тестов

{% hint style="info" %}
В качестве интерфейса источника можно выбрать следующие типы интерфейсов:

* Тунельные (GRE)
* Локальный Ethernet
* Внешний Ethernet
* Внешний Ethernet + PPTP
* Внешний Ethernet + L2TP
* Внешний Ethernet + PPPoE

{% endhint %}

Для создания теста выполните действия:

1\. Перейдите на вкладку **Правила трафика -> Файрвол -> Тестирование правил** и нажмите **Добавить**.

2\. Заполните поля:

![](/.gitbook/assets/firewall33.png)

* **Протокол** (**TCP**/**UDP**);
* **IP-адрес** источника и назначения;
* **Порт** источника и назначения;
* **Интерфейс** источника;
* **Ожидаемое действие** (Разрешить или Запретить);
* **Комментарий**.

3\. Нажмите **Добавить**.

Созданные тесты добавляются в таблицу:

![](/.gitbook/assets/firewall34.png)

## Запуск и результат тестирования кейса

Запуск тестирования кейса не происходит автоматически при его добавлении. Для запуска:

1\. Включите нужный кейс ![](/.gitbook/assets/icon-on.png).

2\. Нажмите **Запустить тестирование** в левом нижнем углу вкладки.

{% hint style="warning" %}
Если кейс не включить, то его тестирование запускаться не будет.
{% endhint %}

При совпадении ожидаемого и фактического действия тестирование кейса считается успешным:

![](/.gitbook/assets/firewall35.png)

Залогированные правила вида `fwd.sys.xxx`, `inp.sys.xxx`, `out.sys.xxx` в столбце\
**Правило** - результат срабатывания системного правила, которое разрешило или запретило прохождение трафика в рамках данной проверки, если не сработало ни одно пользовательское правило.

Если у выбранного кейса **Интерфейс** источника был удален (отображается **Удалено** в столбце **Интерфейс**), тестирование кейса завершится с фактическим действием **Запретить**.

{% hint style="warning" %}
Не рекомендуем включать опцию **Блокировать весь трафик в случае неудачного теста**, иначе при любом неуспешном результате теста (обозначен ![](/.gitbook/assets/icon-red-cross.png)) весь трафик через NGFW будет заблокирован. Единственный способ снятия блокировки - тестирование кейса без ошибок. Отключение опции не сработает:

![](/.gitbook/assets/firewall36.png)
{% endhint %}

В правом нижнем углу вкладки представлены сведения о последнем тестировании: текущий статус (**Успешно**/**Ошибка**), время проведения и количество неуспешных кейсов (из числа включенных в столбце **Управление**):

![](/.gitbook/assets/firewall37.png)

Повторный запуск сбрасывает результаты предыдущего тестирования.