---
description: В Ideco NGFW есть возможность использовать лимиты трафика для пользователей.
---

# Квоты

{% hint style="success" %}
Название службы раздела *Квоты*: `ideco-quotas-backend`; `systemd-quotacheck`. \
Список имен служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

Для каждой квоты можно определить ее период действия (час, день, неделя, месяц, квартал). Она может быть назначена пользователям или группам в дереве пользователей на отдельной вкладке **Квота**. Также на этой вкладке можно увеличить и посмотреть доступный трафик на текущий период времени и узнать, когда произойдет сброс квоты.

Если квота назначена на группу, то по умолчанию она назначается на всех пользователей данной группы, а также на вложенные группы. Наследуемая от группы квота меняется в свойствах вложенного пользователя или группы.

{% hint style="info" %}
При превышении квоты пользователи попадают в объект **Превышена квота**, по умолчанию для таких пользователей никакие ограничения не действуют. Поэтому необходимо создать ограничивающее правило для объекта **Превышена квота** в одном или нескольких модулях Ideco NGFW (файрвол, контент-фильтр, контроль приложений, ограничение скорости).
{% endhint %}

## Настройка квоты

{% hint style="warning" %}
Для работы всех квот активируйте опцию напротив раздела **Квоты**. При отключении этой опции все квоты, назначенные пользователем сохраняются за ними, но перестают действовать.
{% endhint %}

Для настройки квоты выполните следующие действия:

1\. Перейдите в раздел **Правила трафика -> Квоты** и нажмите на кнопку **Добавить**.

2\. В форме добавления квоты заполните обязательные поля:

![](/.gitbook/assets/quotas.png)

* **Название** - введите произвольное название для квоты;
* **Ограничение (МБ)** - задайте ограничение по количеству мегабайт трафика за выбранный период;
* **Период действия ограничения** - выберите период действия, на который будет выделена квота. Время определяется часовым поясом сервера:
  * **День** - с 00:00 по 23:59;
  * **Неделя** - с 00:00 понедельника по 23:59 воскресенье;
  * **Месяц** - с 00:00 1 числа по 23:59 последнего дня месяца;
  * **Квартал** - начало кварталов: 1 января, 1 апреля, 1 июля, 1 октября.
  
3\. Проверьте правильность введенных данных и нажмите на кнопку **Добавить**.

Управление квотами осуществляется с помощью кнопок в столбце **Управление**. Можно отключить или включить квоту, отредактировать или удалить:

![](/.gitbook/assets/quotas1.png)

## Настройка пользователя и группы

<details>

<summary>Настройка группы</summary>

Созданные квоты можно применить для групп пользователей на вкладке **Квота**.

Можно наследовать квоту от вышестоящей группы или выбрать другую квоту, для этого потребуется деактивировать опцию **Наследовать квоту от группы** и выбрать нужную квоту:

![](/.gitbook/assets/tree.gif)

<!-- Для этого выберите нужную группу, перейдите на вкладку **Квота**, отключите опцию **Наследовать квоту от группы** и из раскрывающегося списка выберите нужную квоту. -->

У группы **Все** имеется отдельная опция **Использовать квоты**. Этот параметр позволяет распространить использование квот для всех пользователей:

![](/.gitbook/assets/tree1.gif)

</details>

<details>

<summary>Настройка пользователей</summary>

Созданные квоты применяются для пользователей. Управление квотами происходит на вкладке **Квота** у выбранного пользователя:

![](/.gitbook/assets/tree2.png)

На этой вкладке можно настроить наследование квоты у группы, в которой состоит пользователь, или назначить ему персональную квоту.

Если квота назначена на пользователя, то можно посмотреть информацию о ней - период действия, доступный трафик и дату сброса квоты. Здесь же можно ее увеличить, указав нужное количество мегабайт и нажав на кнопку **Увеличить**.

Чтобы удалить квоту, необходимо снять ее со всех пользователей и групп. Иначе при попытке удаления квоты появится окно, запрещающее это действие. Это окно представлено на скриншоте ниже:

![](/.gitbook/assets/quotas2.png)

</details>

### Пример настройки действий при превышении квоты

Рассмотрим случай, когда пользователям, превысившим квоту (попавшим в объект **Превышена квота**), будет запрещен доступ ко всем социальным сетям и видеохостингам, а также ограничена скорость до 4 Мбит/с. Но одному пользователю доступ будет разрешен, даже в случае превышения квоты, так как этот сотрудник является маркетологом.

1\. Для начала необходимо создать квоту с ограничением, равным 2000 МБ в день.

2\. Во всех группах и у всех пользователей на вкладке **Квота** поставить опцию **Наследовать квоту от группы** в положение включен. Это нужно сделать только в том случае, если его положение менялось, так как по умолчанию все группы и пользователи создаются с включенным переключателем.

3\. На группу **Все** назначить созданную квоту (все остальные группы и пользователи унаследуют назначение этой квоты).

4\. Создать правило в [контент-фильтре](content-filter/README.md) для ограничения доступа к социальным сетям и видеохостингам для пользователей, превысивших квоту.

5\. Создать правило, которое разрешает одному из пользователей социальные сети, даже если он превысил квоту.

6\. Создать правило, ограничивающее скорость всем пользователям в разделе [Ограничение скорости](shaper.md), которые попали в объект **Превышена квота**, до 4 Мбит/с.
