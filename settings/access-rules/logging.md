---
description: >-
  Логирование срабатывания правил Файрвола: Forward, DNAT, SNAT и INPUT.
---

# Логирование

Логирование работает следующим образом:

Весть поступающий трафик в первую очередь проходит через модуль логирования. Если трафик соответствует установленным ограничениям по выборке правил и трафика, то получает метку о необходимости логирования. Если не соответствует, то метка о необходимости логирования не ставится. \
Далее трафик проходит через правила, установленные во вкладках Forward, DNAT, SNAT и INPUT. И если при срабатывании правила на трафике стояла метка логирования, то в логи попадет: 
* дата и время;
* имя файла, куда пишутся логи; 
* протокол;  
* исходный порт и порт назначения; 
* название раздела ;
* номер правила; 
* действие в сработанном правиле.

Логи записываются в системный журнал. Время хранения логов зависит от:

* Объема файла ();
* Времени ().

{% hint style="info" %}
Включите опцию **Логировать срабатывания правил** для начала логирования. 
{% endhint %}

Установка выборки правил описана в **Действии для логирования** и трафика в **Транзитный трафик между интерфейсами**.

## Транзитный трафик между интерфейсами

Создайте в таблице правила для трафика, срабатывания которого требуется логировать.

{% hint style="danger" %}
Если ни одно правило в таблице не задано, то срабатывания правил логироваться не будут, даже если выбраны **Действии для логирования** и включена опция **Логировать срабатывания правил**.
{% endhint %}

Проверка трафика по установленным в таблице ограничениям, проходит до конца таблицы (в отличаи от таблиц в других вкладках раздела Файвол). 

{% hint style="danger" %}
Если сначала стоит правило разрешающее логировать срабатывание правила файрвола, а следом запрещающее логировать это правило, то срабатывание логироваться не будет.
{% endhint %}

Таким образом предоставляется возможность более гибкой настройки логирования правил. Например, требуется настроить логирование всего трафика на yandex.ru, кроме трафика от пользователя Иванова Ивана с 08:00 до 16:00:

1\. Создайте правило, логирующее весь трафик на yandex.ru:

![](../../.gitbook/assets/logging.png)

2\. Создайте правило, запрещающее логировать трафик на yandex.ru от Иванова Ивана с 08:00 до 16:00:

![](../../.gitbook/assets/logging1.png)

{% hint style="info" %}
Не рекомендуем создавать правила, логирующее все срабатывания файрвола. Это загрузит ЦПУ, в следствии чего файрвол будет работать менее эффективно. 
{% endhint %}

## Действия для логирования

Выберите действия для правил раздела **Файрвол**, которые требуется логировать. Для выбора действий нажмите на ![](../../.gitbook/assets/icon-gear.png).

{% hint style="danger" %}
Если ни одно действие во вкладке **Логирование** не выбрано, то срабатывания правил логироваться не будут, даже если созданы правила в таблице **Транзитный трафик между интерфейсами** и включена опция **Логировать срабатывания правил**.
{% endhint %}
