---
description: Логирование срабатывания правил Файрвола.
---

# Логирование

## Принцип работы

Весь поступающий трафик в первую очередь проходит через правила вкладки **Логирование**. Если трафик соответствует критериям таблицы **Трафик для логирования**, то на пакете ставится виртуальная метка о необходимости логирования. По умолчанию метки нет.

Также необходимо, чтобы действие в сработавшем правиле файрвола было среди **Действий для логирования** во вкладке **Логирование**. Иначе срабатывание логироваться не будет.

Далее трафик проходит через правила в [таблицах файрвола](firewall-tables.md). Если при срабатывании правила на трафике стояла метка логирования и действие соответствовало выборке **Действий для логирования**, то в логи попадают:

* стандартные поля логирования;
* атрибуты пакета, с которым произошло событие (протокол, порты и IP-адреса);
* название таблицы файрвола;
* идентификатор правила файрвола;
* действие, которое произошло.

Логи записываются в системный журнал. В том числе эти сообщения могут отправляться через [syslog](/settings/reports/syslog.md).

{% hint style="info" %}
Включите опцию **Логировать срабатывания правил** для начала логирования.
{% endhint %}

Такая система ограничений нужна для исключения неподходящих правил файрвола из логирования. Логирование всех срабатываний правил файрвола требует дополнительных ресурсов на сервере и затрудняет отладку правил. Если для нормальной работы логирование не требуется, рекомендуем его отключить.

## Действия для логирования

Выберите действия правил **Файрвола**, которые требуется логировать, нажав\
на ![](/.gitbook/assets/icon-gear.png).

{% hint style="danger" %}
Если ни одно действие во вкладке **Логирование** не выбрано, срабатывания правил логироваться не будут.
{% endhint %}

## Трафик для логирования

Создайте в таблице правило для трафика. Если сработает правило файрвола с трафиком, подходящим под правило логирования, то срабатывание правила файрвола будет залогировано.

{% hint style="danger" %}
Если ни одно правило в таблице не задано, срабатывание правил логироваться не будет.

Правила отметки трафика могут снять отметку с помощью действия **Не логировать** для трафика, помеченного ранее действием **Логировать**.
{% endhint %}

Применение правил для отметки трафика, подлежащего проверке, проходит всегда по всем правила до конца этой таблицы.

Таким образом, предоставляется возможность гибкой выборки трафика, который подлежит логированию.

**Пример**: требуется настроить логирование всего трафика на yandex.ru, кроме трафика от пользователя Иванова Ивана:

1\. В поле **Источник** выберите _Иванова Ивана_ и переведите опцию **Инвертировать источник** в положение **Включен**.

2\. В поле **Назначение** выберите `yandex.ru`.

3\. Выберите действие **Логировать**:

![](/.gitbook/assets/logging.png)
