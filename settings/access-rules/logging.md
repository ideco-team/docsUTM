---
description: >-
  Логирование срабатывания правил Файрвола: Forward, DNAT, SNAT и INPUT.
---

# Логирование

Логирование работает следующим образом: \
Весь поступающий трафик, в первую очередь, проходит через модуль логирования. Если трафик соответствует установленным ограничениям по выборке **правил** и **трафика**, то получает метку о необходимости логирования. Если не соответствует, то метка не ставится. 

Далее трафик проходит через правила, установленные во вкладках Forward, DNAT, SNAT и INPUT. И, если при срабатывании правила на трафике стояла метка логирования, то в логи попадет: дата и время; имя файла, куда пишутся логи; протокол; исходный порт и порт назначения; название раздела;номер правила; действие в отработанном правиле.

Логи записываются в системный журнал. Время хранения логов зависит от:

* Объема файла ();
* Времени ().

{% hint style="info" %}
Включите опцию **Логировать срабатывания правил** для начала логирования. 
{% endhint %}

Процесс установки выборки *правил* описана в **Действии для логирования** и *трафика* в **Транзитный трафик между интерфейсами**.

## Действия для логирования

Выберите действия для правил раздела **Файрвол**, которые требуется логировать, нажав \
на ![](../../.gitbook/assets/icon-gear.png).

{% hint style="danger" %}
Если ни одно действие во вкладке **Логирование** не выбрано, срабатывания правил логироваться не будут, даже если созданы правила в таблице **Транзитный трафик между интерфейсами** и включена опция **Логировать срабатывания правил**.
{% endhint %}

## Транзитный трафик между интерфейсами

Создайте в таблице правила для трафика, срабатывания которого требуется логировать.

{% hint style="danger" %}
Если ни одно правило в таблице не задано, срабатывания правил логироваться не будут, даже если выбраны **Действия для логирования** и включена опция **Логировать срабатывания правил**.
{% endhint %}

Проверка трафика по установленным в таблице ограничениям проходит до конца таблицы (в отличие от таблиц в других вкладках раздела Файвол). 

{% hint style="danger" %}
Если сначала в таблице находится правило с действием **Логировать** определенный трафик файрвола, а следом правило с действием **Не логировать** это же правило, то срабатывание не будет записано в системный файл.
{% endhint %}

Таким образом предоставляется возможность более гибкой настройки логирования правил. 

**Пример**: требуется настроить логирование всего трафика на yandex.ru, кроме трафика от пользователя Иванова Ивана с 08:00 до 16:00:

1\. Создайте правило, логирующее весь трафик на yandex.ru:

![](../../.gitbook/assets/logging.png)

2\. Создайте правило, запрещающее логировать трафик на yandex.ru от Иванова Ивана с 08:00 до 16:00:

![](../../.gitbook/assets/logging1.png)

{% hint style="info" %}
Не рекомендуем создавать правила, логирующее все срабатывания файрвола. Это загрузит ЦПУ, в следствии чего файрвол будет работать менее эффективно. 
{% endhint %}
