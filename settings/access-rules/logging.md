---
description: 'Логирование срабатывания правил Файрвола: Forward, DNAT, SNAT и INPUT.'
---

# Логирование

Логирование работает следующим образом:\
Весь поступающий трафик, в первую очередь, проходит через правила модуля логирования. Если трафик соответствует критериям по выборке **трафика**, то на пакете выставляется виртуальная метка о необходимости логирования. По умолчанию метки нет.

Кроме того, для того чтобы логирование произошло, необходимо чтобы правило действие в правиле файрвола, которое сработало на выбранный трафик было в наборе действий подлежащих логированию.

Такая система ограничений нужна для того, чтобы отсекать неподходящий трафик и правила файрвола, так как логирование всех правил и всего трафика который соответствует правилам файрвола, требует дополнительных ресурсов на сервере и затрудняет отладку правил. Если для нормальной работы логирование не требуется - лучше его отключить.

Трафик проходит через правила на вкладках [Файрвола](firewall.md). И, если при срабатывании правила на трафике стояла метка логирования, то в логи попадет, помимо стандартный полей логирования:\
\* атрибуты пакета с которым произошло событие (протокол, порты и IP-адреса)\
\* название таблицы файрвола\
\* идентификатор правила файрвола.\
\* действие, которое произошло.

Логи записываются в системный журнал. В том числе это означает что эти сообщения могут отправляться через [syslog](../monitor/syslog.md) Время хранения логов зависит от:

* Объема файла (); !!!!!!!!!!!!!!!!! - тут не должно быть, это должно быть в описания журналирования вообще.
* Времени (). !!!!!!!!!!!!!!!

{% hint style="info" %}
Включите опцию **Логировать срабатывания правил** для начала логирования.
{% endhint %}

Как выбирать _правила_ описано в **Действиях для логирования,** а _трафика_ -- в **Трафике для логирования**.

## Действия для логирования

Выберите действия правил **Файрвола**, которые требуется логировать, нажав\
на ![](../../.gitbook/assets/icon-gear.png).

{% hint style="danger" %}
Если ни одно действие во вкладке **Логирование** не выбрано, срабатывания правил логироваться не будут.
{% endhint %}

## Трафик для логирования

Создайте в таблице правила для трафика, срабатывания которого требуется логировать.

{% hint style="danger" %}
Если ни одно правило в таблице не задано, срабатывания правил логироваться не будут.
{% endhint %}

Применение правил для отметки трафика, подлежащего логированию, проходит всегда по всем правила до конца этой таблицы. Правила не являются конечными, в отличие от таблиц в других вкладках Файрвола.

{% hint style="danger" %}
Правила пометки трафика могут снять пометку с помобщью действия **Не логировать** для трафика, помеченного ранее действием  **Логировать**.&#x20;
{% endhint %}

Таким образом, предоставляется возможность гибкой выборки трафика, который подлежит логированю срабатывания правил файрвола.

**Пример**: требуется настроить логирование всего трафика на yandex.ru, кроме трафика от пользователя Иванова Ивана:

1\. Создайте правило, логирующее срабатывания трафика, отправленного на yandex.ru:

![](../../.gitbook/assets/logging.png)

2\. Создайте правило, запрещающее логировать трафик от Иванова Ивана:

![](../../.gitbook/assets/logging1.png)

