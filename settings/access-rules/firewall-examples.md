# Примеры создания правил файрвола

<details>

<summary>Настройка правил файрвола для IPsec-подключений</summary>

Чтобы настроить правило файрвола для IPsec-подключений, выберите в поле **Зона источника** или **Зона назначения** настроенное IPsec-подключение.

</details>

<details>

<summary>Портмаппинг, DNAT, публикация сервера в локальной сети</summary>

Примеры данных настроек подробно описаны в статьях раздела [Публикация ресурсов](/settings/publishing-resources/README.md).

</details>

<details>

<summary>Блокировка различных ресурсов средствами файрвола</summary>

Вопросы блокировки различных ресурсов: программ удаленного управления (AmmyAdmin и TeamViewer), мессенджеров и другого ПО - описаны в разделе [Блокировка популярных ресурсов](/recipes/popular-recipes/blocking-popular-resources.md).

</details>

<details>

<summary>Массовая блокировка IP-адресов и сетей</summary>

1\. Нужно сформировать список для блокировки в текстовом файле:

* Наименование файла обязательно должно быть manual\_blocklist.txt;
* В одной строке следует указывать только один IP-адрес или одну сеть;
* Формат написания IP-адреса: 1.2.3.4;
* Формат написания сети: 1.2.3.0/24.

![](/.gitbook/assets/firewall-tables.png)

2\. Переместить файл `manual\_blocklist.txt` в каталог `/var/opt/ideco/firewall-backend/`;

3\. В терминале Ideco NGFW выполнить команду `ideco-apply-manual-blocklist`.

После перезагрузки Ideco NGFW IP-адреса и сети из файла будут автоматически блокироваться (дополнительно выполнять команду `ideco-apply-manual-blocklist` не нужно). При обновлении Ideco NGFW список блокировок сохранится.

Если требуется добавление адресов в список заблокированных, следует добавить адреса в файл `/var/opt/ideco/firewall-backend/manual\_blocklist.txt` и повторно выполнить команду `ideco-apply-manual-blocklist`.

Для удаления адресов из списка заблокированных следует удалить необходимые адреса из файла `/var/opt/ideco/firewall-backend/manual\_blocklist.txt` и выполнить команду `ideco-apply-manual-blocklist`.

</details>

<details>

<summary>Доступ к терминальному серверу для определенного пользователя</summary>

1\. На вкладке **FORWARD** нажмите **Добавить**.

2\. Заполните следующие поля:

* **Протокол** - выберите TCP;
* **Адрес** - выберите пользователя или группу пользователей;
* **Назначения** - укажите адрес терминального сервера;
* **Порты назначения** - укажите порт 3389;
* **Действие** - Разрешить;
* **Дополнительно** - включите правило.

![](/.gitbook/assets/firewall28.png)

3\. Нажмите **Добавить**.

</details>

<details>

<summary>Блокировка доступа к веб-интерфейсу (порт 8443) всем, кроме определенного адреса</summary>

1\. Перейдите в раздел **Правил трафика -> Файрвол**.

2\. Перейдите на вкладку **INPUT**.

3\. Создайте правило, заполнив поля, как на скриншоте, и включите его:

![](/.gitbook/assets/firewall23.png)

* Доступ к веб-интерфейсу будет разрешен только с IP-адреса **192.168.1.120**.
* **192.168.1.1** - IP-адрес Ideco NGFW в локальной сети.

</details>

<details>

<summary>Блокировка 80 порта Ideco NGFW</summary>

**80 TCP порт используется для выпуска сертификатов Let`s Encrypt**.

1\. Перейдите в раздел **Правил трафика -> Файрвол**.

2\. Перейдите на вкладку **INPUT**.

3\. Создайте правило, заполнив поля, как на скриншоте, и включите его:

![](/.gitbook/assets/firewall24.png)

</details>

<details>

<summary>Разрешение DNS-запросов</summary>

1\. Перейдите в раздел **Правил трафика -> Файрвол**.

2\. Перейдите на вкладку **FORWARD**.

3\. Cоздайте правило, заполнив поля, как на скриншоте, и включите его:

![](/.gitbook/assets/firewall25.png)

**Для работы протокола DNS может быть не достаточно правила с протоколом UDP, поскольку DNS использует в качестве транспорта не только UDP, но и TCP**. Для решения задачи создайте аналогичное правило с протоколом TCP, используя кнопку **Клонировать** в таблице правил.

</details>

<details>

<summary>Доступ до Ideco NGFW только из определенной внешней сетей</summary>

1\. Перейдите в раздел **Правил трафика -> Файрвол**.

2\. Перейдите на вкладку **INPUT**.

3\. Cоздайте правило, заполнив поля, как на скриншоте, и включите его:

![](/.gitbook/assets/firewall26.png)

**Правило разрешит трафик до Ideco NGFW из внешней сети 51.25.89.0/24**.

</details>

<details>

<summary>DNAT-правило для работы site-to-site IPsec с устройством в локальной сети</summary>

1\. Перейдите в раздел **Правил трафика -> Файрвол**.

2\. Перейдите на вкладку **DNAT**.

3\. Cоздайте правило, заполнив поля, как на скриншоте, и включите его:

![](/.gitbook/assets/firewall27.png)

* **5.120.1.25** - IP-адрес Ideco NGFW во внешней сети.
* **192.168.1.50** - IP-адрес устройства в локальной сети.

**Для полноценной работы IPsec создайте такое же правило с протоколом AH, нажав Клонировать**. Помимо этого нужно создать DNAT-правило с протоколом UDP и портами 500,4500.

</details>