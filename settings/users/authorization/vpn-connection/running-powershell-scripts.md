---
description: >-
  Используйте загруженные с сервера готовые скрипты для создания VPN-подключения
  в ОС Windows версий 8.1 и 10.
---

# Инструкция по запуску PowerShell скриптов

Для подключения по VPN к Ideco NGFW с белым IP адресом достаточно действий, указанных ниже. Если Ideco NGFW выходит в интернет через маршрутизатор, воспользуйтесь пунктом [Подключение по VPN к Ideco NGFW с доступом в интернет через маршрутизатор](running-powershell-scripts.md#podklyuchenie-po-vpn-k-ideco-ngfw-s-dostupom-v-internet-cherez-marshrutizator).

## Запуск PowerShell-скрипта

1\. Скачайте скрипт одним из способов:

**Из Ideco NGFW:**

* Перейдите в раздел **Пользователи -> VPN-подключения -> Основное**:

![](/.gitbook/assets/vpn-authorization14.png)

* Включите и настройте требуемый протокол подключения;
* Перейдите по ссылке **PowerShell - скрипт для настройки подключений**;
* Перенесите скачанный файл на устройство, на котором требуется создать VPN-подключение.

**В личном кабинете пользователя:**

* Скачайте скрипт, перейдя по ссылке **Скачать скрипт для создания подключения**: 

![](/.gitbook/assets/user-personal-account7.png)

2\. Щелкните правой кнопкой мыши по скачанному файлу и в контекстном меню выберите **Свойства**.

![](/.gitbook/assets/running-powershell-scripts.png)

3\. Включите опцию **Разблокировать** справа в нижнем углу свойств файла (по умолчанию ОС блокирует выполнение скачанных из интернета файлов):

![](/.gitbook/assets/running-powershell-scripts1.png)

4\. Нажмите правой кнопкой мыши на файл и выберите пункт **Выполнить в PowerShell**. Затем подтвердите действие, нажав **Да** на вопрос о внесении изменений в компьютер:

![](/.gitbook/assets/running-powershell-scripts2.png)

{% hint style="info" %}
При появлении ошибки **Выполнение сценариев отключено в этой системе** откройте PowerShell с правами администратора,  выполните команду для разрешения запуска скриптов `Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process`, в том же окне заново выполните скрипт для создания подключения и закройте консоль.
{% endhint %}

5\. Когда одключение создано, нажмите **Подключиться** в списке сетей.

![](/.gitbook/assets/running-powershell-scripts3.png)

## DNS-суффиксы для VPN-подключений

PowerShell-скрипты прописывают основной DNS-суффикс для создаваемого VPN-подключения. Он соответствует домену, в который введен Ideco NGFW. Это позволяет обращаться к устройствам за VPN по короткому имени. 

{% hint style="warning" %}
Если Ideco NGFW введен в несколько доменов, то DNS-суффиксы в PowerShell-скриптах не прописываются, их необходимо настраивать вручную на подключенном по VPN устройстве.
{% endhint %}

Чтобы настроить DNS-суффиксы для созданного VPN-подключения в Windows, выполните действия:

1\. Перейдите в **Сетевые подключения**, нажмите правой кнопкой мыши по нужному VPN-подключению и выберите **Свойства**:

![](/.gitbook/assets/running-powershell-scripts4.png)

2\. В открывшемся окне перейдите на вкладку **Сеть**, выберите компонент **IP версии 4 (TCP/IPv4)** и нажмите **Свойства**:

![](/.gitbook/assets/running-powershell-scripts5.png)

3\. В открывшемся окне нажмите **Дополнительно**:

![](/.gitbook/assets/running-powershell-scripts6.png)

4\. Перейдите на вкладку **DNS** и включите опцию **Дописывать следующие DNS-суффиксы (по порядку)**:

![](/.gitbook/assets/running-powershell-scripts7.png)

5\. Нажмите **Добавить** и введите необходимые DNS-суффиксы:

![](/.gitbook/assets/running-powershell-scripts8.png)

{% hint style="info" %}
При обращении к компьютеру по короткому имени DNS-суффиксы будут перебираться в порядке расположения. Этот порядок можно менять стрелками.
{% endhint %}

<details>
<summary>Подключение по VPN к Ideco NGFW с доступом в интернет через маршрутизатор</summary>

Для работы скрипта подключения по VPN выполните действия:

1\. Сделайте проброс портов 4500 и 500 в IP-адрес Ideco NGFW в локальной сети маршрутизатора.

2\. Загрузите скрипт на компьютер, воспользовавшись 1 пунктом инструкции [Запуск PowerShell-скрипта](running-powershell-scripts.md#kak-zapustit-powershell-skript).

3\. Поменяйте в загруженном скрипте IP-адрес Ideco NGFW на внешний IP-адрес маршрутизатора:

![](/.gitbook/assets/running-powershell-scripts.gif)

<!-- В строках:
* `Name "Ideco NGFW L2TP VPN to 46.36.23.99"` замените на `Name "Ideco NGFW L2TP VPN to 5.189.21.1"`;
* `ServerAddress 46.36.23.99` замените на `ServerAddress 5.189.21.1`.-->

* **46.36.23.99** - IP-адрес Ideco NGFW в локальной сети маршрутизатора;

* **5.189.21.1** - внешний IP-адрес маршрутизатора.

4\. После выполнения действий следуйте инструкции [Запуск PowerShell-скрипта](running-powershell-scripts.md#kak-zapustit-powershell-skript) с 4 пункта.

</details>

<details>
<summary>Решение проблем запуска PowerShell-скрипта</summary>

Для запуска Powershell-скрипта убедитесь, что:

* Вам хватает прав на запуск скрипта;
* PowerShell установлен в системе.

{% hint style="info" %}
Если не удалось решить проблему запуска PowerShell-скрипта, воспользуйтесь инструкцией для создания подключения в [Windows 10](/recipes/popular-recipes/vpn/connection-for-windows10.md) вручную.
{% endhint %}

</details>