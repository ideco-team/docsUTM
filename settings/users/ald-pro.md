---
description: >- 
    Настройка односторонней синхронизации с системой управления каталогами ALD Pro
---

# ALD Pro

{% hint style="success" %}
Название службы раздела **ALD Pro**: `ideco-ald-rest`; `ideco-ald-backend`. \
Список служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).

Ideco NGFW поддерживает версии ALD Pro от 1.4.
{% endhint %}

Система [ALD Pro](https://www.aldpro.ru/) предназначена для централизованного управления ресурсами на базе ОС Astra Linux и может использоваться в организациях различного масштаба.

Руководства по эксплуатации ALD Pro доступны на [официальном сайте](https://www.aldpro.ru/docs/).

{% hint style="info" %}
Синхронизация с ALD Pro приостанавливается, если локальные пользователи Ideco NGFW находятся в группах AD.
Для возобновления синхронизации вынесите локальных пользователей из групп ALD Pro. Автоматическая синхронизация произойдет через 15 минут.
{% endhint %}

## Ввод сервера в домен

1\. Перейдите в раздел **Сервисы -> DNS -> Внешние DNS-серверы** и добавьте IP-адрес устройства с установленной системой ALD Pro:

![](/.gitbook/assets/ald-pro1.png)

2\. Перейдите на вкладку **Пользователи -> ALD Pro**.

2\. Нажмите на кнопку **Добавить**.

3\. Заполните поля:

![](/.gitbook/assets/ald-pro.png)

* **Домен** - полное имя домена (не контроллера домена/хоста). Например, `mydomain.example`, а не `astra.mydomain.example`. Домен может содержать только латинские символы, цифры, подчеркивание, дефис и точку;
* **IP-адрес DNS-сервера** - IP-адрес устройства с установленной системой ALD Pro;
* **Имя сервера Ideco NGFW** - имя сервера, которое автоматически генерируется NGFW, можно указать вручную. Содержит буквенные символы (A-Z), цифры (0-9), а также не может начинаться или заканчиваться на дефис. Максимальное количество символов - 15;
* **Логин и пароль администратора** - эти данные **не сохраняются** на сервере и используются один раз для присоединения к домену. Пользователь может не быть администратором домена, но должен обладать правами на присоединения компьютеров к домену.

{% hint style="info" %}
Инструкции по развертыванию и управлению ресурсами через ALD Pro доступны на [официальном сайте](https://www.aldpro.ru/docs/).
{% endhint %}

Если в таблице большое количество интеграций, воспользуйтесь кнопкой **Фильтры**.

## Импорт пользователей

{% hint style="warning" %}
Ideco NGFW также поддерживает интеграцию с ALD-администраторами. Подробные инструкции по настройке описаны в статье [Администраторы](/settings/server-management/admins.md).

{% endhint %}

ALD Pro поддерживает импорт двух типов групп:

* Группа пользователей - содержит несколько пользователей ALD Pro;
* Подразделение - содержит дерево пользователей ALD Pro, обладающих определенным уровнем доступа.

Для импорта пользователей выполните действия:

1\. Перейдите в раздел **Пользователи -> Учетные записи** и создайте группу, в которую будут импортированы пользователи, нажав на ![](/.gitbook/assets/icon-folder.png).

2\. Перейдите на вкладку **ALD Pro**, выберите домен, тип группы и нажмите **Присоединить к домену**.

Импортированных пользователей можно использовать в качестве объектов для авторизации, настройки VPN-подключений, создания правил трафика (например, в **Файрволе**).

{% hint style="info" %}
В дальнейшем пользователи будут автоматически синхронизироваться с ALD Pro каждые 15 минут.

Пользователь может быть импортирован только в одну группу Ideco NGFW. Если он находится в нескольких группах ALD Pro, он попадет только в ту группу, которая была импортирована последней.
{% endhint %}

## Аутентификация пользователей

При аутентификации пользователей проверка осуществляется средствами Kerberos.

ALD Pro поддерживает два типа входа в систему:

* вход по логину/паролю;
* вход через SSO.

### Настройка Ideco NGFW

Для настройки аутентификации выполните действия: 

1\. Перейдите в раздел **Пользователи -> Авторизация -> Основное**.

2\. Активируйте опцию **Веб-аутентификация**.

3\. Выберите тип входа в систему:
  
![](/.gitbook/assets/authorization6.png)

* Для входа по логину/паролю активируйте опцию **Аутентификация через веб-интерфейс**;
* Для входа через SSO активируйте опцию **SSO-аутентификация через Active Directory и ALD Pro**.

После заполнения поля **Доменное имя Ideco NGFW** и сохранения настроек будет выдан Let’s Encrypt сертификат, и пользователь будет перенаправляться на окно авторизации, минуя страницу исключения безопасности:

![](/.gitbook/assets/web-autorization2.png)

Если сертификат для такого домена уже загружен в разделе [Сертификаты](/settings/services/certificates/README.md), то будет использоваться загруженный сертификат, новый сертификат выдаваться не будет.

{% hint style="info" %}
Если NGFW не подключен к интернету или доменное имя не соответствует внешнему IP-адресу NGFW, то страница авторизации будет подписана корневым сертификатом NGFW.
{% endhint %}

4\. Настройте способы аутентификации импортированных пользователей. Доступные способы:

* Авторизация по IP и/или MAC - подходит для пользователей с фиксированными IP- и/или MAC-адресами, на NGFW адреса прописываются вручную каждому пользователю;
* Авторизация по подсетям - подходит в случаях, когда не требуется регистрировать каждое устройство как отдельного пользователя NGFW, позволяет автоматически авторизовать большое количество устройств;
* Авторизация по VPN - подходит для аутентификации пользователей удаленных сетей.

{% hint style="info" %}
Для настройки авторизации по VPN воспользуйтесь статьей [VPN-подключения](/settings/users/authorization/vpn-connection/README.md).
{% endhint %}

### Настройка клиентских машин для SSO-авторизации

<details>

<summary>Настройка браузера Mozilla Firefox для веб-аутентификации по SSO или NTLM</summary>

На странице настроек браузера Mozilla Firefox (about:config в адресной строке) настройте следующие параметры:

* `network.automatic-ntlm-auth.trusted-uris` и `network.negotiate-auth.trusted-uris` добавьте адрес локального интерфейса Ideco NGFW (например, idecoNGFW.example.ru);
* `security.enterprise_roots.enabled` в значении `true` позволит Firefox доверять системным сертификатам и авторизовывать пользователей при переходе на HTTPS-сайты.

</details>

1\. Загрузите корневой сертификат и добавьте его в доверенные.

2\. На машине ALD-клиента, введенной в домен ALD Pro, добавьте IP локального интерфейса и доменное имя Ideco NGFW в /etc/hosts. Пример: `192.168.100.10  domain.ald`.