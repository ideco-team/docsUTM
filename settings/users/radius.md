---
description: Как настроить интеграцию с RADIUS-сервером и двухфакторную аутентификацию пользователей, а также управлять учетными записями в дереве пользователей Ideco NGFW.
---

Интеграция с RADIUS-сервером обеспечивает аутентификацию пользователей, данные которых хранятся исключительно на RADIUS-сервере или в базах данных/каталогах, доступных для него.

{% hint style="info" %}
Если учетные записи в службе каталогов Active Directory/Samba DC совпадают с учетными записями на RADIUS-сервере, авторизация будет производиться с использованием данных из службы каталогов.
{% endhint %}

Через RADIUS-сервер доступна аутентификация только VPN-пользователей NGFW.

Для взаимодействия с основным RADIUS-сервером по умолчанию используется порт 1812.

## Настройка интеграции

Для настройки интеграции с RADIUS-сервером выполните действия:

1\. Перейдите в раздел **Пользователи -> RADIUS** и включите опцию **RADIUS**.

2\. Выключите опцию **Конвертировать запросы от Ideco NGFW из PAP в MS-CHAP v2** только если необходимо настроить двухфакторную аутентификацию для пользователей RADIUS-сервера.

В остальных случаях оставьте опцию включенной для повышения безопасности и защиты от перехвата паролей между NGFW и RADIUS-сервером, или когда RADIUS-сервер поддерживает только MS-CHAP v2.

{% hint style="info" %}
Опция влияет только на подключения через Ideco Client, ее переключение никак не влияет на подключение пользователей по другим типам VPN.
{% endhint %}

3\. Заполните поля:

![](/.gitbook/assets/radius1.png)

* **Домен или IP-адрес** - домен или адрес внутреннего RADIUS-сервера.
* **Секрет** - ключ-пароль, который устанавливается на этапе конфигурации RADIUS-сервера.
* **Порт** - порт, по которому будет происходить подключение к серверу. Поменяйте при необходимости.

4\. Нажмите **Сохранить**.

{% hint style="info" %}
При наличии в сети двух RADIUS-серверов настройте один как резервный с указанием порта подключения.

При отсутствии ответа от основного RADIUS-сервера запрос об аутентификации будет перенаправлен на резервный RADIUS-сервер. 
{% endhint %}

{% hint style="warning" %}
При отключенной интеграции с RADIUS-сервером пользователи RADIUS не смогут аутентифицироваться на NGFW.
{% endhint %}

Ideco NGFW также поддерживает интеграцию с RADIUS-администраторами. Подробные инструкции по настройке описаны в статье [Администраторы](/settings/server-management/admins.md).


## Двухфакторная аутентификация

Двухфакторная аутентификация для пользователей RADIUS-сервера доступна только при авторизации через [Ideco Client](/settings/users/ideco-client/README.md).

По умолчанию Ideco Client использует для аутентификации на внешнем сервере протокол MS-CHAP v2. При отключении опции **Конвертировать запросы от Ideco NGFW из PAP в MS-CHAP v2** запросы аутентификации от Ideco Client к внешнему серверу будут выполняться по протоколу PAP. Для всех прочих VPN-подключений продолжает работать только MS-CHAP v2 независимо от настройки.

Если необходимо обеспечить для пользователей RADIUS-сервера двухфакторную аутентификацию:

1\. В веб-интерфейсе Ideco NGFW в разделе **Пользователи -> RADIUS** отключите опцию **Конвертировать запросы от Ideco NGFW из PAP в MS-CHAP v2**: с использованием MS-CHAP v2 проверку второго фактора обеспечить невозможно.

2\. Настройте RADIUS-сервер на работу с протоколом PAP.

3\. Настройте на RADIUS-сервере механизм двухфакторной аутентификации. Настраивать 2FA на Ideco NGFW **не нужно**.

## Механизм добавления пользователей в дерево пользователей Ideco NGFW

1\. При подключении пользователя к Ideco NGFW происходит поиск пользователя в дереве пользователей: 

* Если пользователь найден - запрос аутентификации сразу будет отправлен на **RADIUS-сервер**.
* Если пользователь не найден - Ideco NGFW создаст пользователя и отправит запрос аутентификации на **RADIUS-сервер**. 

2\. При отсутствии группы **RADIUS** на Ideco NGFW группа будет пересоздаваться при аутентификации пользователей **RADIUS-сервера**. 

3\. После аутентификации пользователь будет добавлен в группу **RADIUS** на Ideco NGFW.

{% hint style="info" %}
Группу и пользователей **RADIUS** можно использовать для создания правил фильтрации трафика и других задач.
{% endhint %}

<details>

<summary>Ограничения для группы и пользователей RADIUS:</summary>

* Запрещено менять параметры пользователя (в том числе поля **Имя** и **Комментарий**), за исключением опции **Запретить доступ**.
* Разрешено удалять и переименовывать группу **RADIUS**.
* Запрещено перемещать пользователей в другие группы.
* Запрещено перемещать других пользователей NGFW в группу **RADIUS**.
* Запрещена настройка IP и MAC авторизации для пользователей группы.
* Недоступна авторизация пользователей группы в личном кабинете и веб-почте.

</details>