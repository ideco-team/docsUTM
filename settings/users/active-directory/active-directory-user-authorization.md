---
description: >-
  В статье описана настройка аутентификации пользователей AD/Samba DC в Ideco NGFW.
---

# Аутентификация пользователей AD/Samba DC

{% hint style="success" %}
Видеоинструкцию смотрите по ссылкам:
* [Rutube](https://rutube.ru/video/590d482c7e412deb0dcfbe945e1448e4/?r=wd)
* [Youtube](https://youtu.be/RgzyOM7opUY?si=7M2U2OvM04Ab_znL)
{% endhint %}

Перейдите на вкладку **Пользователи -> Авторизация -> Основное** и заполните поля:

![](/.gitbook/assets/authorization9.png)

* **Доменное имя Ideco NGFW** - укажите доменное имя Ideco NGFW длиной не более 15 символов.
* **Веб-аутентификация** - включите настройку и выберите **SSO-аутентификация через Active Directory и ALD Pro** для авторизации с использованием токенов Kerberos или NTLM.
* **Авторизация через журнал безопасности Active Directory** - включите, чтобы Ideco NGFW отслеживал события успешного входа в журнале безопасности AD и авторизовывал пользователя по ним, если трафик идет с того же IP-адреса.
* **Разавторизация пользователей** - установите тайм-аут [разавторизации пользователей](settings\users\active-directory\auto-de-authorization-script.md). Значение по умолчанию - 15 минут. Диапазон доступных значений - от 10 минут до 1 дня.

После сохранения настроек будет выдан Let’s Encrypt сертификат, пользователь будет перенаправляться на окно авторизации, минуя страницу исключения безопасности:

![](/.gitbook/assets/web-autorization2.png)

Если сертификат для такого домена уже загружен в разделе [Сертификаты](/settings/services/certificates/), то будет использоваться загруженный сертификат. Новый сертификат выдаваться не будет.

## Авторизация

Для пользователей, импортированных из Aсtive Directory, доступны все типы авторизации.

{% hint style="warning" %}
**Авторизацию через журнал безопасности Active Directory** рекомендуется использовать совместно с SSO-аутентификацией. Авторизация только через журнал безопасности может не обеспечить полную интеграцию с Active Directory и ограничить возможности управления и настройки прав доступа.

Использование только **Авторизации через журнал безопасности Active Directory** ненадежно по причинам:

* Логи журнала событий безопасности содержат только имя пользователя, IP-адрес и время входа. Журнал не содержит всей информации, необходимой для полноценной авторизации: группы безопасности, права доступа и другие атрибуты пользователя.
* Любые проблемы с журналом, такие как повреждение, потеря данных или задержки в записи, могут привести к проблемам с авторизацией.
* Авторизация через журнал безопасности менее безопасна, так как логи могут быть подделаны или изменены злоумышленниками.
* Логи могут быть записаны с задержкой, и трудно гарантировать, что все данные актуальны и согласованы в любой момент времени.
* Авторизация через журнал безопасности может потребовать сложной логики для обработки и анализа логов, что может увеличить вероятность ошибок и затруднить поддержку.
{% endhint %}

Если у домена, в который введен NGFW, настроено доверие с другим доменом, то пользователи доверенного домена смогут авторизоваться на NGFW при выполнении условий:

* Для аутентификации пользователей домена используется SSO-аутентификация.
* Пользователь доверенного домена должен быть в локальной группе AD на контроллере домена, и эта группа должна быть импортирована на NGFW.

После авторизации пользователи доверенного домена будут добавлены в группу AD Пользователи из доверенных доменов в дереве пользователей NGFW.

Для пользователей, импортированных из Samba, доступны все типы авторизации, кроме авторизации через журнал безопасности.

{% hint style="success" %}
Чтобы пользователи SambaDC могли использовать VPN-подключение, необходимо включить **NTLM-авторизацию**. Для этого отредактируйте файл с помощью команды `nano /etc/samba/smb.conf`, добавив в секцию `[global]` строку `ntlm auth = yes`.
{% endhint %}

## Полезные ссылки

* [**Настройка сервера Microsoft Active Directory**](/settings/users/active-directory/active-ditrctory-server-configuring.md)
* [**Настройка клиентских машин**](settings/users/active-directory/active-directory-web-authentication.md)
* [**Скрипты автоматической разавторизации**](settings/users/active-directory/auto-de-authorization-script.md)