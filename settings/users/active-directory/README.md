---
description: >-
  В Ideco NGFW возможна односторонняя синхронизация с контроллером домена на
  базе Microsoft Active Directory (AD) и Samba DC.
---

{% hint style="success" %}
Видеоинструкцию смотрите по ссылкам:
* [Rutube](https://rutube.ru/video/9772209e77cf48c78a9e39f337bbe932/);
* [Youtube](https://youtu.be/noB-O7cnb94?si=vnt62RtV56NTo57f).
{% endhint %}

# Интеграция с Microsoft Active Directory/Samba DC

{% hint style="success" %}
Название службы раздела **Active Directory/Samba DC**: `ideco-ad-backend`; `ideco-ad-log-collector@<имя домена>`. \
Список служб для других разделов доступен по [ссылке](/settings/server-management/terminal/README.md).
{% endhint %}

При интеграции импортируются учетные записи и номера телефонов пользователей, исключая пароли. При аутентификации пользователей проверка осуществляется средствами Active Directory или Samba DC соответственно.

## Поддерживаемые контроллеры домена:

* Windows Server 2008 (только R2), 2012, 2016, 2019, 2022;
* Samba DC с версии 4.0.

## Особенности интеграции с несколькими контроллерами домена

* Из дерева контроллеров домена в Ideco NGFW импортируются данные только того контроллера, для которого был запущен импорт пользователей;
* При импорте пользователей из разных доменов необходимо убедиться, что учетные записи не имеют одинаковых логинов. В противном случае система выдаст сообщение об ошибке;
* При SSO-авторизации и первом открытии браузера пользователю будет предложен выбор домена для аутентификации. Выбор сохраняется с помощью cookie и используется при следующей авторизации. Если требуется изменить домен, очистите cookie (для локального IP-адреса Ideco NGFW).

## Ввод сервера в домен

{% hint style="info" %}
Перед вводом в домен убедитесь, что время на контроллере домена и Ideco NGFW совпадает.
{% endhint %}

{% hint style="warning" %}
Хотябы один контроллер домена должен находиться в локальной сети Ideco NGFW или быть доступен через локальный интерфейс с помощью настроенной маршрутизации.
{% endhint %}

Для ввода сервера в домен выполните действия:

1\. Перейдите на вкладку **Пользователи -> Active Directory/Samba DC**.

2\. Нажмите **Добавить** и заполните поля:

![](/.gitbook/assets/active-directory.png)

   * **Домен** - полное наименование домена, длина которого не должна превышать 64 символа. Например: `mydomain.example`;
   * **DNS-сервер AD** - адрес сервера, обладающий ролью DNS-сервера в контроллере домена, доступный с локального интерфейса Ideco NGFW;
   * **Название сервера Ideco NGFW** - имя компьютера, под которым Ideco NGFW будет введен в домен (не более 15 символов);
   * **Учетная запись с правом присоединения к домену** - учетная запись AD с правами присоединения к домену (право **Создание объектов: Компьютер**). Данные учетной записи с правом присоединения к домену не сохраняются на сервере и используются один раз при вводе в домен:
  
![](/.gitbook/assets/active-directory0.png)

   * **LDAP-пути** - LDAP-пути для импорта пользователей и групп из выбранной [организационной единицы (OU)](https://serverspace.ru/support/help/kak-upravlyat-ou-v-active-directory/?utm_source=google.com&utm_medium=organic&utm_campaign=google.com&utm_referrer=google.com). Указание LDAP-путей позволяет импортировать только нужные группы пользователей, чтобы избежать импорта всего дерева пользователей AD.

3\. Нажмите **Присоединить к домену**. Процесс присоединения к домену может занять до одной минуты.

Если в таблице большое количество интеграций, воспользуйтесь кнопкой **Фильтры**. 

{% hint style="warning" %}
При выводе Ideco NGFW из домена удаляются все пользователи и группы, импортированные из него.
{% endhint %}

## Настройка DNS для разрешения имен локального домена

В Ideco NGFW Forward-зона DNS создается автоматически при вводе сервера в домен:

![](/.gitbook/assets/dns.png)

При такой настройке компьютеры могут использовать Ideco NGFW в качестве основного DNS-сервера. При этом разрешение локальных и интернет-имен будет работать корректно для всех сервисов.

{% content-ref url="user-import.md" %}
[user-import.md](user-import.md)
{% endcontent-ref %}

{% content-ref url="active-directory-user-authorization.md" %}
[active-directory-user-authorization.md](active-directory-user-authorization.md)
{% endcontent-ref %}
