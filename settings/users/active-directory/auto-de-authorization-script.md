# Скрипты автоматической разавторизации

{% hint style="danger" %}
При переходе с более ранних версий на Ideco NGFW v17 изменился скрипт автоматической разавторизации. Чтобы избежать ошибок, скачайте и перенастройте скрипт в соответствии с инструкцией ниже.
{% endhint %}

Разавторизация пользователей возможна в полностью автоматическом режиме.  Для этого настройте скрипт [(logout)](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753583(v=ws.11)?redirectedfrom=MSDN), который будет запускаться при выходе пользователей из системы с помощью групповых политик домена (GPO).

{% hint style="info" %}
Для работы скрипта выполните все настройки политик безопасности домена и браузера, описанные в статье [Авторизация пользователей](active-directory-user-authorization.md).

Для авторизации по SSO используйте [Ideco Client](/settings/users/ideco-client/README.md).
{% endhint %}

## Разавторизация пользователя

{% hint style="info" %}
Чтобы скрипт разавторизации работал корректно, установите на компьютеры пользователей корневой сертификат сервера Ideco NGFW и сделайте его доверенным. Это можно сделать как локально, так и через групповые политики домена, следуя [инструкции](/settings/access-rules/content-filter/filtering-https-traffic.md#dobavlenie-sertifikata-cherez-politiki-domena-microsoft-active-directory).
{% endhint %}

1\. Чтобы скачать скрипт, перейдите в раздел **Пользователи -> Авторизация**. Переключите опцию **Веб-аутентификация**, после чего появится кнопка **Скачать скрипт для разавторизации**:

![](/.gitbook/assets/authorization1.gif)

2\. Откройте групповые политики (gpedit.msc) от имени администратора на устройстве пользователя.

3\. Перейдите в **Конфигурации пользователя**, далее в **Конфигурации Windows**:

![](/.gitbook/assets/auto-de-authorization-script2.png)

4\. Нажмите **Сценарии (вход/выход из системы)**.

5\. Откройте **Выход из системы** и перейдите на вкладку **Сценарии PowerShell**:

![](/.gitbook/assets/auto-de-authorization-script3.png)

6\. Нажмите **Добавить** и выберите скачанный файл **Ideco_NGFW_logout.ps1**, нажав на кнопку **Обзор**:

![](/.gitbook/assets/auto-de-authorization-script4.png)

7\. Откройте командную строку и обновите групповые политики, введя команду `gpupdate /force`. 

Если в вашем браузере появляется окно с текстом **Для получения доступа требуется аутентификация** и авторизация происходит только при ручном переходе по ссылке, включите JavaScript. Ниже представлены настройки для разных браузеров:

<details>

<summary> Internet Explorer </summary>

1\. В правом верхнем углу браузера нажмите на кнопку **Сервис** в виде шестерни или комбинацию клавиш Alt+X. В выпадающем меню выберите **Свойства браузера**:

![](/.gitbook/assets/IE1.png)

2\. В появившемся окне перейдите на вкладку **Безопасность**. Затем нажмите на кнопку **Другой**: 

![](/.gitbook/assets/IE2.png)

3\. В окне **Параметры** переключите параметр **Активные сценарии** в значение **Включить**:

![](/.gitbook/assets/auto-de-authorization-script5.png)
</details>

<details>

<summary> Google Chrome </summary>

1\. В правом верхнем углу браузера нажмите на кнопку с тремя точками и выберите **Настройки** в выпадающем меню:

![](/.gitbook/assets/GC1.png)

2\. В появившемся окне перейдите в раздел **Конфиденциальность и безопасность** и выберите **Настройки сайта**:

![](/.gitbook/assets/GC2.png)

3\. В настройках **JavaScript** разрешите сайтам использовать JavaScript:

![](/.gitbook/assets/GC3.png)
</details>

<details>

<summary> Firefox </summary>

1\. В адресной строке браузера введите about:config и нажмите **Enter**. Если появится предупреждающее сообщение, нажмите **Принять риск и продолжить**:

![](/.gitbook/assets/FX1.png)

2\. В поле поиска введите javascript.enabled и переключите настройку параметра, чтобы изменить значение с false на true:

![](/.gitbook/assets/FX2.png)

3\. Обновите страницу в браузере.
</details>