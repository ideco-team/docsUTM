---
description: Настройка статистики в пользовательские отчеты и отправка готовых отчетов на электронную почту.
---

# Конструктор отчетов

NGFW предоставляет возможность создать шаблоны отчетов и настроить их рассылку в форматах .pdf и/или .csv на электронную почту.

## Мои шаблоны

На этой вкладке создаются шаблоны со статистикой, которую можно просмотреть в браузере, сохранить или отправить на электронную почту.

При нажатии на кнопку **Добавить** откроется меню настройки шаблона. 

Задайте временной промежуток, название отчета и нажмите **Добавить виджет**. Один шаблон может содержать несколько виджетов.

Настройка виджетов:

* В строке **По кому/чему** выберите объект, по которому будет собираться статистика. Если выбираете **Определенный** объект (например, *Определенный пользователь* или *Определенная группа*), то появится дополнительная строка **Объекты**, где можно выбрать несколько объектов;
* В строке **Виджет** укажите, какую информацию хотите видеть по выбранному объекту;
* Задайте **Настройки отображения**. 
  
После окончания настройки шаблона нажмите **Добавить**.

![](/.gitbook/assets/report-designer.png)

{% hint style="info" %}
Будьте внимательны при задании временного промежутка для шаблона отчетов. Ideco NGFW хранит данные в течение определенного времени (TTL), по прошествии которого они безвозвратно удаляются и не могут быть включены в отчеты:

Сроки хранения данных по разделам:

* [Системный журнал](/settings/reports/logs.md) (кроме логов служб `strongswan`, `squid`, `ideco-app-control`, `fail2ban`) - 90 дней;
* Логи [служб](/settings/server-management/terminal/README.md) `strongswan`, `squid`, `ideco-app-control`, `fail2ban` (Системный журнал) - 14 дней;
* Данные веб-трафика (Журнал веб-трафика, а также посещенные сайты) - 1 месяц;
* События безопасности (Журнал IPS и Web application firewall) - 3 месяца;
* Действия администраторов и Авторизация администраторов - 1 год;
* Журнал авторизации - 180 дней.
{% endhint %}

## Отчеты по расписанию

На этой вкладке предоставлена возможность создания/редактирования настроек для отправки рассылки на электронную почту, доступна фильтрация по всем столбцам с помощью кнопки **Фильтры**.

Для создания настройки нажмите **Отчеты по расписанию -> Добавить** в левом верхнем углу. В одной настройке можно указать несколько e-mail-получателей (кнопка **Добавить получателя**) и несколько отчетов (поле **Отчеты для отправки**):

![](/.gitbook/assets/report-designer1.png)

Допустимые форматы отчетов: CSV, PDF и PDF+CSV. Генерация отчетов в PDF требует значительных ресурсов ЦПУ и ОЗУ.

Отчеты будут отправляться:

* **Раз в день** - отправка произойдет на следующий день после сохранения, если время отправки меньше текущего на сервере;
* **Раз в неделю** - укажите день и время отправки;
* **Раз в месяц** - укажите определенный по счету день и время или каждое 1-е число месяца. Если выбрано 31-е число, но в месяце меньше дней, то выбирается последнее число месяца.

После нажатия на кнопку **Добавить** NGFW сохранит все пользовательские настройки времени отправки во всех фильтрах (раз в день, раз в неделю и раз в месяц), но отправляться шаблон будет только в период, выбранный пользователем. \
Например:

1\. Задайте временной период:
* Раз в неделю;
* День недели - четверг; 
* Нажмите **Добавить**. 

2\. Перейдите к редактированию отчета по кнопке **Редактировать** и измените настройки временного периода:
* Раз в месяц;
* Каждую вторую среду;
* Нажмите **Сохранить**.

3\. Перейдите к редактированию отчета и выберите **Раз в месяц**. Откроются настройки, созданные в пункте 1.

<details>
<summary>Пример настройки ежемесячного отчета в формате CSV</summary>

**Пример.** Требуется настроить отправку отчета в формате CSV с информацией о заблокированных сайтах по всем пользователям. Периодичность - ежемесячно, каждое первое число месяца.

Создайте шаблон отчета, на основании которого будет собрана статистика для отправки:

1\. Нажмите **Добавить** на вкладке **Мои шаблоны**.

2\. Выберите временной период, за который следует сформировать отчет, из предложенных фильтров или укажите даты нажав **Выберите дату**.

3\. Укажите название отчета (строка *Название отчета*).

4\. Кликните по кнопке **Добавить виджет**.

5\. Заполните строки:

* **По кому/чему** - выберите **Всем пользователям**;
* **Виджет** - выберите **Топ заблокированных сайтов**;

6\. Укажите **Настройки отображения**:

![](/.gitbook/assets/report-designer2.gif)

7\. Сохраните шаблон по кнопке **Добавить**.

Создайте правило, по которому шаблон отчета будет отправляться на электронную почту:

1\. Нажмите **Добавить** на вкладке **Отчеты по расписанию**.

2\. Заполните строки:

* **Название** - любое название, которое поможет идентифицировать правило расписания;
* **Email получателя** - электронная почта получателя отчета. Если нужно отправлять отчет нескольким получателям, укажите дополнительные адреса по кнопке **Добавить получателя**.

3\. Выберите нужный шаблон в поле **Отчеты для отправки**.

4\. Выберите формат отчета (CSV).

5\. Укажите настройки даты/дня и времени отправки отчета получателю (раз в месяц, каждый 1-й день месяца).

</details>